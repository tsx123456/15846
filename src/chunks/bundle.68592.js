System.register([], function(_export, _context) { return { execute: function () {
System.register("chunks:///_virtual/env",[],(function(e){return{execute:function(){e("DEBUG",!1)}}}));

System.register("chunks:///_virtual/rollupPluginModLoBabelHelpers.js",[],(function(t){return{execute:function(){function r(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function e(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function n(){return(n=t("extends",Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t})).apply(this,arguments)}function o(r,e){return(o=t("setPrototypeOf",Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t}))(r,e)}function i(t,r){if(t){if("string"==typeof t)return a(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(t,r):void 0}}function a(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function u(t,r){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function c(t){var r=u(t,"string");return"symbol"==typeof r?r:String(r)}t({applyDecoratedDescriptor:function(t,r,e,n,o){var i={};Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0);i=e.slice().reverse().reduce((function(e,n){return n(t,r,e)||e}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0);void 0===i.initializer&&(Object.defineProperty(t,r,i),i=null);return i},arrayLikeToArray:a,assertThisInitialized:function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},asyncToGenerator:function(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function u(t){r(a,o,i,u,c,"next",t)}function c(t){r(a,o,i,u,c,"throw",t)}u(void 0)}))}},createClass:function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return Object.defineProperty(t,"prototype",{writable:!1}),t},createForOfIteratorHelperLoose:function(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=i(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},extends:n,inheritsLoose:function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r)},initializerDefineProperty:function(t,r,e,n){if(!e)return;Object.defineProperty(t,r,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(n):void 0})},regeneratorRuntime:function(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t("regeneratorRuntime",(function(){return e}));var r,e={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,r,e){t[r]=e.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{f({},"")}catch(r){f=function(t,r,e){return t[r]=e}}function s(t,r,e,n){var o=r&&r.prototype instanceof g?r:g,a=Object.create(o.prototype),u=new T(n||[]);return i(a,"_invoke",{value:P(t,e,u)}),a}function h(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var p="suspendedStart",y="executing",v="completed",d={};function g(){}function m(){}function b(){}var w={};f(w,u,(function(){return this}));var O=Object.getPrototypeOf,L=O&&O(O(z([])));L&&L!==n&&o.call(L,u)&&(w=L);var j=b.prototype=g.prototype=Object.create(w);function x(t){["next","throw","return"].forEach((function(r){f(t,r,(function(t){return this._invoke(r,t)}))}))}function E(t,r){function e(n,i,a,u){var c=h(t[n],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){e("next",t,a,u)}),(function(t){e("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return e("throw",t,a,u)}))}u(c.arg)}var n;i(this,"_invoke",{value:function(t,o){function i(){return new r((function(r,n){e(t,o,r,n)}))}return n=n?n.then(i,i):i()}})}function P(t,e,n){var o=p;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=_(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=h(t,e,n);if("normal"===l.type){if(o=n.done?v:"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function _(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,_(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=h(o,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function k(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function z(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=b,i(j,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=f(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===m||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,f(t,l,"GeneratorFunction")),t.prototype=Object.create(j),t},e.awrap=function(t){return{__await:t}},x(E.prototype),f(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(j),f(j,l,"Generator"),f(j,u,(function(){return this})),f(j,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var r=Object(t),e=[];for(var n in r)e.push(n);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=z,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return u.type="throw",u.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),d},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),k(e),d}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;k(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:z(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}},e},setPrototypeOf:o,toPrimitive:u,toPropertyKey:c,unsupportedIterableToArray:i})}}}));

} }; });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3ZpcnR1YWw6L2NjL3ZpcnR1YWw6L2NjL2VudiIsIi4uL2NjZTovaW50ZXJuYWwvY2NlOi9pbnRlcm5hbC9yb2xsdXBQbHVnaW5Nb2RMb0JhYmVsSGVscGVycy5qcyJdLCJuYW1lcyI6WyJhc3luY0dlbmVyYXRvclN0ZXAiLCJnZW4iLCJyZXNvbHZlIiwicmVqZWN0IiwiX25leHQiLCJfdGhyb3ciLCJrZXkiLCJhcmciLCJpbmZvIiwidmFsdWUiLCJlcnJvciIsImRvbmUiLCJQcm9taXNlIiwidGhlbiIsIl9kZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiX3RvUHJvcGVydHlLZXkiLCJfZXh0ZW5kcyIsImFzc2lnbiIsImJpbmQiLCJhcmd1bWVudHMiLCJzb3VyY2UiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsInRoaXMiLCJfc2V0UHJvdG90eXBlT2YiLCJvIiwicCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5IiwibWluTGVuIiwiX2FycmF5TGlrZVRvQXJyYXkiLCJuIiwidG9TdHJpbmciLCJzbGljZSIsImNvbnN0cnVjdG9yIiwibmFtZSIsIkFycmF5IiwiZnJvbSIsInRlc3QiLCJhcnIiLCJsZW4iLCJhcnIyIiwiX3RvUHJpbWl0aXZlIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiTnVtYmVyIiwicHJvcGVydHkiLCJkZWNvcmF0b3JzIiwiY29udGV4dCIsImRlc2MiLCJrZXlzIiwiZm9yRWFjaCIsImluaXRpYWxpemVyIiwicmV2ZXJzZSIsInJlZHVjZSIsImRlY29yYXRvciIsInNlbGYiLCJSZWZlcmVuY2VFcnJvciIsImZuIiwiYXJncyIsImVyciIsIkNvbnN0cnVjdG9yIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiYWxsb3dBcnJheUxpa2UiLCJpdCIsIml0ZXJhdG9yIiwibmV4dCIsImlzQXJyYXkiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJjcmVhdGUiLCJlIiwidCIsInIiLCJhIiwiYyIsImFzeW5jSXRlcmF0b3IiLCJ1IiwidG9TdHJpbmdUYWciLCJkZWZpbmUiLCJ3cmFwIiwiR2VuZXJhdG9yIiwiQ29udGV4dCIsIm1ha2VJbnZva2VNZXRob2QiLCJ0cnlDYXRjaCIsInR5cGUiLCJoIiwiZiIsInMiLCJ5IiwiR2VuZXJhdG9yRnVuY3Rpb24iLCJHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSIsImQiLCJnZXRQcm90b3R5cGVPZiIsInYiLCJ2YWx1ZXMiLCJnIiwiZGVmaW5lSXRlcmF0b3JNZXRob2RzIiwiX2ludm9rZSIsIkFzeW5jSXRlcmF0b3IiLCJpbnZva2UiLCJfX2F3YWl0IiwiY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmciLCJFcnJvciIsIm1ldGhvZCIsImRlbGVnYXRlIiwibWF5YmVJbnZva2VEZWxlZ2F0ZSIsInNlbnQiLCJfc2VudCIsImRpc3BhdGNoRXhjZXB0aW9uIiwiYWJydXB0IiwicmV0dXJuIiwicmVzdWx0TmFtZSIsIm5leHRMb2MiLCJwdXNoVHJ5RW50cnkiLCJ0cnlMb2MiLCJjYXRjaExvYyIsImZpbmFsbHlMb2MiLCJhZnRlckxvYyIsInRyeUVudHJpZXMiLCJwdXNoIiwicmVzZXRUcnlFbnRyeSIsImNvbXBsZXRpb24iLCJyZXNldCIsImlzTmFOIiwiZGlzcGxheU5hbWUiLCJpc0dlbmVyYXRvckZ1bmN0aW9uIiwibWFyayIsImF3cmFwIiwiYXN5bmMiLCJwb3AiLCJwcmV2IiwiY2hhckF0Iiwic3RvcCIsInJ2YWwiLCJoYW5kbGUiLCJjb21wbGV0ZSIsImZpbmlzaCIsImNhdGNoIiwiZGVsZWdhdGVZaWVs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QWUsU0FBVXBFLEVBQUdFLEVBQUdsRCxHQUM3QixPQUFPVCxLQUFLMkYsU0FBVyxDQUNyQnhDLFNBQVU4QixFQUFPeEIsR0FDakJ5QyxXQUFZdkMsRUFDWndDLFFBQVMxRixHQUNSLFNBQVdULEtBQUswRixTQUFXMUYsS0FBSzVCLElBQU1zRixHQUFJaUIsSUFFOUNsQiIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgSFRNTDUgPSB0cnVlO1xuZXhwb3J0IGNvbnN0IE5BVElWRSA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IEFORFJPSUQgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBJT1MgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBNQUMgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBXSU5ET1dTID0gZmFsc2U7XG5leHBvcnQgY29uc3QgTElOVVggPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBPSE9TID0gZmFsc2U7XG5leHBvcnQgY29uc3QgT1BFTl9IQVJNT05ZID0gZmFsc2U7XG5leHBvcnQgY29uc3QgV0VDSEFUID0gZmFsc2U7XG5leHBvcnQgY29uc3QgV0VDSEFUX01JTklfUFJPR1JBTSA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IEJBSURVID0gZmFsc2U7XG5leHBvcnQgY29uc3QgWElBT01JID0gZmFsc2U7XG5leHBvcnQgY29uc3QgQUxJUEFZID0gZmFsc2U7XG5leHBvcnQgY29uc3QgVEFPQkFPID0gZmFsc2U7XG5leHBvcnQgY29uc3QgVEFPQkFPX01JTklHQU1FID0gZmFsc2U7XG5leHBvcnQgY29uc3QgQllURURBTkNFID0gZmFsc2U7XG5leHBvcnQgY29uc3QgT1BQTyA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IFZJVk8gPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBIVUFXRUkgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBDT0NPU1BMQVkgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBRVFQgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBMSU5LU1VSRSA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IEVESVRPUiA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IEVESVRPUl9OT1RfSU5fUFJFVklFVyA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IFBSRVZJRVcgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBCVUlMRCA9IHRydWU7XG5leHBvcnQgY29uc3QgVEVTVCA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IERFQlVHID0gZmFsc2U7XG5leHBvcnQgY29uc3QgREVWID0gZmFsc2U7XG5leHBvcnQgY29uc3QgTUlOSUdBTUUgPSBmYWxzZTtcbmV4cG9ydCBjb25zdCBSVU5USU1FX0JBU0VEID0gZmFsc2U7XG5leHBvcnQgY29uc3QgU1VQUE9SVF9KSVQgPSB0cnVlO1xuZXhwb3J0IGNvbnN0IEpTQiA9IGZhbHNlO1xuZXhwb3J0IGNvbnN0IE5FVF9NT0RFID0gMDsiLCJleHBvcnQgeyBfQXN5bmNHZW5lcmF0b3IgYXMgQXN5bmNHZW5lcmF0b3IsIF9PdmVybG9hZFlpZWxkIGFzIE92ZXJsb2FkWWllbGQsIF9hcHBseURlY3MgYXMgYXBwbHlEZWNzLCBfYXBwbHlEZWNzMjIwMyBhcyBhcHBseURlY3MyMjAzLCBfYXBwbHlEZWNzMjIwM1IgYXMgYXBwbHlEZWNzMjIwM1IsIF9hcHBseURlY3MyMzAxIGFzIGFwcGx5RGVjczIzMDEsIF9hcHBseURlY3MyMzA1IGFzIGFwcGx5RGVjczIzMDUsIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlIGFzIGFzeW5jR2VuZXJhdG9yRGVsZWdhdGUsIF9hc3luY0l0ZXJhdG9yIGFzIGFzeW5jSXRlcmF0b3IsIF9hd2FpdEFzeW5jR2VuZXJhdG9yIGFzIGF3YWl0QXN5bmNHZW5lcmF0b3IsIF9jaGVja0luUkhTIGFzIGNoZWNrSW5SSFMsIF9kZWZpbmVBY2Nlc3NvciBhcyBkZWZpbmVBY2Nlc3NvciwgX2Rpc3Bvc2UgYXMgZGlzcG9zZSwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0IGFzIGl0ZXJhYmxlVG9BcnJheUxpbWl0LCBfaXRlcmFibGVUb0FycmF5TGltaXRMb29zZSBhcyBpdGVyYWJsZVRvQXJyYXlMaW1pdExvb3NlLCBfanN4IGFzIGpzeCwgX29iamVjdFNwcmVhZDIgYXMgb2JqZWN0U3ByZWFkMiwgX3JlZ2VuZXJhdG9yUnVudGltZSBhcyByZWdlbmVyYXRvclJ1bnRpbWUsIF90eXBlb2YgYXMgdHlwZW9mLCBfdXNpbmcgYXMgdXNpbmcsIF93cmFwUmVnRXhwIGFzIHdyYXBSZWdFeHAsIF9Bd2FpdFZhbHVlIGFzIEF3YWl0VmFsdWUsIF93cmFwQXN5bmNHZW5lcmF0b3IgYXMgd3JhcEFzeW5jR2VuZXJhdG9yLCBfYXN5bmNUb0dlbmVyYXRvciBhcyBhc3luY1RvR2VuZXJhdG9yLCBfY2xhc3NDYWxsQ2hlY2sgYXMgY2xhc3NDYWxsQ2hlY2ssIF9jcmVhdGVDbGFzcyBhcyBjcmVhdGVDbGFzcywgX2RlZmluZUVudW1lcmFibGVQcm9wZXJ0aWVzIGFzIGRlZmluZUVudW1lcmFibGVQcm9wZXJ0aWVzLCBfZGVmYXVsdHMgYXMgZGVmYXVsdHMsIF9kZWZpbmVQcm9wZXJ0eSBhcyBkZWZpbmVQcm9wZXJ0eSwgX2V4dGVuZHMgYXMgZXh0ZW5kcywgX29iamVjdFNwcmVhZCBhcyBvYmplY3RTcHJlYWQsIF9pbmhlcml0cyBhcyBpbmhlcml0cywgX2luaGVyaXRzTG9vc2UgYXMgaW5oZXJpdHNMb29zZSwgX2dldFByb3RvdHlwZU9mIGFzIGdldFByb3RvdHlwZU9mLCBfc2V0UHJvdG90eXBlT2YgYXMgc2V0UHJvdG90eXBlT2YsIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgYXMgaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0LCBfY29uc3RydWN0IGFzIGNvbnN0cnVjdCwgX2lzTmF0aXZlRnVuY3Rpb24gYXMgaXNOYXRpdmVGdW5jdGlvbiwgX3dyYXBOYXRpdmVTdXBlciBhcyB3cmFwTmF0aXZlU3VwZXIsIF9pbnN0YW5jZW9mIGFzIGluc3RhbmNlb2YsIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgYXMgaW50ZXJvcFJlcXVpcmVEZWZhdWx0LCBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCBhcyBpbnRlcm9wUmVxdWlyZVdpbGRjYXJkLCBfbmV3QXJyb3dDaGVjayBhcyBuZXdBcnJvd0NoZWNrLCBfb2JqZWN0RGVzdHJ1Y3R1cmluZ0VtcHR5IGFzIG9iamVjdERlc3RydWN0dXJpbmdFbXB0eSwgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UgYXMgb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZSwgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIGFzIG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGFzIGFzc2VydFRoaXNJbml0aWFsaXplZCwgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gYXMgcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiwgX2NyZWF0ZVN1cGVyIGFzIGNyZWF0ZVN1cGVyLCBfc3VwZXJQcm9wQmFzZSBhcyBzdXBlclByb3BCYXNlLCBfZ2V0IGFzIGdldCwgX3NldCBhcyBzZXQsIF90YWdnZWRUZW1wbGF0ZUxpdGVyYWwgYXMgdGFnZ2VkVGVtcGxhdGVMaXRlcmFsLCBfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsTG9vc2UgYXMgdGFnZ2VkVGVtcGxhdGVMaXRlcmFsTG9vc2UsIF9yZWFkT25seUVycm9yIGFzIHJlYWRPbmx5RXJyb3IsIF93cml0ZU9ubHlFcnJvciBhcyB3cml0ZU9ubHlFcnJvciwgX2NsYXNzTmFtZVREWkVycm9yIGFzIGNsYXNzTmFtZVREWkVycm9yLCBfdGVtcG9yYWxVbmRlZmluZWQgYXMgdGVtcG9yYWxVbmRlZmluZWQsIF90ZHogYXMgdGR6LCBfdGVtcG9yYWxSZWYgYXMgdGVtcG9yYWxSZWYsIF9zbGljZWRUb0FycmF5IGFzIHNsaWNlZFRvQXJyYXksIF9zbGljZWRUb0FycmF5TG9vc2UgYXMgc2xpY2VkVG9BcnJheUxvb3NlLCBfdG9BcnJheSBhcyB0b0FycmF5LCBfdG9Db25zdW1hYmxlQXJyYXkgYXMgdG9Db25zdW1hYmxlQXJyYXksIF9hcnJheVdpdGhvdXRIb2xlcyBhcyBhcnJheVdpdGhvdXRIb2xlcywgX2FycmF5V2l0aEhvbGVzIGFzIGFycmF5V2l0aEhvbGVzLCBfbWF5YmVBcnJheUxpa2UgYXMgbWF5YmVBcnJheUxpa2UsIF9pdGVyYWJsZVRvQXJyYXkgYXMgaXRlcmFibGVUb0FycmF5LCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkgYXMgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXksIF9hcnJheUxpa2VUb0FycmF5IGFzIGFycmF5TGlrZVRvQXJyYXksIF9ub25JdGVyYWJsZVNwcmVhZCBhcyBub25JdGVyYWJsZVNwcmVhZCwgX25vbkl0ZXJhYmxlUmVzdCBhcyBub25JdGVyYWJsZVJlc3QsIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGFzIGNyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIsIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyTG9vc2UgYXMgY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlckxvb3NlLCBfc2tpcEZpcnN0R2VuZXJhdG9yTmV4dCBhcyBza2lwRmlyc3RHZW5lcmF0b3JOZXh0LCBfdG9QcmltaXRpdmUgYXMgdG9QcmltaXRpdmUsIF90b1Byb3BlcnR5S2V5IGFzIHRvUHJvcGVydHlLZXksIF9pbml0aWFsaXplcldhcm5pbmdIZWxwZXIgYXMgaW5pdGlhbGl6ZXJXYXJuaW5nSGVscGVyLCBfaW5pdGlhbGl6ZXJEZWZpbmVQcm9wZXJ0eSBhcyBpbml0aWFsaXplckRlZmluZVByb3BlcnR5LCBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yIGFzIGFwcGx5RGVjb3JhdGVkRGVzY3JpcHRvciwgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkgYXMgY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSwgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlIGFzIGNsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlLCBfY2xhc3NQcml2YXRlRmllbGRHZXQgYXMgY2xhc3NQcml2YXRlRmllbGRHZXQsIF9jbGFzc1ByaXZhdGVGaWVsZFNldCBhcyBjbGFzc1ByaXZhdGVGaWVsZFNldCwgX2NsYXNzUHJpdmF0ZUZpZWxkRGVzdHJ1Y3R1cmVTZXQgYXMgY2xhc3NQcml2YXRlRmllbGREZXN0cnVjdHVyZVNldCwgX2NsYXNzRXh0cmFjdEZpZWxkRGVzY3JpcHRvciBhcyBjbGFzc0V4dHJhY3RGaWVsZERlc2NyaXB0b3IsIF9jbGFzc1N0YXRpY1ByaXZhdGVGaWVsZFNwZWNHZXQgYXMgY2xhc3NTdGF0aWNQcml2YXRlRmllbGRTcGVjR2V0LCBfY2xhc3NTdGF0aWNQcml2YXRlRmllbGRTcGVjU2V0IGFzIGNsYXNzU3RhdGljUHJpdmF0ZUZpZWxkU3BlY1NldCwgX2NsYXNzU3RhdGljUHJpdmF0ZU1ldGhvZEdldCBhcyBjbGFzc1N0YXRpY1ByaXZhdGVNZXRob2RHZXQsIF9jbGFzc1N0YXRpY1ByaXZhdGVNZXRob2RTZXQgYXMgY2xhc3NTdGF0aWNQcml2YXRlTWV0aG9kU2V0LCBfY2xhc3NBcHBseURlc2NyaXB0b3JHZXQgYXMgY2xhc3NBcHBseURlc2NyaXB0b3JHZXQsIF9jbGFzc0FwcGx5RGVzY3JpcHRvclNldCBhcyBjbGFzc0FwcGx5RGVzY3JpcHRvclNldCwgX2NsYXNzQXBwbHlEZXNjcmlwdG9yRGVzdHJ1Y3R1cmVTZXQgYXMgY2xhc3NBcHBseURlc2NyaXB0b3JEZXN0cnVjdHVyZVNldCwgX2NsYXNzU3RhdGljUHJpdmF0ZUZpZWxkRGVzdHJ1Y3R1cmVTZXQgYXMgY2xhc3NTdGF0aWNQcml2YXRlRmllbGREZXN0cnVjdHVyZVNldCwgX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljQWNjZXNzIGFzIGNsYXNzQ2hlY2tQcml2YXRlU3RhdGljQWNjZXNzLCBfY2xhc3NDaGVja1ByaXZhdGVTdGF0aWNGaWVsZERlc2NyaXB0b3IgYXMgY2xhc3NDaGVja1ByaXZhdGVTdGF0aWNGaWVsZERlc2NyaXB0b3IsIF9kZWNvcmF0ZSBhcyBkZWNvcmF0ZSwgX2NsYXNzUHJpdmF0ZU1ldGhvZEdldCBhcyBjbGFzc1ByaXZhdGVNZXRob2RHZXQsIF9jaGVja1ByaXZhdGVSZWRlY2xhcmF0aW9uIGFzIGNoZWNrUHJpdmF0ZVJlZGVjbGFyYXRpb24sIF9jbGFzc1ByaXZhdGVGaWVsZEluaXRTcGVjIGFzIGNsYXNzUHJpdmF0ZUZpZWxkSW5pdFNwZWMsIF9jbGFzc1ByaXZhdGVNZXRob2RJbml0U3BlYyBhcyBjbGFzc1ByaXZhdGVNZXRob2RJbml0U3BlYywgX2NsYXNzUHJpdmF0ZU1ldGhvZFNldCBhcyBjbGFzc1ByaXZhdGVNZXRob2RTZXQsIF9pZGVudGl0eSBhcyBpZGVudGl0eSB9O1xuZnVuY3Rpb24gX0FzeW5jR2VuZXJhdG9yKGUpIHtcbiAgdmFyIHIsIHQ7XG4gIGZ1bmN0aW9uIHJlc3VtZShyLCB0KSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBuID0gZVtyXSh0KSxcbiAgICAgICAgbyA9IG4udmFsdWUsXG4gICAgICAgIHUgPSBvIGluc3RhbmNlb2YgX092ZXJsb2FkWWllbGQ7XG4gICAgICBQcm9taXNlLnJlc29sdmUodSA/IG8udiA6IG8pLnRoZW4oZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgaWYgKHUpIHtcbiAgICAgICAgICB2YXIgaSA9IFwicmV0dXJuXCIgPT09IHIgPyBcInJldHVyblwiIDogXCJuZXh0XCI7XG4gICAgICAgICAgaWYgKCFvLmsgfHwgdC5kb25lKSByZXR1cm4gcmVzdW1lKGksIHQpO1xuICAgICAgICAgIHQgPSBlW2ldKHQpLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHNldHRsZShuLmRvbmUgPyBcInJldHVyblwiIDogXCJub3JtYWxcIiwgdCk7XG4gICAgICB9LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXN1bWUoXCJ0aHJvd1wiLCBlKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHNldHRsZShcInRocm93XCIsIGUpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBzZXR0bGUoZSwgbikge1xuICAgIHN3aXRjaCAoZSkge1xuICAgICAgY2FzZSBcInJldHVyblwiOlxuICAgICAgICByLnJlc29sdmUoe1xuICAgICAgICAgIHZhbHVlOiBuLFxuICAgICAgICAgIGRvbmU6ICEwXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0aHJvd1wiOlxuICAgICAgICByLnJlamVjdChuKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByLnJlc29sdmUoe1xuICAgICAgICAgIHZhbHVlOiBuLFxuICAgICAgICAgIGRvbmU6ICExXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAociA9IHIubmV4dCkgPyByZXN1bWUoci5rZXksIHIuYXJnKSA6IHQgPSBudWxsO1xuICB9XG4gIHRoaXMuX2ludm9rZSA9IGZ1bmN0aW9uIChlLCBuKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChvLCB1KSB7XG4gICAgICB2YXIgaSA9IHtcbiAgICAgICAga2V5OiBlLFxuICAgICAgICBhcmc6IG4sXG4gICAgICAgIHJlc29sdmU6IG8sXG4gICAgICAgIHJlamVjdDogdSxcbiAgICAgICAgbmV4dDogbnVsbFxuICAgICAgfTtcbiAgICAgIHQgPyB0ID0gdC5uZXh0ID0gaSA6IChyID0gdCA9IGksIHJlc3VtZShlLCBuKSk7XG4gICAgfSk7XG4gIH0sIFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgZS5yZXR1cm4gJiYgKHRoaXMucmV0dXJuID0gdm9pZCAwKTtcbn1cbl9Bc3luY0dlbmVyYXRvci5wcm90b3R5cGVbXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgXCJAQGFzeW5jSXRlcmF0b3JcIl0gPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB0aGlzO1xufSwgX0FzeW5jR2VuZXJhdG9yLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKGUpIHtcbiAgcmV0dXJuIHRoaXMuX2ludm9rZShcIm5leHRcIiwgZSk7XG59LCBfQXN5bmNHZW5lcmF0b3IucHJvdG90eXBlLnRocm93ID0gZnVuY3Rpb24gKGUpIHtcbiAgcmV0dXJuIHRoaXMuX2ludm9rZShcInRocm93XCIsIGUpO1xufSwgX0FzeW5jR2VuZXJhdG9yLnByb3RvdHlwZS5yZXR1cm4gPSBmdW5jdGlvbiAoZSkge1xuICByZXR1cm4gdGhpcy5faW52b2tlKFwicmV0dXJuXCIsIGUpO1xufTtcbmZ1bmN0aW9uIF9PdmVybG9hZFlpZWxkKHQsIGUpIHtcbiAgdGhpcy52ID0gdCwgdGhpcy5rID0gZTtcbn1cbmZ1bmN0aW9uIG9sZF9jcmVhdGVNZXRhZGF0YU1ldGhvZHNGb3JQcm9wZXJ0eShlLCB0LCBhLCByKSB7XG4gIHJldHVybiB7XG4gICAgZ2V0TWV0YWRhdGE6IGZ1bmN0aW9uIChvKSB7XG4gICAgICBvbGRfYXNzZXJ0Tm90RmluaXNoZWQociwgXCJnZXRNZXRhZGF0YVwiKSwgb2xkX2Fzc2VydE1ldGFkYXRhS2V5KG8pO1xuICAgICAgdmFyIGkgPSBlW29dO1xuICAgICAgaWYgKHZvaWQgMCAhPT0gaSkgaWYgKDEgPT09IHQpIHtcbiAgICAgICAgdmFyIG4gPSBpLnB1YmxpYztcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gbikgcmV0dXJuIG5bYV07XG4gICAgICB9IGVsc2UgaWYgKDIgPT09IHQpIHtcbiAgICAgICAgdmFyIGwgPSBpLnByaXZhdGU7XG4gICAgICAgIGlmICh2b2lkIDAgIT09IGwpIHJldHVybiBsLmdldChhKTtcbiAgICAgIH0gZWxzZSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoaSwgXCJjb25zdHJ1Y3RvclwiKSkgcmV0dXJuIGkuY29uc3RydWN0b3I7XG4gICAgfSxcbiAgICBzZXRNZXRhZGF0YTogZnVuY3Rpb24gKG8sIGkpIHtcbiAgICAgIG9sZF9hc3NlcnROb3RGaW5pc2hlZChyLCBcInNldE1ldGFkYXRhXCIpLCBvbGRfYXNzZXJ0TWV0YWRhdGFLZXkobyk7XG4gICAgICB2YXIgbiA9IGVbb107XG4gICAgICBpZiAodm9pZCAwID09PSBuICYmIChuID0gZVtvXSA9IHt9KSwgMSA9PT0gdCkge1xuICAgICAgICB2YXIgbCA9IG4ucHVibGljO1xuICAgICAgICB2b2lkIDAgPT09IGwgJiYgKGwgPSBuLnB1YmxpYyA9IHt9KSwgbFthXSA9IGk7XG4gICAgICB9IGVsc2UgaWYgKDIgPT09IHQpIHtcbiAgICAgICAgdmFyIHMgPSBuLnByaXY7XG4gICAgICAgIHZvaWQgMCA9PT0gcyAmJiAocyA9IG4ucHJpdmF0ZSA9IG5ldyBNYXAoKSksIHMuc2V0KGEsIGkpO1xuICAgICAgfSBlbHNlIG4uY29uc3RydWN0b3IgPSBpO1xuICAgIH1cbiAgfTtcbn1cbmZ1bmN0aW9uIG9sZF9jb252ZXJ0TWV0YWRhdGFNYXBUb0ZpbmFsKGUsIHQpIHtcbiAgdmFyIGEgPSBlW1N5bWJvbC5tZXRhZGF0YSB8fCBTeW1ib2wuZm9yKFwiU3ltYm9sLm1ldGFkYXRhXCIpXSxcbiAgICByID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0KTtcbiAgaWYgKDAgIT09IHIubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgbyA9IDA7IG8gPCByLmxlbmd0aDsgbysrKSB7XG4gICAgICB2YXIgaSA9IHJbb10sXG4gICAgICAgIG4gPSB0W2ldLFxuICAgICAgICBsID0gYSA/IGFbaV0gOiBudWxsLFxuICAgICAgICBzID0gbi5wdWJsaWMsXG4gICAgICAgIGMgPSBsID8gbC5wdWJsaWMgOiBudWxsO1xuICAgICAgcyAmJiBjICYmIE9iamVjdC5zZXRQcm90b3R5cGVPZihzLCBjKTtcbiAgICAgIHZhciBkID0gbi5wcml2YXRlO1xuICAgICAgaWYgKGQpIHtcbiAgICAgICAgdmFyIHUgPSBBcnJheS5mcm9tKGQudmFsdWVzKCkpLFxuICAgICAgICAgIGYgPSBsID8gbC5wcml2YXRlIDogbnVsbDtcbiAgICAgICAgZiAmJiAodSA9IHUuY29uY2F0KGYpKSwgbi5wcml2YXRlID0gdTtcbiAgICAgIH1cbiAgICAgIGwgJiYgT2JqZWN0LnNldFByb3RvdHlwZU9mKG4sIGwpO1xuICAgIH1cbiAgICBhICYmIE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBhKSwgZVtTeW1ib2wubWV0YWRhdGEgfHwgU3ltYm9sLmZvcihcIlN5bWJvbC5tZXRhZGF0YVwiKV0gPSB0O1xuICB9XG59XG5mdW5jdGlvbiBvbGRfY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QoZSwgdCkge1xuICByZXR1cm4gZnVuY3Rpb24gKGEpIHtcbiAgICBvbGRfYXNzZXJ0Tm90RmluaXNoZWQodCwgXCJhZGRJbml0aWFsaXplclwiKSwgb2xkX2Fzc2VydENhbGxhYmxlKGEsIFwiQW4gaW5pdGlhbGl6ZXJcIiksIGUucHVzaChhKTtcbiAgfTtcbn1cbmZ1bmN0aW9uIG9sZF9tZW1iZXJEZWMoZSwgdCwgYSwgciwgbywgaSwgbiwgbCwgcykge1xuICB2YXIgYztcbiAgc3dpdGNoIChpKSB7XG4gICAgY2FzZSAxOlxuICAgICAgYyA9IFwiYWNjZXNzb3JcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIGMgPSBcIm1ldGhvZFwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAzOlxuICAgICAgYyA9IFwiZ2V0dGVyXCI7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDQ6XG4gICAgICBjID0gXCJzZXR0ZXJcIjtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBjID0gXCJmaWVsZFwiO1xuICB9XG4gIHZhciBkLFxuICAgIHUsXG4gICAgZiA9IHtcbiAgICAgIGtpbmQ6IGMsXG4gICAgICBuYW1lOiBsID8gXCIjXCIgKyB0IDogdCxcbiAgICAgIGlzU3RhdGljOiBuLFxuICAgICAgaXNQcml2YXRlOiBsXG4gICAgfSxcbiAgICBwID0ge1xuICAgICAgdjogITFcbiAgICB9O1xuICBpZiAoMCAhPT0gaSAmJiAoZi5hZGRJbml0aWFsaXplciA9IG9sZF9jcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChvLCBwKSksIGwpIHtcbiAgICBkID0gMiwgdSA9IFN5bWJvbCh0KTtcbiAgICB2YXIgdiA9IHt9O1xuICAgIDAgPT09IGkgPyAodi5nZXQgPSBhLmdldCwgdi5zZXQgPSBhLnNldCkgOiAyID09PSBpID8gdi5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYS52YWx1ZTtcbiAgICB9IDogKDEgIT09IGkgJiYgMyAhPT0gaSB8fCAodi5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYS5nZXQuY2FsbCh0aGlzKTtcbiAgICB9KSwgMSAhPT0gaSAmJiA0ICE9PSBpIHx8ICh2LnNldCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBhLnNldC5jYWxsKHRoaXMsIGUpO1xuICAgIH0pKSwgZi5hY2Nlc3MgPSB2O1xuICB9IGVsc2UgZCA9IDEsIHUgPSB0O1xuICB0cnkge1xuICAgIHJldHVybiBlKHMsIE9iamVjdC5hc3NpZ24oZiwgb2xkX2NyZWF0ZU1ldGFkYXRhTWV0aG9kc0ZvclByb3BlcnR5KHIsIGQsIHUsIHApKSk7XG4gIH0gZmluYWxseSB7XG4gICAgcC52ID0gITA7XG4gIH1cbn1cbmZ1bmN0aW9uIG9sZF9hc3NlcnROb3RGaW5pc2hlZChlLCB0KSB7XG4gIGlmIChlLnYpIHRocm93IG5ldyBFcnJvcihcImF0dGVtcHRlZCB0byBjYWxsIFwiICsgdCArIFwiIGFmdGVyIGRlY29yYXRpb24gd2FzIGZpbmlzaGVkXCIpO1xufVxuZnVuY3Rpb24gb2xkX2Fzc2VydE1ldGFkYXRhS2V5KGUpIHtcbiAgaWYgKFwic3ltYm9sXCIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJNZXRhZGF0YSBrZXlzIG11c3QgYmUgc3ltYm9scywgcmVjZWl2ZWQ6IFwiICsgZSk7XG59XG5mdW5jdGlvbiBvbGRfYXNzZXJ0Q2FsbGFibGUoZSwgdCkge1xuICBpZiAoXCJmdW5jdGlvblwiICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKHQgKyBcIiBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XG59XG5mdW5jdGlvbiBvbGRfYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZShlLCB0KSB7XG4gIHZhciBhID0gdHlwZW9mIHQ7XG4gIGlmICgxID09PSBlKSB7XG4gICAgaWYgKFwib2JqZWN0XCIgIT09IGEgfHwgbnVsbCA9PT0gdCkgdGhyb3cgbmV3IFR5cGVFcnJvcihcImFjY2Vzc29yIGRlY29yYXRvcnMgbXVzdCByZXR1cm4gYW4gb2JqZWN0IHdpdGggZ2V0LCBzZXQsIG9yIGluaXQgcHJvcGVydGllcyBvciB2b2lkIDBcIik7XG4gICAgdm9pZCAwICE9PSB0LmdldCAmJiBvbGRfYXNzZXJ0Q2FsbGFibGUodC5nZXQsIFwiYWNjZXNzb3IuZ2V0XCIpLCB2b2lkIDAgIT09IHQuc2V0ICYmIG9sZF9hc3NlcnRDYWxsYWJsZSh0LnNldCwgXCJhY2Nlc3Nvci5zZXRcIiksIHZvaWQgMCAhPT0gdC5pbml0ICYmIG9sZF9hc3NlcnRDYWxsYWJsZSh0LmluaXQsIFwiYWNjZXNzb3IuaW5pdFwiKSwgdm9pZCAwICE9PSB0LmluaXRpYWxpemVyICYmIG9sZF9hc3NlcnRDYWxsYWJsZSh0LmluaXRpYWxpemVyLCBcImFjY2Vzc29yLmluaXRpYWxpemVyXCIpO1xuICB9IGVsc2UgaWYgKFwiZnVuY3Rpb25cIiAhPT0gYSkge1xuICAgIHZhciByO1xuICAgIHRocm93IHIgPSAwID09PSBlID8gXCJmaWVsZFwiIDogMTAgPT09IGUgPyBcImNsYXNzXCIgOiBcIm1ldGhvZFwiLCBuZXcgVHlwZUVycm9yKHIgKyBcIiBkZWNvcmF0b3JzIG11c3QgcmV0dXJuIGEgZnVuY3Rpb24gb3Igdm9pZCAwXCIpO1xuICB9XG59XG5mdW5jdGlvbiBvbGRfZ2V0SW5pdChlKSB7XG4gIHZhciB0O1xuICByZXR1cm4gbnVsbCA9PSAodCA9IGUuaW5pdCkgJiYgKHQgPSBlLmluaXRpYWxpemVyKSAmJiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBjb25zb2xlICYmIGNvbnNvbGUud2FybihcIi5pbml0aWFsaXplciBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbml0IGFzIG9mIE1hcmNoIDIwMjJcIiksIHQ7XG59XG5mdW5jdGlvbiBvbGRfYXBwbHlNZW1iZXJEZWMoZSwgdCwgYSwgciwgbywgaSwgbiwgbCwgcykge1xuICB2YXIgYyxcbiAgICBkLFxuICAgIHUsXG4gICAgZixcbiAgICBwLFxuICAgIHYsXG4gICAgaCA9IGFbMF07XG4gIGlmIChuID8gYyA9IDAgPT09IG8gfHwgMSA9PT0gbyA/IHtcbiAgICBnZXQ6IGFbM10sXG4gICAgc2V0OiBhWzRdXG4gIH0gOiAzID09PSBvID8ge1xuICAgIGdldDogYVszXVxuICB9IDogNCA9PT0gbyA/IHtcbiAgICBzZXQ6IGFbM11cbiAgfSA6IHtcbiAgICB2YWx1ZTogYVszXVxuICB9IDogMCAhPT0gbyAmJiAoYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpLCAxID09PSBvID8gdSA9IHtcbiAgICBnZXQ6IGMuZ2V0LFxuICAgIHNldDogYy5zZXRcbiAgfSA6IDIgPT09IG8gPyB1ID0gYy52YWx1ZSA6IDMgPT09IG8gPyB1ID0gYy5nZXQgOiA0ID09PSBvICYmICh1ID0gYy5zZXQpLCBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGgpIHZvaWQgMCAhPT0gKGYgPSBvbGRfbWVtYmVyRGVjKGgsIHIsIGMsIGwsIHMsIG8sIGksIG4sIHUpKSAmJiAob2xkX2Fzc2VydFZhbGlkUmV0dXJuVmFsdWUobywgZiksIDAgPT09IG8gPyBkID0gZiA6IDEgPT09IG8gPyAoZCA9IG9sZF9nZXRJbml0KGYpLCBwID0gZi5nZXQgfHwgdS5nZXQsIHYgPSBmLnNldCB8fCB1LnNldCwgdSA9IHtcbiAgICBnZXQ6IHAsXG4gICAgc2V0OiB2XG4gIH0pIDogdSA9IGYpO2Vsc2UgZm9yICh2YXIgeSA9IGgubGVuZ3RoIC0gMTsgeSA+PSAwOyB5LS0pIHtcbiAgICB2YXIgYjtcbiAgICBpZiAodm9pZCAwICE9PSAoZiA9IG9sZF9tZW1iZXJEZWMoaFt5XSwgciwgYywgbCwgcywgbywgaSwgbiwgdSkpKSBvbGRfYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZShvLCBmKSwgMCA9PT0gbyA/IGIgPSBmIDogMSA9PT0gbyA/IChiID0gb2xkX2dldEluaXQoZiksIHAgPSBmLmdldCB8fCB1LmdldCwgdiA9IGYuc2V0IHx8IHUuc2V0LCB1ID0ge1xuICAgICAgZ2V0OiBwLFxuICAgICAgc2V0OiB2XG4gICAgfSkgOiB1ID0gZiwgdm9pZCAwICE9PSBiICYmICh2b2lkIDAgPT09IGQgPyBkID0gYiA6IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZCA/IGQgPSBbZCwgYl0gOiBkLnB1c2goYikpO1xuICB9XG4gIGlmICgwID09PSBvIHx8IDEgPT09IG8pIHtcbiAgICBpZiAodm9pZCAwID09PSBkKSBkID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiB0O1xuICAgIH07ZWxzZSBpZiAoXCJmdW5jdGlvblwiICE9IHR5cGVvZiBkKSB7XG4gICAgICB2YXIgZyA9IGQ7XG4gICAgICBkID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgZm9yICh2YXIgYSA9IHQsIHIgPSAwOyByIDwgZy5sZW5ndGg7IHIrKykgYSA9IGdbcl0uY2FsbChlLCBhKTtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbSA9IGQ7XG4gICAgICBkID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG0uY2FsbChlLCB0KTtcbiAgICAgIH07XG4gICAgfVxuICAgIGUucHVzaChkKTtcbiAgfVxuICAwICE9PSBvICYmICgxID09PSBvID8gKGMuZ2V0ID0gdS5nZXQsIGMuc2V0ID0gdS5zZXQpIDogMiA9PT0gbyA/IGMudmFsdWUgPSB1IDogMyA9PT0gbyA/IGMuZ2V0ID0gdSA6IDQgPT09IG8gJiYgKGMuc2V0ID0gdSksIG4gPyAxID09PSBvID8gKGUucHVzaChmdW5jdGlvbiAoZSwgdCkge1xuICAgIHJldHVybiB1LmdldC5jYWxsKGUsIHQpO1xuICB9KSwgZS5wdXNoKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgcmV0dXJuIHUuc2V0LmNhbGwoZSwgdCk7XG4gIH0pKSA6IDIgPT09IG8gPyBlLnB1c2godSkgOiBlLnB1c2goZnVuY3Rpb24gKGUsIHQpIHtcbiAgICByZXR1cm4gdS5jYWxsKGUsIHQpO1xuICB9KSA6IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCByLCBjKSk7XG59XG5mdW5jdGlvbiBvbGRfYXBwbHlNZW1iZXJEZWNzKGUsIHQsIGEsIHIsIG8pIHtcbiAgZm9yICh2YXIgaSwgbiwgbCA9IG5ldyBNYXAoKSwgcyA9IG5ldyBNYXAoKSwgYyA9IDA7IGMgPCBvLmxlbmd0aDsgYysrKSB7XG4gICAgdmFyIGQgPSBvW2NdO1xuICAgIGlmIChBcnJheS5pc0FycmF5KGQpKSB7XG4gICAgICB2YXIgdSxcbiAgICAgICAgZixcbiAgICAgICAgcCxcbiAgICAgICAgdiA9IGRbMV0sXG4gICAgICAgIGggPSBkWzJdLFxuICAgICAgICB5ID0gZC5sZW5ndGggPiAzLFxuICAgICAgICBiID0gdiA+PSA1O1xuICAgICAgaWYgKGIgPyAodSA9IHQsIGYgPSByLCAwICE9PSAodiAtPSA1KSAmJiAocCA9IG4gPSBuIHx8IFtdKSkgOiAodSA9IHQucHJvdG90eXBlLCBmID0gYSwgMCAhPT0gdiAmJiAocCA9IGkgPSBpIHx8IFtdKSksIDAgIT09IHYgJiYgIXkpIHtcbiAgICAgICAgdmFyIGcgPSBiID8gcyA6IGwsXG4gICAgICAgICAgbSA9IGcuZ2V0KGgpIHx8IDA7XG4gICAgICAgIGlmICghMCA9PT0gbSB8fCAzID09PSBtICYmIDQgIT09IHYgfHwgNCA9PT0gbSAmJiAzICE9PSB2KSB0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gZGVjb3JhdGUgYSBwdWJsaWMgbWV0aG9kL2FjY2Vzc29yIHRoYXQgaGFzIHRoZSBzYW1lIG5hbWUgYXMgYSBwcmV2aW91c2x5IGRlY29yYXRlZCBwdWJsaWMgbWV0aG9kL2FjY2Vzc29yLiBUaGlzIGlzIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkIGJ5IHRoZSBkZWNvcmF0b3JzIHBsdWdpbi4gUHJvcGVydHkgbmFtZSB3YXM6IFwiICsgaCk7XG4gICAgICAgICFtICYmIHYgPiAyID8gZy5zZXQoaCwgdikgOiBnLnNldChoLCAhMCk7XG4gICAgICB9XG4gICAgICBvbGRfYXBwbHlNZW1iZXJEZWMoZSwgdSwgZCwgaCwgdiwgYiwgeSwgZiwgcCk7XG4gICAgfVxuICB9XG4gIG9sZF9wdXNoSW5pdGlhbGl6ZXJzKGUsIGkpLCBvbGRfcHVzaEluaXRpYWxpemVycyhlLCBuKTtcbn1cbmZ1bmN0aW9uIG9sZF9wdXNoSW5pdGlhbGl6ZXJzKGUsIHQpIHtcbiAgdCAmJiBlLnB1c2goZnVuY3Rpb24gKGUpIHtcbiAgICBmb3IgKHZhciBhID0gMDsgYSA8IHQubGVuZ3RoOyBhKyspIHRbYV0uY2FsbChlKTtcbiAgICByZXR1cm4gZTtcbiAgfSk7XG59XG5mdW5jdGlvbiBvbGRfYXBwbHlDbGFzc0RlY3MoZSwgdCwgYSwgcikge1xuICBpZiAoci5sZW5ndGggPiAwKSB7XG4gICAgZm9yICh2YXIgbyA9IFtdLCBpID0gdCwgbiA9IHQubmFtZSwgbCA9IHIubGVuZ3RoIC0gMTsgbCA+PSAwOyBsLS0pIHtcbiAgICAgIHZhciBzID0ge1xuICAgICAgICB2OiAhMVxuICAgICAgfTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBjID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICAgICAgICBraW5kOiBcImNsYXNzXCIsXG4gICAgICAgICAgICBuYW1lOiBuLFxuICAgICAgICAgICAgYWRkSW5pdGlhbGl6ZXI6IG9sZF9jcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChvLCBzKVxuICAgICAgICAgIH0sIG9sZF9jcmVhdGVNZXRhZGF0YU1ldGhvZHNGb3JQcm9wZXJ0eShhLCAwLCBuLCBzKSksXG4gICAgICAgICAgZCA9IHJbbF0oaSwgYyk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBzLnYgPSAhMDtcbiAgICAgIH1cbiAgICAgIHZvaWQgMCAhPT0gZCAmJiAob2xkX2Fzc2VydFZhbGlkUmV0dXJuVmFsdWUoMTAsIGQpLCBpID0gZCk7XG4gICAgfVxuICAgIGUucHVzaChpLCBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKHZhciBlID0gMDsgZSA8IG8ubGVuZ3RoOyBlKyspIG9bZV0uY2FsbChpKTtcbiAgICB9KTtcbiAgfVxufVxuZnVuY3Rpb24gX2FwcGx5RGVjcyhlLCB0LCBhKSB7XG4gIHZhciByID0gW10sXG4gICAgbyA9IHt9LFxuICAgIGkgPSB7fTtcbiAgcmV0dXJuIG9sZF9hcHBseU1lbWJlckRlY3MociwgZSwgaSwgbywgdCksIG9sZF9jb252ZXJ0TWV0YWRhdGFNYXBUb0ZpbmFsKGUucHJvdG90eXBlLCBpKSwgb2xkX2FwcGx5Q2xhc3NEZWNzKHIsIGUsIG8sIGEpLCBvbGRfY29udmVydE1ldGFkYXRhTWFwVG9GaW5hbChlLCBvKSwgcjtcbn1cbmZ1bmN0aW9uIGFwcGx5RGVjczIyMDNGYWN0b3J5KCkge1xuICBmdW5jdGlvbiBjcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChlLCB0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChyKSB7XG4gICAgICAhZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgaWYgKGUudikgdGhyb3cgbmV3IEVycm9yKFwiYXR0ZW1wdGVkIHRvIGNhbGwgXCIgKyB0ICsgXCIgYWZ0ZXIgZGVjb3JhdGlvbiB3YXMgZmluaXNoZWRcIik7XG4gICAgICB9KHQsIFwiYWRkSW5pdGlhbGl6ZXJcIiksIGFzc2VydENhbGxhYmxlKHIsIFwiQW4gaW5pdGlhbGl6ZXJcIiksIGUucHVzaChyKTtcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIG1lbWJlckRlYyhlLCB0LCByLCBhLCBuLCBpLCBzLCBvKSB7XG4gICAgdmFyIGM7XG4gICAgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGMgPSBcImFjY2Vzc29yXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBjID0gXCJtZXRob2RcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGMgPSBcImdldHRlclwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgYyA9IFwic2V0dGVyXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYyA9IFwiZmllbGRcIjtcbiAgICB9XG4gICAgdmFyIGwsXG4gICAgICB1LFxuICAgICAgZiA9IHtcbiAgICAgICAga2luZDogYyxcbiAgICAgICAgbmFtZTogcyA/IFwiI1wiICsgdCA6IHQsXG4gICAgICAgIHN0YXRpYzogaSxcbiAgICAgICAgcHJpdmF0ZTogc1xuICAgICAgfSxcbiAgICAgIHAgPSB7XG4gICAgICAgIHY6ICExXG4gICAgICB9O1xuICAgIDAgIT09IG4gJiYgKGYuYWRkSW5pdGlhbGl6ZXIgPSBjcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChhLCBwKSksIDAgPT09IG4gPyBzID8gKGwgPSByLmdldCwgdSA9IHIuc2V0KSA6IChsID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXNbdF07XG4gICAgfSwgdSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB0aGlzW3RdID0gZTtcbiAgICB9KSA6IDIgPT09IG4gPyBsID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHIudmFsdWU7XG4gICAgfSA6ICgxICE9PSBuICYmIDMgIT09IG4gfHwgKGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gci5nZXQuY2FsbCh0aGlzKTtcbiAgICB9KSwgMSAhPT0gbiAmJiA0ICE9PSBuIHx8ICh1ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHIuc2V0LmNhbGwodGhpcywgZSk7XG4gICAgfSkpLCBmLmFjY2VzcyA9IGwgJiYgdSA/IHtcbiAgICAgIGdldDogbCxcbiAgICAgIHNldDogdVxuICAgIH0gOiBsID8ge1xuICAgICAgZ2V0OiBsXG4gICAgfSA6IHtcbiAgICAgIHNldDogdVxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBlKG8sIGYpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBwLnYgPSAhMDtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gYXNzZXJ0Q2FsbGFibGUoZSwgdCkge1xuICAgIGlmIChcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IodCArIFwiIG11c3QgYmUgYSBmdW5jdGlvblwiKTtcbiAgfVxuICBmdW5jdGlvbiBhc3NlcnRWYWxpZFJldHVyblZhbHVlKGUsIHQpIHtcbiAgICB2YXIgciA9IHR5cGVvZiB0O1xuICAgIGlmICgxID09PSBlKSB7XG4gICAgICBpZiAoXCJvYmplY3RcIiAhPT0gciB8fCBudWxsID09PSB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYWNjZXNzb3IgZGVjb3JhdG9ycyBtdXN0IHJldHVybiBhbiBvYmplY3Qgd2l0aCBnZXQsIHNldCwgb3IgaW5pdCBwcm9wZXJ0aWVzIG9yIHZvaWQgMFwiKTtcbiAgICAgIHZvaWQgMCAhPT0gdC5nZXQgJiYgYXNzZXJ0Q2FsbGFibGUodC5nZXQsIFwiYWNjZXNzb3IuZ2V0XCIpLCB2b2lkIDAgIT09IHQuc2V0ICYmIGFzc2VydENhbGxhYmxlKHQuc2V0LCBcImFjY2Vzc29yLnNldFwiKSwgdm9pZCAwICE9PSB0LmluaXQgJiYgYXNzZXJ0Q2FsbGFibGUodC5pbml0LCBcImFjY2Vzc29yLmluaXRcIik7XG4gICAgfSBlbHNlIGlmIChcImZ1bmN0aW9uXCIgIT09IHIpIHtcbiAgICAgIHZhciBhO1xuICAgICAgdGhyb3cgYSA9IDAgPT09IGUgPyBcImZpZWxkXCIgOiAxMCA9PT0gZSA/IFwiY2xhc3NcIiA6IFwibWV0aG9kXCIsIG5ldyBUeXBlRXJyb3IoYSArIFwiIGRlY29yYXRvcnMgbXVzdCByZXR1cm4gYSBmdW5jdGlvbiBvciB2b2lkIDBcIik7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGFwcGx5TWVtYmVyRGVjKGUsIHQsIHIsIGEsIG4sIGksIHMsIG8pIHtcbiAgICB2YXIgYyxcbiAgICAgIGwsXG4gICAgICB1LFxuICAgICAgZixcbiAgICAgIHAsXG4gICAgICBkLFxuICAgICAgaCA9IHJbMF07XG4gICAgaWYgKHMgPyBjID0gMCA9PT0gbiB8fCAxID09PSBuID8ge1xuICAgICAgZ2V0OiByWzNdLFxuICAgICAgc2V0OiByWzRdXG4gICAgfSA6IDMgPT09IG4gPyB7XG4gICAgICBnZXQ6IHJbM11cbiAgICB9IDogNCA9PT0gbiA/IHtcbiAgICAgIHNldDogclszXVxuICAgIH0gOiB7XG4gICAgICB2YWx1ZTogclszXVxuICAgIH0gOiAwICE9PSBuICYmIChjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCBhKSksIDEgPT09IG4gPyB1ID0ge1xuICAgICAgZ2V0OiBjLmdldCxcbiAgICAgIHNldDogYy5zZXRcbiAgICB9IDogMiA9PT0gbiA/IHUgPSBjLnZhbHVlIDogMyA9PT0gbiA/IHUgPSBjLmdldCA6IDQgPT09IG4gJiYgKHUgPSBjLnNldCksIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgaCkgdm9pZCAwICE9PSAoZiA9IG1lbWJlckRlYyhoLCBhLCBjLCBvLCBuLCBpLCBzLCB1KSkgJiYgKGFzc2VydFZhbGlkUmV0dXJuVmFsdWUobiwgZiksIDAgPT09IG4gPyBsID0gZiA6IDEgPT09IG4gPyAobCA9IGYuaW5pdCwgcCA9IGYuZ2V0IHx8IHUuZ2V0LCBkID0gZi5zZXQgfHwgdS5zZXQsIHUgPSB7XG4gICAgICBnZXQ6IHAsXG4gICAgICBzZXQ6IGRcbiAgICB9KSA6IHUgPSBmKTtlbHNlIGZvciAodmFyIHYgPSBoLmxlbmd0aCAtIDE7IHYgPj0gMDsgdi0tKSB7XG4gICAgICB2YXIgZztcbiAgICAgIGlmICh2b2lkIDAgIT09IChmID0gbWVtYmVyRGVjKGhbdl0sIGEsIGMsIG8sIG4sIGksIHMsIHUpKSkgYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZShuLCBmKSwgMCA9PT0gbiA/IGcgPSBmIDogMSA9PT0gbiA/IChnID0gZi5pbml0LCBwID0gZi5nZXQgfHwgdS5nZXQsIGQgPSBmLnNldCB8fCB1LnNldCwgdSA9IHtcbiAgICAgICAgZ2V0OiBwLFxuICAgICAgICBzZXQ6IGRcbiAgICAgIH0pIDogdSA9IGYsIHZvaWQgMCAhPT0gZyAmJiAodm9pZCAwID09PSBsID8gbCA9IGcgOiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGwgPyBsID0gW2wsIGddIDogbC5wdXNoKGcpKTtcbiAgICB9XG4gICAgaWYgKDAgPT09IG4gfHwgMSA9PT0gbikge1xuICAgICAgaWYgKHZvaWQgMCA9PT0gbCkgbCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfTtlbHNlIGlmIChcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIGwpIHtcbiAgICAgICAgdmFyIHkgPSBsO1xuICAgICAgICBsID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICBmb3IgKHZhciByID0gdCwgYSA9IDA7IGEgPCB5Lmxlbmd0aDsgYSsrKSByID0geVthXS5jYWxsKGUsIHIpO1xuICAgICAgICAgIHJldHVybiByO1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG0gPSBsO1xuICAgICAgICBsID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICByZXR1cm4gbS5jYWxsKGUsIHQpO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgZS5wdXNoKGwpO1xuICAgIH1cbiAgICAwICE9PSBuICYmICgxID09PSBuID8gKGMuZ2V0ID0gdS5nZXQsIGMuc2V0ID0gdS5zZXQpIDogMiA9PT0gbiA/IGMudmFsdWUgPSB1IDogMyA9PT0gbiA/IGMuZ2V0ID0gdSA6IDQgPT09IG4gJiYgKGMuc2V0ID0gdSksIHMgPyAxID09PSBuID8gKGUucHVzaChmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHUuZ2V0LmNhbGwoZSwgdCk7XG4gICAgfSksIGUucHVzaChmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHUuc2V0LmNhbGwoZSwgdCk7XG4gICAgfSkpIDogMiA9PT0gbiA/IGUucHVzaCh1KSA6IGUucHVzaChmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHUuY2FsbChlLCB0KTtcbiAgICB9KSA6IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBhLCBjKSk7XG4gIH1cbiAgZnVuY3Rpb24gcHVzaEluaXRpYWxpemVycyhlLCB0KSB7XG4gICAgdCAmJiBlLnB1c2goZnVuY3Rpb24gKGUpIHtcbiAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgdFtyXS5jYWxsKGUpO1xuICAgICAgcmV0dXJuIGU7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGZ1bmN0aW9uIChlLCB0LCByKSB7XG4gICAgdmFyIGEgPSBbXTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGUsIHQsIHIpIHtcbiAgICAgIGZvciAodmFyIGEsIG4sIGkgPSBuZXcgTWFwKCksIHMgPSBuZXcgTWFwKCksIG8gPSAwOyBvIDwgci5sZW5ndGg7IG8rKykge1xuICAgICAgICB2YXIgYyA9IHJbb107XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGMpKSB7XG4gICAgICAgICAgdmFyIGwsXG4gICAgICAgICAgICB1LFxuICAgICAgICAgICAgZiA9IGNbMV0sXG4gICAgICAgICAgICBwID0gY1syXSxcbiAgICAgICAgICAgIGQgPSBjLmxlbmd0aCA+IDMsXG4gICAgICAgICAgICBoID0gZiA+PSA1O1xuICAgICAgICAgIGlmIChoID8gKGwgPSB0LCAwICE9IChmIC09IDUpICYmICh1ID0gbiA9IG4gfHwgW10pKSA6IChsID0gdC5wcm90b3R5cGUsIDAgIT09IGYgJiYgKHUgPSBhID0gYSB8fCBbXSkpLCAwICE9PSBmICYmICFkKSB7XG4gICAgICAgICAgICB2YXIgdiA9IGggPyBzIDogaSxcbiAgICAgICAgICAgICAgZyA9IHYuZ2V0KHApIHx8IDA7XG4gICAgICAgICAgICBpZiAoITAgPT09IGcgfHwgMyA9PT0gZyAmJiA0ICE9PSBmIHx8IDQgPT09IGcgJiYgMyAhPT0gZikgdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIGRlY29yYXRlIGEgcHVibGljIG1ldGhvZC9hY2Nlc3NvciB0aGF0IGhhcyB0aGUgc2FtZSBuYW1lIGFzIGEgcHJldmlvdXNseSBkZWNvcmF0ZWQgcHVibGljIG1ldGhvZC9hY2Nlc3Nvci4gVGhpcyBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBieSB0aGUgZGVjb3JhdG9ycyBwbHVnaW4uIFByb3BlcnR5IG5hbWUgd2FzOiBcIiArIHApO1xuICAgICAgICAgICAgIWcgJiYgZiA+IDIgPyB2LnNldChwLCBmKSA6IHYuc2V0KHAsICEwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYXBwbHlNZW1iZXJEZWMoZSwgbCwgYywgcCwgZiwgaCwgZCwgdSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHB1c2hJbml0aWFsaXplcnMoZSwgYSksIHB1c2hJbml0aWFsaXplcnMoZSwgbik7XG4gICAgfShhLCBlLCB0KSwgZnVuY3Rpb24gKGUsIHQsIHIpIHtcbiAgICAgIGlmIChyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yICh2YXIgYSA9IFtdLCBuID0gdCwgaSA9IHQubmFtZSwgcyA9IHIubGVuZ3RoIC0gMTsgcyA+PSAwOyBzLS0pIHtcbiAgICAgICAgICB2YXIgbyA9IHtcbiAgICAgICAgICAgIHY6ICExXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGMgPSByW3NdKG4sIHtcbiAgICAgICAgICAgICAga2luZDogXCJjbGFzc1wiLFxuICAgICAgICAgICAgICBuYW1lOiBpLFxuICAgICAgICAgICAgICBhZGRJbml0aWFsaXplcjogY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QoYSwgbylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICBvLnYgPSAhMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdm9pZCAwICE9PSBjICYmIChhc3NlcnRWYWxpZFJldHVyblZhbHVlKDEwLCBjKSwgbiA9IGMpO1xuICAgICAgICB9XG4gICAgICAgIGUucHVzaChuLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCBhLmxlbmd0aDsgZSsrKSBhW2VdLmNhbGwobik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0oYSwgZSwgciksIGE7XG4gIH07XG59XG52YXIgYXBwbHlEZWNzMjIwM0ltcGw7XG5mdW5jdGlvbiBfYXBwbHlEZWNzMjIwMyhlLCB0LCByKSB7XG4gIHJldHVybiAoYXBwbHlEZWNzMjIwM0ltcGwgPSBhcHBseURlY3MyMjAzSW1wbCB8fCBhcHBseURlY3MyMjAzRmFjdG9yeSgpKShlLCB0LCByKTtcbn1cbmZ1bmN0aW9uIGFwcGx5RGVjczIyMDNSRmFjdG9yeSgpIHtcbiAgZnVuY3Rpb24gY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QoZSwgdCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAocikge1xuICAgICAgIWZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIGlmIChlLnYpIHRocm93IG5ldyBFcnJvcihcImF0dGVtcHRlZCB0byBjYWxsIFwiICsgdCArIFwiIGFmdGVyIGRlY29yYXRpb24gd2FzIGZpbmlzaGVkXCIpO1xuICAgICAgfSh0LCBcImFkZEluaXRpYWxpemVyXCIpLCBhc3NlcnRDYWxsYWJsZShyLCBcIkFuIGluaXRpYWxpemVyXCIpLCBlLnB1c2gocik7XG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBtZW1iZXJEZWMoZSwgdCwgciwgbiwgYSwgaSwgcywgbykge1xuICAgIHZhciBjO1xuICAgIHN3aXRjaCAoYSkge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjID0gXCJhY2Nlc3NvclwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYyA9IFwibWV0aG9kXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBjID0gXCJnZXR0ZXJcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGMgPSBcInNldHRlclwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGMgPSBcImZpZWxkXCI7XG4gICAgfVxuICAgIHZhciBsLFxuICAgICAgdSxcbiAgICAgIGYgPSB7XG4gICAgICAgIGtpbmQ6IGMsXG4gICAgICAgIG5hbWU6IHMgPyBcIiNcIiArIHQgOiB0LFxuICAgICAgICBzdGF0aWM6IGksXG4gICAgICAgIHByaXZhdGU6IHNcbiAgICAgIH0sXG4gICAgICBwID0ge1xuICAgICAgICB2OiAhMVxuICAgICAgfTtcbiAgICAwICE9PSBhICYmIChmLmFkZEluaXRpYWxpemVyID0gY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QobiwgcCkpLCAwID09PSBhID8gcyA/IChsID0gci5nZXQsIHUgPSByLnNldCkgOiAobCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzW3RdO1xuICAgIH0sIHUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpc1t0XSA9IGU7XG4gICAgfSkgOiAyID09PSBhID8gbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiByLnZhbHVlO1xuICAgIH0gOiAoMSAhPT0gYSAmJiAzICE9PSBhIHx8IChsID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHIuZ2V0LmNhbGwodGhpcyk7XG4gICAgfSksIDEgIT09IGEgJiYgNCAhPT0gYSB8fCAodSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICByLnNldC5jYWxsKHRoaXMsIGUpO1xuICAgIH0pKSwgZi5hY2Nlc3MgPSBsICYmIHUgPyB7XG4gICAgICBnZXQ6IGwsXG4gICAgICBzZXQ6IHVcbiAgICB9IDogbCA/IHtcbiAgICAgIGdldDogbFxuICAgIH0gOiB7XG4gICAgICBzZXQ6IHVcbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZShvLCBmKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgcC52ID0gITA7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGFzc2VydENhbGxhYmxlKGUsIHQpIHtcbiAgICBpZiAoXCJmdW5jdGlvblwiICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKHQgKyBcIiBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XG4gIH1cbiAgZnVuY3Rpb24gYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZShlLCB0KSB7XG4gICAgdmFyIHIgPSB0eXBlb2YgdDtcbiAgICBpZiAoMSA9PT0gZSkge1xuICAgICAgaWYgKFwib2JqZWN0XCIgIT09IHIgfHwgbnVsbCA9PT0gdCkgdGhyb3cgbmV3IFR5cGVFcnJvcihcImFjY2Vzc29yIGRlY29yYXRvcnMgbXVzdCByZXR1cm4gYW4gb2JqZWN0IHdpdGggZ2V0LCBzZXQsIG9yIGluaXQgcHJvcGVydGllcyBvciB2b2lkIDBcIik7XG4gICAgICB2b2lkIDAgIT09IHQuZ2V0ICYmIGFzc2VydENhbGxhYmxlKHQuZ2V0LCBcImFjY2Vzc29yLmdldFwiKSwgdm9pZCAwICE9PSB0LnNldCAmJiBhc3NlcnRDYWxsYWJsZSh0LnNldCwgXCJhY2Nlc3Nvci5zZXRcIiksIHZvaWQgMCAhPT0gdC5pbml0ICYmIGFzc2VydENhbGxhYmxlKHQuaW5pdCwgXCJhY2Nlc3Nvci5pbml0XCIpO1xuICAgIH0gZWxzZSBpZiAoXCJmdW5jdGlvblwiICE9PSByKSB7XG4gICAgICB2YXIgbjtcbiAgICAgIHRocm93IG4gPSAwID09PSBlID8gXCJmaWVsZFwiIDogMTAgPT09IGUgPyBcImNsYXNzXCIgOiBcIm1ldGhvZFwiLCBuZXcgVHlwZUVycm9yKG4gKyBcIiBkZWNvcmF0b3JzIG11c3QgcmV0dXJuIGEgZnVuY3Rpb24gb3Igdm9pZCAwXCIpO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBhcHBseU1lbWJlckRlYyhlLCB0LCByLCBuLCBhLCBpLCBzLCBvKSB7XG4gICAgdmFyIGMsXG4gICAgICBsLFxuICAgICAgdSxcbiAgICAgIGYsXG4gICAgICBwLFxuICAgICAgZCxcbiAgICAgIGggPSByWzBdO1xuICAgIGlmIChzID8gYyA9IDAgPT09IGEgfHwgMSA9PT0gYSA/IHtcbiAgICAgIGdldDogclszXSxcbiAgICAgIHNldDogcls0XVxuICAgIH0gOiAzID09PSBhID8ge1xuICAgICAgZ2V0OiByWzNdXG4gICAgfSA6IDQgPT09IGEgPyB7XG4gICAgICBzZXQ6IHJbM11cbiAgICB9IDoge1xuICAgICAgdmFsdWU6IHJbM11cbiAgICB9IDogMCAhPT0gYSAmJiAoYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgbikpLCAxID09PSBhID8gdSA9IHtcbiAgICAgIGdldDogYy5nZXQsXG4gICAgICBzZXQ6IGMuc2V0XG4gICAgfSA6IDIgPT09IGEgPyB1ID0gYy52YWx1ZSA6IDMgPT09IGEgPyB1ID0gYy5nZXQgOiA0ID09PSBhICYmICh1ID0gYy5zZXQpLCBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGgpIHZvaWQgMCAhPT0gKGYgPSBtZW1iZXJEZWMoaCwgbiwgYywgbywgYSwgaSwgcywgdSkpICYmIChhc3NlcnRWYWxpZFJldHVyblZhbHVlKGEsIGYpLCAwID09PSBhID8gbCA9IGYgOiAxID09PSBhID8gKGwgPSBmLmluaXQsIHAgPSBmLmdldCB8fCB1LmdldCwgZCA9IGYuc2V0IHx8IHUuc2V0LCB1ID0ge1xuICAgICAgZ2V0OiBwLFxuICAgICAgc2V0OiBkXG4gICAgfSkgOiB1ID0gZik7ZWxzZSBmb3IgKHZhciB2ID0gaC5sZW5ndGggLSAxOyB2ID49IDA7IHYtLSkge1xuICAgICAgdmFyIGc7XG4gICAgICBpZiAodm9pZCAwICE9PSAoZiA9IG1lbWJlckRlYyhoW3ZdLCBuLCBjLCBvLCBhLCBpLCBzLCB1KSkpIGFzc2VydFZhbGlkUmV0dXJuVmFsdWUoYSwgZiksIDAgPT09IGEgPyBnID0gZiA6IDEgPT09IGEgPyAoZyA9IGYuaW5pdCwgcCA9IGYuZ2V0IHx8IHUuZ2V0LCBkID0gZi5zZXQgfHwgdS5zZXQsIHUgPSB7XG4gICAgICAgIGdldDogcCxcbiAgICAgICAgc2V0OiBkXG4gICAgICB9KSA6IHUgPSBmLCB2b2lkIDAgIT09IGcgJiYgKHZvaWQgMCA9PT0gbCA/IGwgPSBnIDogXCJmdW5jdGlvblwiID09IHR5cGVvZiBsID8gbCA9IFtsLCBnXSA6IGwucHVzaChnKSk7XG4gICAgfVxuICAgIGlmICgwID09PSBhIHx8IDEgPT09IGEpIHtcbiAgICAgIGlmICh2b2lkIDAgPT09IGwpIGwgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH07ZWxzZSBpZiAoXCJmdW5jdGlvblwiICE9IHR5cGVvZiBsKSB7XG4gICAgICAgIHZhciB5ID0gbDtcbiAgICAgICAgbCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgZm9yICh2YXIgciA9IHQsIG4gPSAwOyBuIDwgeS5sZW5ndGg7IG4rKykgciA9IHlbbl0uY2FsbChlLCByKTtcbiAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBtID0gbDtcbiAgICAgICAgbCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgcmV0dXJuIG0uY2FsbChlLCB0KTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGUucHVzaChsKTtcbiAgICB9XG4gICAgMCAhPT0gYSAmJiAoMSA9PT0gYSA/IChjLmdldCA9IHUuZ2V0LCBjLnNldCA9IHUuc2V0KSA6IDIgPT09IGEgPyBjLnZhbHVlID0gdSA6IDMgPT09IGEgPyBjLmdldCA9IHUgOiA0ID09PSBhICYmIChjLnNldCA9IHUpLCBzID8gMSA9PT0gYSA/IChlLnB1c2goZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiB1LmdldC5jYWxsKGUsIHQpO1xuICAgIH0pLCBlLnB1c2goZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiB1LnNldC5jYWxsKGUsIHQpO1xuICAgIH0pKSA6IDIgPT09IGEgPyBlLnB1c2godSkgOiBlLnB1c2goZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgIHJldHVybiB1LmNhbGwoZSwgdCk7XG4gICAgfSkgOiBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgbiwgYykpO1xuICB9XG4gIGZ1bmN0aW9uIGFwcGx5TWVtYmVyRGVjcyhlLCB0KSB7XG4gICAgZm9yICh2YXIgciwgbiwgYSA9IFtdLCBpID0gbmV3IE1hcCgpLCBzID0gbmV3IE1hcCgpLCBvID0gMDsgbyA8IHQubGVuZ3RoOyBvKyspIHtcbiAgICAgIHZhciBjID0gdFtvXTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGMpKSB7XG4gICAgICAgIHZhciBsLFxuICAgICAgICAgIHUsXG4gICAgICAgICAgZiA9IGNbMV0sXG4gICAgICAgICAgcCA9IGNbMl0sXG4gICAgICAgICAgZCA9IGMubGVuZ3RoID4gMyxcbiAgICAgICAgICBoID0gZiA+PSA1O1xuICAgICAgICBpZiAoaCA/IChsID0gZSwgMCAhPT0gKGYgLT0gNSkgJiYgKHUgPSBuID0gbiB8fCBbXSkpIDogKGwgPSBlLnByb3RvdHlwZSwgMCAhPT0gZiAmJiAodSA9IHIgPSByIHx8IFtdKSksIDAgIT09IGYgJiYgIWQpIHtcbiAgICAgICAgICB2YXIgdiA9IGggPyBzIDogaSxcbiAgICAgICAgICAgIGcgPSB2LmdldChwKSB8fCAwO1xuICAgICAgICAgIGlmICghMCA9PT0gZyB8fCAzID09PSBnICYmIDQgIT09IGYgfHwgNCA9PT0gZyAmJiAzICE9PSBmKSB0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gZGVjb3JhdGUgYSBwdWJsaWMgbWV0aG9kL2FjY2Vzc29yIHRoYXQgaGFzIHRoZSBzYW1lIG5hbWUgYXMgYSBwcmV2aW91c2x5IGRlY29yYXRlZCBwdWJsaWMgbWV0aG9kL2FjY2Vzc29yLiBUaGlzIGlzIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkIGJ5IHRoZSBkZWNvcmF0b3JzIHBsdWdpbi4gUHJvcGVydHkgbmFtZSB3YXM6IFwiICsgcCk7XG4gICAgICAgICAgIWcgJiYgZiA+IDIgPyB2LnNldChwLCBmKSA6IHYuc2V0KHAsICEwKTtcbiAgICAgICAgfVxuICAgICAgICBhcHBseU1lbWJlckRlYyhhLCBsLCBjLCBwLCBmLCBoLCBkLCB1KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHB1c2hJbml0aWFsaXplcnMoYSwgciksIHB1c2hJbml0aWFsaXplcnMoYSwgbiksIGE7XG4gIH1cbiAgZnVuY3Rpb24gcHVzaEluaXRpYWxpemVycyhlLCB0KSB7XG4gICAgdCAmJiBlLnB1c2goZnVuY3Rpb24gKGUpIHtcbiAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgdFtyXS5jYWxsKGUpO1xuICAgICAgcmV0dXJuIGU7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGZ1bmN0aW9uIChlLCB0LCByKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGU6IGFwcGx5TWVtYmVyRGVjcyhlLCB0KSxcbiAgICAgIGdldCBjKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICBpZiAodC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IgKHZhciByID0gW10sIG4gPSBlLCBhID0gZS5uYW1lLCBpID0gdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICB2YXIgcyA9IHtcbiAgICAgICAgICAgICAgICB2OiAhMVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciBvID0gdFtpXShuLCB7XG4gICAgICAgICAgICAgICAgICBraW5kOiBcImNsYXNzXCIsXG4gICAgICAgICAgICAgICAgICBuYW1lOiBhLFxuICAgICAgICAgICAgICAgICAgYWRkSW5pdGlhbGl6ZXI6IGNyZWF0ZUFkZEluaXRpYWxpemVyTWV0aG9kKHIsIHMpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgcy52ID0gITA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdm9pZCAwICE9PSBvICYmIChhc3NlcnRWYWxpZFJldHVyblZhbHVlKDEwLCBvKSwgbiA9IG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFtuLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgci5sZW5ndGg7IGUrKykgcltlXS5jYWxsKG4pO1xuICAgICAgICAgICAgfV07XG4gICAgICAgICAgfVxuICAgICAgICB9KGUsIHIpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG59XG5mdW5jdGlvbiBfYXBwbHlEZWNzMjIwM1IoZSwgdCwgcikge1xuICByZXR1cm4gKF9hcHBseURlY3MyMjAzUiA9IGFwcGx5RGVjczIyMDNSRmFjdG9yeSgpKShlLCB0LCByKTtcbn1cbmZ1bmN0aW9uIGFwcGx5RGVjczIzMDFGYWN0b3J5KCkge1xuICBmdW5jdGlvbiBjcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChlLCB0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChyKSB7XG4gICAgICAhZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgaWYgKGUudikgdGhyb3cgbmV3IEVycm9yKFwiYXR0ZW1wdGVkIHRvIGNhbGwgXCIgKyB0ICsgXCIgYWZ0ZXIgZGVjb3JhdGlvbiB3YXMgZmluaXNoZWRcIik7XG4gICAgICB9KHQsIFwiYWRkSW5pdGlhbGl6ZXJcIiksIGFzc2VydENhbGxhYmxlKHIsIFwiQW4gaW5pdGlhbGl6ZXJcIiksIGUucHVzaChyKTtcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGFzc2VydEluc3RhbmNlSWZQcml2YXRlKGUsIHQpIHtcbiAgICBpZiAoIWUodCkpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBdHRlbXB0ZWQgdG8gYWNjZXNzIHByaXZhdGUgZWxlbWVudCBvbiBub24taW5zdGFuY2VcIik7XG4gIH1cbiAgZnVuY3Rpb24gbWVtYmVyRGVjKGUsIHQsIHIsIG4sIGEsIGksIHMsIG8sIGMpIHtcbiAgICB2YXIgdTtcbiAgICBzd2l0Y2ggKGEpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgdSA9IFwiYWNjZXNzb3JcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHUgPSBcIm1ldGhvZFwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgdSA9IFwiZ2V0dGVyXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICB1ID0gXCJzZXR0ZXJcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB1ID0gXCJmaWVsZFwiO1xuICAgIH1cbiAgICB2YXIgbCxcbiAgICAgIGYsXG4gICAgICBwID0ge1xuICAgICAgICBraW5kOiB1LFxuICAgICAgICBuYW1lOiBzID8gXCIjXCIgKyB0IDogdCxcbiAgICAgICAgc3RhdGljOiBpLFxuICAgICAgICBwcml2YXRlOiBzXG4gICAgICB9LFxuICAgICAgZCA9IHtcbiAgICAgICAgdjogITFcbiAgICAgIH07XG4gICAgaWYgKDAgIT09IGEgJiYgKHAuYWRkSW5pdGlhbGl6ZXIgPSBjcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChuLCBkKSksIHMgfHwgMCAhPT0gYSAmJiAyICE9PSBhKSB7XG4gICAgICBpZiAoMiA9PT0gYSkgbCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBhc3NlcnRJbnN0YW5jZUlmUHJpdmF0ZShjLCBlKSwgci52YWx1ZTtcbiAgICAgIH07ZWxzZSB7XG4gICAgICAgIHZhciBoID0gMCA9PT0gYSB8fCAxID09PSBhO1xuICAgICAgICAoaCB8fCAzID09PSBhKSAmJiAobCA9IHMgPyBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBhc3NlcnRJbnN0YW5jZUlmUHJpdmF0ZShjLCBlKSwgci5nZXQuY2FsbChlKTtcbiAgICAgICAgfSA6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIHIuZ2V0LmNhbGwoZSk7XG4gICAgICAgIH0pLCAoaCB8fCA0ID09PSBhKSAmJiAoZiA9IHMgPyBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgIGFzc2VydEluc3RhbmNlSWZQcml2YXRlKGMsIGUpLCByLnNldC5jYWxsKGUsIHQpO1xuICAgICAgICB9IDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgICByLnNldC5jYWxsKGUsIHQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgbCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gZVt0XTtcbiAgICB9LCAwID09PSBhICYmIChmID0gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgIGVbdF0gPSByO1xuICAgIH0pO1xuICAgIHZhciB2ID0gcyA/IGMuYmluZCgpIDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiB0IGluIGU7XG4gICAgfTtcbiAgICBwLmFjY2VzcyA9IGwgJiYgZiA/IHtcbiAgICAgIGdldDogbCxcbiAgICAgIHNldDogZixcbiAgICAgIGhhczogdlxuICAgIH0gOiBsID8ge1xuICAgICAgZ2V0OiBsLFxuICAgICAgaGFzOiB2XG4gICAgfSA6IHtcbiAgICAgIHNldDogZixcbiAgICAgIGhhczogdlxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBlKG8sIHApO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBkLnYgPSAhMDtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gYXNzZXJ0Q2FsbGFibGUoZSwgdCkge1xuICAgIGlmIChcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IodCArIFwiIG11c3QgYmUgYSBmdW5jdGlvblwiKTtcbiAgfVxuICBmdW5jdGlvbiBhc3NlcnRWYWxpZFJldHVyblZhbHVlKGUsIHQpIHtcbiAgICB2YXIgciA9IHR5cGVvZiB0O1xuICAgIGlmICgxID09PSBlKSB7XG4gICAgICBpZiAoXCJvYmplY3RcIiAhPT0gciB8fCBudWxsID09PSB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYWNjZXNzb3IgZGVjb3JhdG9ycyBtdXN0IHJldHVybiBhbiBvYmplY3Qgd2l0aCBnZXQsIHNldCwgb3IgaW5pdCBwcm9wZXJ0aWVzIG9yIHZvaWQgMFwiKTtcbiAgICAgIHZvaWQgMCAhPT0gdC5nZXQgJiYgYXNzZXJ0Q2FsbGFibGUodC5nZXQsIFwiYWNjZXNzb3IuZ2V0XCIpLCB2b2lkIDAgIT09IHQuc2V0ICYmIGFzc2VydENhbGxhYmxlKHQuc2V0LCBcImFjY2Vzc29yLnNldFwiKSwgdm9pZCAwICE9PSB0LmluaXQgJiYgYXNzZXJ0Q2FsbGFibGUodC5pbml0LCBcImFjY2Vzc29yLmluaXRcIik7XG4gICAgfSBlbHNlIGlmIChcImZ1bmN0aW9uXCIgIT09IHIpIHtcbiAgICAgIHZhciBuO1xuICAgICAgdGhyb3cgbiA9IDAgPT09IGUgPyBcImZpZWxkXCIgOiAxMCA9PT0gZSA/IFwiY2xhc3NcIiA6IFwibWV0aG9kXCIsIG5ldyBUeXBlRXJyb3IobiArIFwiIGRlY29yYXRvcnMgbXVzdCByZXR1cm4gYSBmdW5jdGlvbiBvciB2b2lkIDBcIik7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGN1cnJ5VGhpczIoZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgICAgZSh0aGlzLCB0KTtcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGFwcGx5TWVtYmVyRGVjKGUsIHQsIHIsIG4sIGEsIGksIHMsIG8sIGMpIHtcbiAgICB2YXIgdSxcbiAgICAgIGwsXG4gICAgICBmLFxuICAgICAgcCxcbiAgICAgIGQsXG4gICAgICBoLFxuICAgICAgdixcbiAgICAgIGcgPSByWzBdO1xuICAgIGlmIChzID8gdSA9IDAgPT09IGEgfHwgMSA9PT0gYSA/IHtcbiAgICAgIGdldDogKHAgPSByWzNdLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwKHRoaXMpO1xuICAgICAgfSksXG4gICAgICBzZXQ6IGN1cnJ5VGhpczIocls0XSlcbiAgICB9IDogMyA9PT0gYSA/IHtcbiAgICAgIGdldDogclszXVxuICAgIH0gOiA0ID09PSBhID8ge1xuICAgICAgc2V0OiByWzNdXG4gICAgfSA6IHtcbiAgICAgIHZhbHVlOiByWzNdXG4gICAgfSA6IDAgIT09IGEgJiYgKHUgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIG4pKSwgMSA9PT0gYSA/IGYgPSB7XG4gICAgICBnZXQ6IHUuZ2V0LFxuICAgICAgc2V0OiB1LnNldFxuICAgIH0gOiAyID09PSBhID8gZiA9IHUudmFsdWUgOiAzID09PSBhID8gZiA9IHUuZ2V0IDogNCA9PT0gYSAmJiAoZiA9IHUuc2V0KSwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBnKSB2b2lkIDAgIT09IChkID0gbWVtYmVyRGVjKGcsIG4sIHUsIG8sIGEsIGksIHMsIGYsIGMpKSAmJiAoYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZShhLCBkKSwgMCA9PT0gYSA/IGwgPSBkIDogMSA9PT0gYSA/IChsID0gZC5pbml0LCBoID0gZC5nZXQgfHwgZi5nZXQsIHYgPSBkLnNldCB8fCBmLnNldCwgZiA9IHtcbiAgICAgIGdldDogaCxcbiAgICAgIHNldDogdlxuICAgIH0pIDogZiA9IGQpO2Vsc2UgZm9yICh2YXIgeSA9IGcubGVuZ3RoIC0gMTsgeSA+PSAwOyB5LS0pIHtcbiAgICAgIHZhciBtO1xuICAgICAgaWYgKHZvaWQgMCAhPT0gKGQgPSBtZW1iZXJEZWMoZ1t5XSwgbiwgdSwgbywgYSwgaSwgcywgZiwgYykpKSBhc3NlcnRWYWxpZFJldHVyblZhbHVlKGEsIGQpLCAwID09PSBhID8gbSA9IGQgOiAxID09PSBhID8gKG0gPSBkLmluaXQsIGggPSBkLmdldCB8fCBmLmdldCwgdiA9IGQuc2V0IHx8IGYuc2V0LCBmID0ge1xuICAgICAgICBnZXQ6IGgsXG4gICAgICAgIHNldDogdlxuICAgICAgfSkgOiBmID0gZCwgdm9pZCAwICE9PSBtICYmICh2b2lkIDAgPT09IGwgPyBsID0gbSA6IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgbCA/IGwgPSBbbCwgbV0gOiBsLnB1c2gobSkpO1xuICAgIH1cbiAgICBpZiAoMCA9PT0gYSB8fCAxID09PSBhKSB7XG4gICAgICBpZiAodm9pZCAwID09PSBsKSBsID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgICB9O2Vsc2UgaWYgKFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgbCkge1xuICAgICAgICB2YXIgYiA9IGw7XG4gICAgICAgIGwgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgIGZvciAodmFyIHIgPSB0LCBuID0gMDsgbiA8IGIubGVuZ3RoOyBuKyspIHIgPSBiW25dLmNhbGwoZSwgcik7XG4gICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgSSA9IGw7XG4gICAgICAgIGwgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgIHJldHVybiBJLmNhbGwoZSwgdCk7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBlLnB1c2gobCk7XG4gICAgfVxuICAgIDAgIT09IGEgJiYgKDEgPT09IGEgPyAodS5nZXQgPSBmLmdldCwgdS5zZXQgPSBmLnNldCkgOiAyID09PSBhID8gdS52YWx1ZSA9IGYgOiAzID09PSBhID8gdS5nZXQgPSBmIDogNCA9PT0gYSAmJiAodS5zZXQgPSBmKSwgcyA/IDEgPT09IGEgPyAoZS5wdXNoKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4gZi5nZXQuY2FsbChlLCB0KTtcbiAgICB9KSwgZS5wdXNoKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4gZi5zZXQuY2FsbChlLCB0KTtcbiAgICB9KSkgOiAyID09PSBhID8gZS5wdXNoKGYpIDogZS5wdXNoKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICByZXR1cm4gZi5jYWxsKGUsIHQpO1xuICAgIH0pIDogT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIG4sIHUpKTtcbiAgfVxuICBmdW5jdGlvbiBhcHBseU1lbWJlckRlY3MoZSwgdCwgcikge1xuICAgIGZvciAodmFyIG4sIGEsIGksIHMgPSBbXSwgbyA9IG5ldyBNYXAoKSwgYyA9IG5ldyBNYXAoKSwgdSA9IDA7IHUgPCB0Lmxlbmd0aDsgdSsrKSB7XG4gICAgICB2YXIgbCA9IHRbdV07XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShsKSkge1xuICAgICAgICB2YXIgZixcbiAgICAgICAgICBwLFxuICAgICAgICAgIGQgPSBsWzFdLFxuICAgICAgICAgIGggPSBsWzJdLFxuICAgICAgICAgIHYgPSBsLmxlbmd0aCA+IDMsXG4gICAgICAgICAgZyA9IGQgPj0gNSxcbiAgICAgICAgICB5ID0gcjtcbiAgICAgICAgaWYgKGcgPyAoZiA9IGUsIDAgIT09IChkIC09IDUpICYmIChwID0gYSA9IGEgfHwgW10pLCB2ICYmICFpICYmIChpID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICByZXR1cm4gX2NoZWNrSW5SSFModCkgPT09IGU7XG4gICAgICAgIH0pLCB5ID0gaSkgOiAoZiA9IGUucHJvdG90eXBlLCAwICE9PSBkICYmIChwID0gbiA9IG4gfHwgW10pKSwgMCAhPT0gZCAmJiAhdikge1xuICAgICAgICAgIHZhciBtID0gZyA/IGMgOiBvLFxuICAgICAgICAgICAgYiA9IG0uZ2V0KGgpIHx8IDA7XG4gICAgICAgICAgaWYgKCEwID09PSBiIHx8IDMgPT09IGIgJiYgNCAhPT0gZCB8fCA0ID09PSBiICYmIDMgIT09IGQpIHRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBkZWNvcmF0ZSBhIHB1YmxpYyBtZXRob2QvYWNjZXNzb3IgdGhhdCBoYXMgdGhlIHNhbWUgbmFtZSBhcyBhIHByZXZpb3VzbHkgZGVjb3JhdGVkIHB1YmxpYyBtZXRob2QvYWNjZXNzb3IuIFRoaXMgaXMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgYnkgdGhlIGRlY29yYXRvcnMgcGx1Z2luLiBQcm9wZXJ0eSBuYW1lIHdhczogXCIgKyBoKTtcbiAgICAgICAgICAhYiAmJiBkID4gMiA/IG0uc2V0KGgsIGQpIDogbS5zZXQoaCwgITApO1xuICAgICAgICB9XG4gICAgICAgIGFwcGx5TWVtYmVyRGVjKHMsIGYsIGwsIGgsIGQsIGcsIHYsIHAsIHkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcHVzaEluaXRpYWxpemVycyhzLCBuKSwgcHVzaEluaXRpYWxpemVycyhzLCBhKSwgcztcbiAgfVxuICBmdW5jdGlvbiBwdXNoSW5pdGlhbGl6ZXJzKGUsIHQpIHtcbiAgICB0ICYmIGUucHVzaChmdW5jdGlvbiAoZSkge1xuICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB0W3JdLmNhbGwoZSk7XG4gICAgICByZXR1cm4gZTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gZnVuY3Rpb24gKGUsIHQsIHIsIG4pIHtcbiAgICByZXR1cm4ge1xuICAgICAgZTogYXBwbHlNZW1iZXJEZWNzKGUsIHQsIG4pLFxuICAgICAgZ2V0IGMoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgIGlmICh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIHIgPSBbXSwgbiA9IGUsIGEgPSBlLm5hbWUsIGkgPSB0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgIHZhciBzID0ge1xuICAgICAgICAgICAgICAgIHY6ICExXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIG8gPSB0W2ldKG4sIHtcbiAgICAgICAgICAgICAgICAgIGtpbmQ6IFwiY2xhc3NcIixcbiAgICAgICAgICAgICAgICAgIG5hbWU6IGEsXG4gICAgICAgICAgICAgICAgICBhZGRJbml0aWFsaXplcjogY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QociwgcylcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBzLnYgPSAhMDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB2b2lkIDAgIT09IG8gJiYgKGFzc2VydFZhbGlkUmV0dXJuVmFsdWUoMTAsIG8pLCBuID0gbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW24sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCByLmxlbmd0aDsgZSsrKSByW2VdLmNhbGwobik7XG4gICAgICAgICAgICB9XTtcbiAgICAgICAgICB9XG4gICAgICAgIH0oZSwgcik7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cbmZ1bmN0aW9uIF9hcHBseURlY3MyMzAxKGUsIHQsIHIsIG4pIHtcbiAgcmV0dXJuIChfYXBwbHlEZWNzMjMwMSA9IGFwcGx5RGVjczIzMDFGYWN0b3J5KCkpKGUsIHQsIHIsIG4pO1xufVxuZnVuY3Rpb24gY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QoZSwgdCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHIpIHtcbiAgICBhc3NlcnROb3RGaW5pc2hlZCh0LCBcImFkZEluaXRpYWxpemVyXCIpLCBhc3NlcnRDYWxsYWJsZShyLCBcIkFuIGluaXRpYWxpemVyXCIpLCBlLnB1c2gocik7XG4gIH07XG59XG5mdW5jdGlvbiBhc3NlcnRJbnN0YW5jZUlmUHJpdmF0ZShlLCB0KSB7XG4gIGlmICghZSh0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkF0dGVtcHRlZCB0byBhY2Nlc3MgcHJpdmF0ZSBlbGVtZW50IG9uIG5vbi1pbnN0YW5jZVwiKTtcbn1cbmZ1bmN0aW9uIG1lbWJlckRlYyhlLCB0LCByLCBuLCBhLCBpLCBzLCBvLCBjLCBsKSB7XG4gIHZhciB1O1xuICBzd2l0Y2ggKGkpIHtcbiAgICBjYXNlIDE6XG4gICAgICB1ID0gXCJhY2Nlc3NvclwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAyOlxuICAgICAgdSA9IFwibWV0aG9kXCI7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDM6XG4gICAgICB1ID0gXCJnZXR0ZXJcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgNDpcbiAgICAgIHUgPSBcInNldHRlclwiO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHUgPSBcImZpZWxkXCI7XG4gIH1cbiAgdmFyIGYsXG4gICAgZCxcbiAgICBwID0ge1xuICAgICAga2luZDogdSxcbiAgICAgIG5hbWU6IG8gPyBcIiNcIiArIHIgOiByLFxuICAgICAgc3RhdGljOiBzLFxuICAgICAgcHJpdmF0ZTogb1xuICAgIH0sXG4gICAgaCA9IHtcbiAgICAgIHY6ICExXG4gICAgfTtcbiAgaWYgKDAgIT09IGkgJiYgKHAuYWRkSW5pdGlhbGl6ZXIgPSBjcmVhdGVBZGRJbml0aWFsaXplck1ldGhvZChhLCBoKSksIG8gfHwgMCAhPT0gaSAmJiAyICE9PSBpKSB7XG4gICAgaWYgKDIgPT09IGkpIGYgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGFzc2VydEluc3RhbmNlSWZQcml2YXRlKGwsIGUpLCBuLnZhbHVlO1xuICAgIH07ZWxzZSB7XG4gICAgICB2YXIgdiA9IDAgPT09IGkgfHwgMSA9PT0gaTtcbiAgICAgICh2IHx8IDMgPT09IGkpICYmIChmID0gbyA/IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBhc3NlcnRJbnN0YW5jZUlmUHJpdmF0ZShsLCBlKSwgbi5nZXQuY2FsbChlKTtcbiAgICAgIH0gOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXR1cm4gbi5nZXQuY2FsbChlKTtcbiAgICAgIH0pLCAodiB8fCA0ID09PSBpKSAmJiAoZCA9IG8gPyBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICBhc3NlcnRJbnN0YW5jZUlmUHJpdmF0ZShsLCBlKSwgbi5zZXQuY2FsbChlLCB0KTtcbiAgICAgIH0gOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICBuLnNldC5jYWxsKGUsIHQpO1xuICAgICAgfSk7XG4gICAgfVxuICB9IGVsc2UgZiA9IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIGVbcl07XG4gIH0sIDAgPT09IGkgJiYgKGQgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgIGVbcl0gPSB0O1xuICB9KTtcbiAgdmFyIHkgPSBvID8gbC5iaW5kKCkgOiBmdW5jdGlvbiAoZSkge1xuICAgIHJldHVybiByIGluIGU7XG4gIH07XG4gIHAuYWNjZXNzID0gZiAmJiBkID8ge1xuICAgIGdldDogZixcbiAgICBzZXQ6IGQsXG4gICAgaGFzOiB5XG4gIH0gOiBmID8ge1xuICAgIGdldDogZixcbiAgICBoYXM6IHlcbiAgfSA6IHtcbiAgICBzZXQ6IGQsXG4gICAgaGFzOiB5XG4gIH07XG4gIHRyeSB7XG4gICAgcmV0dXJuIGUuY2FsbCh0LCBjLCBwKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBoLnYgPSAhMDtcbiAgfVxufVxuZnVuY3Rpb24gYXNzZXJ0Tm90RmluaXNoZWQoZSwgdCkge1xuICBpZiAoZS52KSB0aHJvdyBuZXcgRXJyb3IoXCJhdHRlbXB0ZWQgdG8gY2FsbCBcIiArIHQgKyBcIiBhZnRlciBkZWNvcmF0aW9uIHdhcyBmaW5pc2hlZFwiKTtcbn1cbmZ1bmN0aW9uIGFzc2VydENhbGxhYmxlKGUsIHQpIHtcbiAgaWYgKFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgZSkgdGhyb3cgbmV3IFR5cGVFcnJvcih0ICsgXCIgbXVzdCBiZSBhIGZ1bmN0aW9uXCIpO1xufVxuZnVuY3Rpb24gYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZShlLCB0KSB7XG4gIHZhciByID0gdHlwZW9mIHQ7XG4gIGlmICgxID09PSBlKSB7XG4gICAgaWYgKFwib2JqZWN0XCIgIT09IHIgfHwgbnVsbCA9PT0gdCkgdGhyb3cgbmV3IFR5cGVFcnJvcihcImFjY2Vzc29yIGRlY29yYXRvcnMgbXVzdCByZXR1cm4gYW4gb2JqZWN0IHdpdGggZ2V0LCBzZXQsIG9yIGluaXQgcHJvcGVydGllcyBvciB2b2lkIDBcIik7XG4gICAgdm9pZCAwICE9PSB0LmdldCAmJiBhc3NlcnRDYWxsYWJsZSh0LmdldCwgXCJhY2Nlc3Nvci5nZXRcIiksIHZvaWQgMCAhPT0gdC5zZXQgJiYgYXNzZXJ0Q2FsbGFibGUodC5zZXQsIFwiYWNjZXNzb3Iuc2V0XCIpLCB2b2lkIDAgIT09IHQuaW5pdCAmJiBhc3NlcnRDYWxsYWJsZSh0LmluaXQsIFwiYWNjZXNzb3IuaW5pdFwiKTtcbiAgfSBlbHNlIGlmIChcImZ1bmN0aW9uXCIgIT09IHIpIHtcbiAgICB2YXIgbjtcbiAgICB0aHJvdyBuID0gMCA9PT0gZSA/IFwiZmllbGRcIiA6IDUgPT09IGUgPyBcImNsYXNzXCIgOiBcIm1ldGhvZFwiLCBuZXcgVHlwZUVycm9yKG4gKyBcIiBkZWNvcmF0b3JzIG11c3QgcmV0dXJuIGEgZnVuY3Rpb24gb3Igdm9pZCAwXCIpO1xuICB9XG59XG5mdW5jdGlvbiBjdXJyeVRoaXMxKGUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZSh0aGlzKTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGN1cnJ5VGhpczIoZSkge1xuICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICBlKHRoaXMsIHQpO1xuICB9O1xufVxuZnVuY3Rpb24gYXBwbHlNZW1iZXJEZWMoZSwgdCwgciwgbiwgYSwgaSwgcywgbywgYywgbCkge1xuICB2YXIgdSxcbiAgICBmLFxuICAgIGQsXG4gICAgcCxcbiAgICBoLFxuICAgIHYsXG4gICAgeSA9IHJbMF07XG4gIG4gfHwgQXJyYXkuaXNBcnJheSh5KSB8fCAoeSA9IFt5XSksIG8gPyB1ID0gMCA9PT0gaSB8fCAxID09PSBpID8ge1xuICAgIGdldDogY3VycnlUaGlzMShyWzNdKSxcbiAgICBzZXQ6IGN1cnJ5VGhpczIocls0XSlcbiAgfSA6IDMgPT09IGkgPyB7XG4gICAgZ2V0OiByWzNdXG4gIH0gOiA0ID09PSBpID8ge1xuICAgIHNldDogclszXVxuICB9IDoge1xuICAgIHZhbHVlOiByWzNdXG4gIH0gOiAwICE9PSBpICYmICh1ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCBhKSksIDEgPT09IGkgPyBkID0ge1xuICAgIGdldDogdS5nZXQsXG4gICAgc2V0OiB1LnNldFxuICB9IDogMiA9PT0gaSA/IGQgPSB1LnZhbHVlIDogMyA9PT0gaSA/IGQgPSB1LmdldCA6IDQgPT09IGkgJiYgKGQgPSB1LnNldCk7XG4gIGZvciAodmFyIGcgPSBuID8gMiA6IDEsIG0gPSB5Lmxlbmd0aCAtIDE7IG0gPj0gMDsgbSAtPSBnKSB7XG4gICAgdmFyIGI7XG4gICAgaWYgKHZvaWQgMCAhPT0gKHAgPSBtZW1iZXJEZWMoeVttXSwgbiA/IHlbbSAtIDFdIDogdm9pZCAwLCBhLCB1LCBjLCBpLCBzLCBvLCBkLCBsKSkpIGFzc2VydFZhbGlkUmV0dXJuVmFsdWUoaSwgcCksIDAgPT09IGkgPyBiID0gcCA6IDEgPT09IGkgPyAoYiA9IHAuaW5pdCwgaCA9IHAuZ2V0IHx8IGQuZ2V0LCB2ID0gcC5zZXQgfHwgZC5zZXQsIGQgPSB7XG4gICAgICBnZXQ6IGgsXG4gICAgICBzZXQ6IHZcbiAgICB9KSA6IGQgPSBwLCB2b2lkIDAgIT09IGIgJiYgKHZvaWQgMCA9PT0gZiA/IGYgPSBiIDogXCJmdW5jdGlvblwiID09IHR5cGVvZiBmID8gZiA9IFtmLCBiXSA6IGYucHVzaChiKSk7XG4gIH1cbiAgaWYgKDAgPT09IGkgfHwgMSA9PT0gaSkge1xuICAgIGlmICh2b2lkIDAgPT09IGYpIGYgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgcmV0dXJuIHQ7XG4gICAgfTtlbHNlIGlmIChcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIGYpIHtcbiAgICAgIHZhciBJID0gZjtcbiAgICAgIGYgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICBmb3IgKHZhciByID0gdCwgbiA9IEkubGVuZ3RoIC0gMTsgbiA+PSAwOyBuLS0pIHIgPSBJW25dLmNhbGwoZSwgcik7XG4gICAgICAgIHJldHVybiByO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHcgPSBmO1xuICAgICAgZiA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHJldHVybiB3LmNhbGwoZSwgdCk7XG4gICAgICB9O1xuICAgIH1cbiAgICBlLnB1c2goZik7XG4gIH1cbiAgMCAhPT0gaSAmJiAoMSA9PT0gaSA/ICh1LmdldCA9IGQuZ2V0LCB1LnNldCA9IGQuc2V0KSA6IDIgPT09IGkgPyB1LnZhbHVlID0gZCA6IDMgPT09IGkgPyB1LmdldCA9IGQgOiA0ID09PSBpICYmICh1LnNldCA9IGQpLCBvID8gMSA9PT0gaSA/IChlLnB1c2goZnVuY3Rpb24gKGUsIHQpIHtcbiAgICByZXR1cm4gZC5nZXQuY2FsbChlLCB0KTtcbiAgfSksIGUucHVzaChmdW5jdGlvbiAoZSwgdCkge1xuICAgIHJldHVybiBkLnNldC5jYWxsKGUsIHQpO1xuICB9KSkgOiAyID09PSBpID8gZS5wdXNoKGQpIDogZS5wdXNoKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgcmV0dXJuIGQuY2FsbChlLCB0KTtcbiAgfSkgOiBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgYSwgdSkpO1xufVxuZnVuY3Rpb24gYXBwbHlNZW1iZXJEZWNzKGUsIHQsIHIpIHtcbiAgZm9yICh2YXIgbiwgYSwgaSwgcyA9IFtdLCBvID0gbmV3IE1hcCgpLCBjID0gbmV3IE1hcCgpLCBsID0gMDsgbCA8IHQubGVuZ3RoOyBsKyspIHtcbiAgICB2YXIgdSA9IHRbbF07XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodSkpIHtcbiAgICAgIHZhciBmLFxuICAgICAgICBkLFxuICAgICAgICBwID0gdVsxXSxcbiAgICAgICAgaCA9IHVbMl0sXG4gICAgICAgIHYgPSB1Lmxlbmd0aCA+IDMsXG4gICAgICAgIHkgPSAxNiAmIHAsXG4gICAgICAgIGcgPSAhISg4ICYgcCksXG4gICAgICAgIG0gPSByO1xuICAgICAgaWYgKHAgJj0gNywgZyA/IChmID0gZSwgMCAhPT0gcCAmJiAoZCA9IGEgPSBhIHx8IFtdKSwgdiAmJiAhaSAmJiAoaSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHJldHVybiBfY2hlY2tJblJIUyh0KSA9PT0gZTtcbiAgICAgIH0pLCBtID0gaSkgOiAoZiA9IGUucHJvdG90eXBlLCAwICE9PSBwICYmIChkID0gbiA9IG4gfHwgW10pKSwgMCAhPT0gcCAmJiAhdikge1xuICAgICAgICB2YXIgYiA9IGcgPyBjIDogbyxcbiAgICAgICAgICBJID0gYi5nZXQoaCkgfHwgMDtcbiAgICAgICAgaWYgKCEwID09PSBJIHx8IDMgPT09IEkgJiYgNCAhPT0gcCB8fCA0ID09PSBJICYmIDMgIT09IHApIHRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBkZWNvcmF0ZSBhIHB1YmxpYyBtZXRob2QvYWNjZXNzb3IgdGhhdCBoYXMgdGhlIHNhbWUgbmFtZSBhcyBhIHByZXZpb3VzbHkgZGVjb3JhdGVkIHB1YmxpYyBtZXRob2QvYWNjZXNzb3IuIFRoaXMgaXMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgYnkgdGhlIGRlY29yYXRvcnMgcGx1Z2luLiBQcm9wZXJ0eSBuYW1lIHdhczogXCIgKyBoKTtcbiAgICAgICAgYi5zZXQoaCwgISghSSAmJiBwID4gMikgfHwgcCk7XG4gICAgICB9XG4gICAgICBhcHBseU1lbWJlckRlYyhzLCBmLCB1LCB5LCBoLCBwLCBnLCB2LCBkLCBtKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHB1c2hJbml0aWFsaXplcnMocywgbiksIHB1c2hJbml0aWFsaXplcnMocywgYSksIHM7XG59XG5mdW5jdGlvbiBwdXNoSW5pdGlhbGl6ZXJzKGUsIHQpIHtcbiAgdCAmJiBlLnB1c2goZnVuY3Rpb24gKGUpIHtcbiAgICBmb3IgKHZhciByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHRbcl0uY2FsbChlKTtcbiAgICByZXR1cm4gZTtcbiAgfSk7XG59XG5mdW5jdGlvbiBhcHBseUNsYXNzRGVjcyhlLCB0LCByKSB7XG4gIGlmICh0Lmxlbmd0aCkge1xuICAgIGZvciAodmFyIG4gPSBbXSwgYSA9IGUsIGkgPSBlLm5hbWUsIHMgPSByID8gMiA6IDEsIG8gPSB0Lmxlbmd0aCAtIDE7IG8gPj0gMDsgbyAtPSBzKSB7XG4gICAgICB2YXIgYyA9IHtcbiAgICAgICAgdjogITFcbiAgICAgIH07XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgbCA9IHRbb10uY2FsbChyID8gdFtvIC0gMV0gOiB2b2lkIDAsIGEsIHtcbiAgICAgICAgICBraW5kOiBcImNsYXNzXCIsXG4gICAgICAgICAgbmFtZTogaSxcbiAgICAgICAgICBhZGRJbml0aWFsaXplcjogY3JlYXRlQWRkSW5pdGlhbGl6ZXJNZXRob2QobiwgYylcbiAgICAgICAgfSk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBjLnYgPSAhMDtcbiAgICAgIH1cbiAgICAgIHZvaWQgMCAhPT0gbCAmJiAoYXNzZXJ0VmFsaWRSZXR1cm5WYWx1ZSg1LCBsKSwgYSA9IGwpO1xuICAgIH1cbiAgICByZXR1cm4gW2EsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgbi5sZW5ndGg7IGUrKykgbltlXS5jYWxsKGEpO1xuICAgIH1dO1xuICB9XG59XG5mdW5jdGlvbiBfYXBwbHlEZWNzMjMwNShlLCB0LCByLCBuLCBhKSB7XG4gIHJldHVybiB7XG4gICAgZTogYXBwbHlNZW1iZXJEZWNzKGUsIHQsIGEpLFxuICAgIGdldCBjKCkge1xuICAgICAgcmV0dXJuIGFwcGx5Q2xhc3NEZWNzKGUsIHIsIG4pO1xuICAgIH1cbiAgfTtcbn1cbmZ1bmN0aW9uIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlKHQpIHtcbiAgdmFyIGUgPSB7fSxcbiAgICBuID0gITE7XG4gIGZ1bmN0aW9uIHB1bXAoZSwgcikge1xuICAgIHJldHVybiBuID0gITAsIHIgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAobikge1xuICAgICAgbih0W2VdKHIpKTtcbiAgICB9KSwge1xuICAgICAgZG9uZTogITEsXG4gICAgICB2YWx1ZTogbmV3IF9PdmVybG9hZFlpZWxkKHIsIDEpXG4gICAgfTtcbiAgfVxuICByZXR1cm4gZVtcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sLml0ZXJhdG9yIHx8IFwiQEBpdGVyYXRvclwiXSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfSwgZS5uZXh0ID0gZnVuY3Rpb24gKHQpIHtcbiAgICByZXR1cm4gbiA/IChuID0gITEsIHQpIDogcHVtcChcIm5leHRcIiwgdCk7XG4gIH0sIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdC50aHJvdyAmJiAoZS50aHJvdyA9IGZ1bmN0aW9uICh0KSB7XG4gICAgaWYgKG4pIHRocm93IG4gPSAhMSwgdDtcbiAgICByZXR1cm4gcHVtcChcInRocm93XCIsIHQpO1xuICB9KSwgXCJmdW5jdGlvblwiID09IHR5cGVvZiB0LnJldHVybiAmJiAoZS5yZXR1cm4gPSBmdW5jdGlvbiAodCkge1xuICAgIHJldHVybiBuID8gKG4gPSAhMSwgdCkgOiBwdW1wKFwicmV0dXJuXCIsIHQpO1xuICB9KSwgZTtcbn1cbmZ1bmN0aW9uIF9hc3luY0l0ZXJhdG9yKHIpIHtcbiAgdmFyIG4sXG4gICAgdCxcbiAgICBvLFxuICAgIGUgPSAyO1xuICBmb3IgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIFN5bWJvbCAmJiAodCA9IFN5bWJvbC5hc3luY0l0ZXJhdG9yLCBvID0gU3ltYm9sLml0ZXJhdG9yKTsgZS0tOykge1xuICAgIGlmICh0ICYmIG51bGwgIT0gKG4gPSByW3RdKSkgcmV0dXJuIG4uY2FsbChyKTtcbiAgICBpZiAobyAmJiBudWxsICE9IChuID0gcltvXSkpIHJldHVybiBuZXcgQXN5bmNGcm9tU3luY0l0ZXJhdG9yKG4uY2FsbChyKSk7XG4gICAgdCA9IFwiQEBhc3luY0l0ZXJhdG9yXCIsIG8gPSBcIkBAaXRlcmF0b3JcIjtcbiAgfVxuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IGlzIG5vdCBhc3luYyBpdGVyYWJsZVwiKTtcbn1cbmZ1bmN0aW9uIEFzeW5jRnJvbVN5bmNJdGVyYXRvcihyKSB7XG4gIGZ1bmN0aW9uIEFzeW5jRnJvbVN5bmNJdGVyYXRvckNvbnRpbnVhdGlvbihyKSB7XG4gICAgaWYgKE9iamVjdChyKSAhPT0gcikgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBUeXBlRXJyb3IociArIFwiIGlzIG5vdCBhbiBvYmplY3QuXCIpKTtcbiAgICB2YXIgbiA9IHIuZG9uZTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiByLFxuICAgICAgICBkb25lOiBuXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG4gIHJldHVybiBBc3luY0Zyb21TeW5jSXRlcmF0b3IgPSBmdW5jdGlvbiAocikge1xuICAgIHRoaXMucyA9IHIsIHRoaXMubiA9IHIubmV4dDtcbiAgfSwgQXN5bmNGcm9tU3luY0l0ZXJhdG9yLnByb3RvdHlwZSA9IHtcbiAgICBzOiBudWxsLFxuICAgIG46IG51bGwsXG4gICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIEFzeW5jRnJvbVN5bmNJdGVyYXRvckNvbnRpbnVhdGlvbih0aGlzLm4uYXBwbHkodGhpcy5zLCBhcmd1bWVudHMpKTtcbiAgICB9LFxuICAgIHJldHVybjogZnVuY3Rpb24gKHIpIHtcbiAgICAgIHZhciBuID0gdGhpcy5zLnJldHVybjtcbiAgICAgIHJldHVybiB2b2lkIDAgPT09IG4gPyBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICB2YWx1ZTogcixcbiAgICAgICAgZG9uZTogITBcbiAgICAgIH0pIDogQXN5bmNGcm9tU3luY0l0ZXJhdG9yQ29udGludWF0aW9uKG4uYXBwbHkodGhpcy5zLCBhcmd1bWVudHMpKTtcbiAgICB9LFxuICAgIHRocm93OiBmdW5jdGlvbiAocikge1xuICAgICAgdmFyIG4gPSB0aGlzLnMucmV0dXJuO1xuICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gbiA/IFByb21pc2UucmVqZWN0KHIpIDogQXN5bmNGcm9tU3luY0l0ZXJhdG9yQ29udGludWF0aW9uKG4uYXBwbHkodGhpcy5zLCBhcmd1bWVudHMpKTtcbiAgICB9XG4gIH0sIG5ldyBBc3luY0Zyb21TeW5jSXRlcmF0b3Iocik7XG59XG5mdW5jdGlvbiBfYXdhaXRBc3luY0dlbmVyYXRvcihlKSB7XG4gIHJldHVybiBuZXcgX092ZXJsb2FkWWllbGQoZSwgMCk7XG59XG5mdW5jdGlvbiBfY2hlY2tJblJIUyhlKSB7XG4gIGlmIChPYmplY3QoZSkgIT09IGUpIHRocm93IFR5cGVFcnJvcihcInJpZ2h0LWhhbmQgc2lkZSBvZiAnaW4nIHNob3VsZCBiZSBhbiBvYmplY3QsIGdvdCBcIiArIChudWxsICE9PSBlID8gdHlwZW9mIGUgOiBcIm51bGxcIikpO1xuICByZXR1cm4gZTtcbn1cbmZ1bmN0aW9uIF9kZWZpbmVBY2Nlc3NvcihlLCByLCBuLCB0KSB7XG4gIHZhciBjID0ge1xuICAgIGNvbmZpZ3VyYWJsZTogITAsXG4gICAgZW51bWVyYWJsZTogITBcbiAgfTtcbiAgcmV0dXJuIGNbZV0gPSB0LCBPYmplY3QuZGVmaW5lUHJvcGVydHkociwgbiwgYyk7XG59XG5mdW5jdGlvbiBkaXNwb3NlX1N1cHByZXNzZWRFcnJvcihyLCBlKSB7XG4gIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBTdXBwcmVzc2VkRXJyb3IgPyBkaXNwb3NlX1N1cHByZXNzZWRFcnJvciA9IFN1cHByZXNzZWRFcnJvciA6IChkaXNwb3NlX1N1cHByZXNzZWRFcnJvciA9IGZ1bmN0aW9uIChyLCBlKSB7XG4gICAgdGhpcy5zdXBwcmVzc2VkID0gciwgdGhpcy5lcnJvciA9IGUsIHRoaXMuc3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjaztcbiAgfSwgZGlzcG9zZV9TdXBwcmVzc2VkRXJyb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUsIHtcbiAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgdmFsdWU6IGRpc3Bvc2VfU3VwcHJlc3NlZEVycm9yLFxuICAgICAgd3JpdGFibGU6ICEwLFxuICAgICAgY29uZmlndXJhYmxlOiAhMFxuICAgIH1cbiAgfSkpLCBuZXcgZGlzcG9zZV9TdXBwcmVzc2VkRXJyb3IociwgZSk7XG59XG5mdW5jdGlvbiBfZGlzcG9zZShyLCBlLCBzKSB7XG4gIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgZm9yICg7IHIubGVuZ3RoID4gMDspIHRyeSB7XG4gICAgICB2YXIgbyA9IHIucG9wKCksXG4gICAgICAgIHAgPSBvLmQuY2FsbChvLnYpO1xuICAgICAgaWYgKG8uYSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZShwKS50aGVuKG5leHQsIGVycik7XG4gICAgfSBjYXRjaCAocikge1xuICAgICAgcmV0dXJuIGVycihyKTtcbiAgICB9XG4gICAgaWYgKHMpIHRocm93IGU7XG4gIH1cbiAgZnVuY3Rpb24gZXJyKHIpIHtcbiAgICByZXR1cm4gZSA9IHMgPyBuZXcgZGlzcG9zZV9TdXBwcmVzc2VkRXJyb3IociwgZSkgOiByLCBzID0gITAsIG5leHQoKTtcbiAgfVxuICByZXR1cm4gbmV4dCgpO1xufVxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KHIsIGwpIHtcbiAgdmFyIHQgPSBudWxsID09IHIgPyBudWxsIDogXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgU3ltYm9sICYmIHJbU3ltYm9sLml0ZXJhdG9yXSB8fCByW1wiQEBpdGVyYXRvclwiXTtcbiAgaWYgKG51bGwgIT0gdCkge1xuICAgIHZhciBlLFxuICAgICAgbixcbiAgICAgIGksXG4gICAgICB1LFxuICAgICAgYSA9IFtdLFxuICAgICAgZiA9ICEwLFxuICAgICAgbyA9ICExO1xuICAgIHRyeSB7XG4gICAgICBpZiAoaSA9ICh0ID0gdC5jYWxsKHIpKS5uZXh0LCAwID09PSBsKSB7XG4gICAgICAgIGlmIChPYmplY3QodCkgIT09IHQpIHJldHVybjtcbiAgICAgICAgZiA9ICExO1xuICAgICAgfSBlbHNlIGZvciAoOyAhKGYgPSAoZSA9IGkuY2FsbCh0KSkuZG9uZSkgJiYgKGEucHVzaChlLnZhbHVlKSwgYS5sZW5ndGggIT09IGwpOyBmID0gITApO1xuICAgIH0gY2F0Y2ggKHIpIHtcbiAgICAgIG8gPSAhMCwgbiA9IHI7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghZiAmJiBudWxsICE9IHQucmV0dXJuICYmICh1ID0gdC5yZXR1cm4oKSwgT2JqZWN0KHUpICE9PSB1KSkgcmV0dXJuO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKG8pIHRocm93IG47XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhO1xuICB9XG59XG5mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXRMb29zZShlLCByKSB7XG4gIHZhciB0ID0gZSAmJiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgU3ltYm9sICYmIGVbU3ltYm9sLml0ZXJhdG9yXSB8fCBlW1wiQEBpdGVyYXRvclwiXSk7XG4gIGlmIChudWxsICE9IHQpIHtcbiAgICB2YXIgbyxcbiAgICAgIGwgPSBbXTtcbiAgICBmb3IgKHQgPSB0LmNhbGwoZSk7IGUubGVuZ3RoIDwgciAmJiAhKG8gPSB0Lm5leHQoKSkuZG9uZTspIGwucHVzaChvLnZhbHVlKTtcbiAgICByZXR1cm4gbDtcbiAgfVxufVxudmFyIFJFQUNUX0VMRU1FTlRfVFlQRTtcbmZ1bmN0aW9uIF9qc3goZSwgciwgRSwgbCkge1xuICBSRUFDVF9FTEVNRU5UX1RZUEUgfHwgKFJFQUNUX0VMRU1FTlRfVFlQRSA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIFN5bWJvbC5mb3IgJiYgU3ltYm9sLmZvcihcInJlYWN0LmVsZW1lbnRcIikgfHwgNjAxMDMpO1xuICB2YXIgbyA9IGUgJiYgZS5kZWZhdWx0UHJvcHMsXG4gICAgbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAzO1xuICBpZiAociB8fCAwID09PSBuIHx8IChyID0ge1xuICAgIGNoaWxkcmVuOiB2b2lkIDBcbiAgfSksIDEgPT09IG4pIHIuY2hpbGRyZW4gPSBsO2Vsc2UgaWYgKG4gPiAxKSB7XG4gICAgZm9yICh2YXIgdCA9IG5ldyBBcnJheShuKSwgZiA9IDA7IGYgPCBuOyBmKyspIHRbZl0gPSBhcmd1bWVudHNbZiArIDNdO1xuICAgIHIuY2hpbGRyZW4gPSB0O1xuICB9XG4gIGlmIChyICYmIG8pIGZvciAodmFyIGkgaW4gbykgdm9pZCAwID09PSByW2ldICYmIChyW2ldID0gb1tpXSk7ZWxzZSByIHx8IChyID0gbyB8fCB7fSk7XG4gIHJldHVybiB7XG4gICAgJCR0eXBlb2Y6IFJFQUNUX0VMRU1FTlRfVFlQRSxcbiAgICB0eXBlOiBlLFxuICAgIGtleTogdm9pZCAwID09PSBFID8gbnVsbCA6IFwiXCIgKyBFLFxuICAgIHJlZjogbnVsbCxcbiAgICBwcm9wczogcixcbiAgICBfb3duZXI6IG51bGxcbiAgfTtcbn1cbmZ1bmN0aW9uIG93bktleXMoZSwgcikge1xuICB2YXIgdCA9IE9iamVjdC5rZXlzKGUpO1xuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgIHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTtcbiAgICByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7XG4gICAgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7XG4gIH1cbiAgcmV0dXJuIHQ7XG59XG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkMihlKSB7XG4gIGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7XG4gICAgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9O1xuICAgIHIgJSAyID8gb3duS2V5cyhPYmplY3QodCksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7XG4gICAgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHQpKSA6IG93bktleXMoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGU7XG59XG5mdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkge1xuICBcInVzZSBzdHJpY3RcIjsgLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqL1xuICBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBlO1xuICB9O1xuICB2YXIgdCxcbiAgICBlID0ge30sXG4gICAgciA9IE9iamVjdC5wcm90b3R5cGUsXG4gICAgbiA9IHIuaGFzT3duUHJvcGVydHksXG4gICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikge1xuICAgICAgdFtlXSA9IHIudmFsdWU7XG4gICAgfSxcbiAgICBpID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxcbiAgICBhID0gaS5pdGVyYXRvciB8fCBcIkBAaXRlcmF0b3JcIixcbiAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8IFwiQEBhc3luY0l0ZXJhdG9yXCIsXG4gICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgXCJAQHRvU3RyaW5nVGFnXCI7XG4gIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7XG4gICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBlLCB7XG4gICAgICB2YWx1ZTogcixcbiAgICAgIGVudW1lcmFibGU6ICEwLFxuICAgICAgY29uZmlndXJhYmxlOiAhMCxcbiAgICAgIHdyaXRhYmxlOiAhMFxuICAgIH0pLCB0W2VdO1xuICB9XG4gIHRyeSB7XG4gICAgZGVmaW5lKHt9LCBcIlwiKTtcbiAgfSBjYXRjaCAodCkge1xuICAgIGRlZmluZSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICByZXR1cm4gdFtlXSA9IHI7XG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiB3cmFwKHQsIGUsIHIsIG4pIHtcbiAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLFxuICAgICAgYSA9IE9iamVjdC5jcmVhdGUoaS5wcm90b3R5cGUpLFxuICAgICAgYyA9IG5ldyBDb250ZXh0KG4gfHwgW10pO1xuICAgIHJldHVybiBvKGEsIFwiX2ludm9rZVwiLCB7XG4gICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKVxuICAgIH0pLCBhO1xuICB9XG4gIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJub3JtYWxcIixcbiAgICAgICAgYXJnOiB0LmNhbGwoZSwgcilcbiAgICAgIH07XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJ0aHJvd1wiLFxuICAgICAgICBhcmc6IHRcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIGUud3JhcCA9IHdyYXA7XG4gIHZhciBoID0gXCJzdXNwZW5kZWRTdGFydFwiLFxuICAgIGwgPSBcInN1c3BlbmRlZFlpZWxkXCIsXG4gICAgZiA9IFwiZXhlY3V0aW5nXCIsXG4gICAgcyA9IFwiY29tcGxldGVkXCIsXG4gICAgeSA9IHt9O1xuICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fVxuICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge31cbiAgdmFyIHAgPSB7fTtcbiAgZGVmaW5lKHAsIGEsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG4gIHZhciBkID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLFxuICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7XG4gIHYgJiYgdiAhPT0gciAmJiBuLmNhbGwodiwgYSkgJiYgKHAgPSB2KTtcbiAgdmFyIGcgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShwKTtcbiAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHtcbiAgICBbXCJuZXh0XCIsIFwidGhyb3dcIiwgXCJyZXR1cm5cIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgZGVmaW5lKHQsIGUsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBBc3luY0l0ZXJhdG9yKHQsIGUpIHtcbiAgICBmdW5jdGlvbiBpbnZva2UociwgbywgaSwgYSkge1xuICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTtcbiAgICAgIGlmIChcInRocm93XCIgIT09IGMudHlwZSkge1xuICAgICAgICB2YXIgdSA9IGMuYXJnLFxuICAgICAgICAgIGggPSB1LnZhbHVlO1xuICAgICAgICByZXR1cm4gaCAmJiBcIm9iamVjdFwiID09IHR5cGVvZiBoICYmIG4uY2FsbChoLCBcIl9fYXdhaXRcIikgPyBlLnJlc29sdmUoaC5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgaW52b2tlKFwibmV4dFwiLCB0LCBpLCBhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICBpbnZva2UoXCJ0aHJvd1wiLCB0LCBpLCBhKTtcbiAgICAgICAgfSkgOiBlLnJlc29sdmUoaCkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHUudmFsdWUgPSB0LCBpKHUpO1xuICAgICAgICB9LCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHJldHVybiBpbnZva2UoXCJ0aHJvd1wiLCB0LCBpLCBhKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhKGMuYXJnKTtcbiAgICB9XG4gICAgdmFyIHI7XG4gICAgbyh0aGlzLCBcIl9pbnZva2VcIiwge1xuICAgICAgdmFsdWU6IGZ1bmN0aW9uICh0LCBuKSB7XG4gICAgICAgIGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICAgICAgaW52b2tlKHQsIG4sIGUsIHIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByID0gciA/IHIudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGUsIHIsIG4pIHtcbiAgICB2YXIgbyA9IGg7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpLCBhKSB7XG4gICAgICBpZiAobyA9PT0gZikgdGhyb3cgbmV3IEVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZ1wiKTtcbiAgICAgIGlmIChvID09PSBzKSB7XG4gICAgICAgIGlmIChcInRocm93XCIgPT09IGkpIHRocm93IGE7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsdWU6IHQsXG4gICAgICAgICAgZG9uZTogITBcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGZvciAobi5tZXRob2QgPSBpLCBuLmFyZyA9IGE7Oykge1xuICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7XG4gICAgICAgIGlmIChjKSB7XG4gICAgICAgICAgdmFyIHUgPSBtYXliZUludm9rZURlbGVnYXRlKGMsIG4pO1xuICAgICAgICAgIGlmICh1KSB7XG4gICAgICAgICAgICBpZiAodSA9PT0geSkgY29udGludWU7XG4gICAgICAgICAgICByZXR1cm4gdTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFwibmV4dFwiID09PSBuLm1ldGhvZCkgbi5zZW50ID0gbi5fc2VudCA9IG4uYXJnO2Vsc2UgaWYgKFwidGhyb3dcIiA9PT0gbi5tZXRob2QpIHtcbiAgICAgICAgICBpZiAobyA9PT0gaCkgdGhyb3cgbyA9IHMsIG4uYXJnO1xuICAgICAgICAgIG4uZGlzcGF0Y2hFeGNlcHRpb24obi5hcmcpO1xuICAgICAgICB9IGVsc2UgXCJyZXR1cm5cIiA9PT0gbi5tZXRob2QgJiYgbi5hYnJ1cHQoXCJyZXR1cm5cIiwgbi5hcmcpO1xuICAgICAgICBvID0gZjtcbiAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTtcbiAgICAgICAgaWYgKFwibm9ybWFsXCIgPT09IHAudHlwZSkge1xuICAgICAgICAgIGlmIChvID0gbi5kb25lID8gcyA6IGwsIHAuYXJnID09PSB5KSBjb250aW51ZTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IHAuYXJnLFxuICAgICAgICAgICAgZG9uZTogbi5kb25lXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBcInRocm93XCIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gXCJ0aHJvd1wiLCBuLmFyZyA9IHAuYXJnKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikge1xuICAgIHZhciBuID0gci5tZXRob2QsXG4gICAgICBvID0gZS5pdGVyYXRvcltuXTtcbiAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCBcInRocm93XCIgPT09IG4gJiYgZS5pdGVyYXRvci5yZXR1cm4gJiYgKHIubWV0aG9kID0gXCJyZXR1cm5cIiwgci5hcmcgPSB0LCBtYXliZUludm9rZURlbGVnYXRlKGUsIHIpLCBcInRocm93XCIgPT09IHIubWV0aG9kKSB8fCBcInJldHVyblwiICE9PSBuICYmIChyLm1ldGhvZCA9IFwidGhyb3dcIiwgci5hcmcgPSBuZXcgVHlwZUVycm9yKFwiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAnXCIgKyBuICsgXCInIG1ldGhvZFwiKSksIHk7XG4gICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7XG4gICAgaWYgKFwidGhyb3dcIiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSBcInRocm93XCIsIHIuYXJnID0gaS5hcmcsIHIuZGVsZWdhdGUgPSBudWxsLCB5O1xuICAgIHZhciBhID0gaS5hcmc7XG4gICAgcmV0dXJuIGEgPyBhLmRvbmUgPyAocltlLnJlc3VsdE5hbWVdID0gYS52YWx1ZSwgci5uZXh0ID0gZS5uZXh0TG9jLCBcInJldHVyblwiICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSBcIm5leHRcIiwgci5hcmcgPSB0KSwgci5kZWxlZ2F0ZSA9IG51bGwsIHkpIDogYSA6IChyLm1ldGhvZCA9IFwidGhyb3dcIiwgci5hcmcgPSBuZXcgVHlwZUVycm9yKFwiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3RcIiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTtcbiAgfVxuICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkodCkge1xuICAgIHZhciBlID0ge1xuICAgICAgdHJ5TG9jOiB0WzBdXG4gICAgfTtcbiAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpO1xuICB9XG4gIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkodCkge1xuICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9O1xuICAgIGUudHlwZSA9IFwibm9ybWFsXCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTtcbiAgfVxuICBmdW5jdGlvbiBDb250ZXh0KHQpIHtcbiAgICB0aGlzLnRyeUVudHJpZXMgPSBbe1xuICAgICAgdHJ5TG9jOiBcInJvb3RcIlxuICAgIH1dLCB0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7XG4gIH1cbiAgZnVuY3Rpb24gdmFsdWVzKGUpIHtcbiAgICBpZiAoZSB8fCBcIlwiID09PSBlKSB7XG4gICAgICB2YXIgciA9IGVbYV07XG4gICAgICBpZiAocikgcmV0dXJuIHIuY2FsbChlKTtcbiAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUubmV4dCkgcmV0dXJuIGU7XG4gICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkge1xuICAgICAgICB2YXIgbyA9IC0xLFxuICAgICAgICAgIGkgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDtcbiAgICAgICAgICAgIHJldHVybiBuZXh0LnZhbHVlID0gdCwgbmV4dC5kb25lID0gITAsIG5leHQ7XG4gICAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IodHlwZW9mIGUgKyBcIiBpcyBub3QgaXRlcmFibGVcIik7XG4gIH1cbiAgcmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBvKGcsIFwiY29uc3RydWN0b3JcIiwge1xuICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSxcbiAgICBjb25maWd1cmFibGU6ICEwXG4gIH0pLCBvKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBcImNvbnN0cnVjdG9yXCIsIHtcbiAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sXG4gICAgY29uZmlndXJhYmxlOiAhMFxuICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsIFwiR2VuZXJhdG9yRnVuY3Rpb25cIiksIGUuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uICh0KSB7XG4gICAgdmFyIGUgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQgJiYgdC5jb25zdHJ1Y3RvcjtcbiAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCBcIkdlbmVyYXRvckZ1bmN0aW9uXCIgPT09IChlLmRpc3BsYXlOYW1lIHx8IGUubmFtZSkpO1xuICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkge1xuICAgIHJldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YodCwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpIDogKHQuX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZSh0LCB1LCBcIkdlbmVyYXRvckZ1bmN0aW9uXCIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0O1xuICB9LCBlLmF3cmFwID0gZnVuY3Rpb24gKHQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgX19hd2FpdDogdFxuICAgIH07XG4gIH0sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYywgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9KSwgZS5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvciwgZS5hc3luYyA9IGZ1bmN0aW9uICh0LCByLCBuLCBvLCBpKSB7XG4gICAgdm9pZCAwID09PSBpICYmIChpID0gUHJvbWlzZSk7XG4gICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTtcbiAgICByZXR1cm4gZS5pc0dlbmVyYXRvckZ1bmN0aW9uKHIpID8gYSA6IGEubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiB0LmRvbmUgPyB0LnZhbHVlIDogYS5uZXh0KCk7XG4gICAgfSk7XG4gIH0sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhnKSwgZGVmaW5lKGcsIHUsIFwiR2VuZXJhdG9yXCIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9KSwgZGVmaW5lKGcsIFwidG9TdHJpbmdcIiwgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBcIltvYmplY3QgR2VuZXJhdG9yXVwiO1xuICB9KSwgZS5rZXlzID0gZnVuY3Rpb24gKHQpIHtcbiAgICB2YXIgZSA9IE9iamVjdCh0KSxcbiAgICAgIHIgPSBbXTtcbiAgICBmb3IgKHZhciBuIGluIGUpIHIucHVzaChuKTtcbiAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICBmb3IgKDsgci5sZW5ndGg7KSB7XG4gICAgICAgIHZhciB0ID0gci5wb3AoKTtcbiAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDtcbiAgICB9O1xuICB9LCBlLnZhbHVlcyA9IHZhbHVlcywgQ29udGV4dC5wcm90b3R5cGUgPSB7XG4gICAgY29uc3RydWN0b3I6IENvbnRleHQsXG4gICAgcmVzZXQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHQsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSBcIm5leHRcIiwgdGhpcy5hcmcgPSB0LCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIWUpIGZvciAodmFyIHIgaW4gdGhpcykgXCJ0XCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7XG4gICAgfSxcbiAgICBzdG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmRvbmUgPSAhMDtcbiAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247XG4gICAgICBpZiAoXCJ0aHJvd1wiID09PSB0LnR5cGUpIHRocm93IHQuYXJnO1xuICAgICAgcmV0dXJuIHRoaXMucnZhbDtcbiAgICB9LFxuICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKHRoaXMuZG9uZSkgdGhyb3cgZTtcbiAgICAgIHZhciByID0gdGhpcztcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZShuLCBvKSB7XG4gICAgICAgIHJldHVybiBhLnR5cGUgPSBcInRocm93XCIsIGEuYXJnID0gZSwgci5uZXh0ID0gbiwgbyAmJiAoci5tZXRob2QgPSBcIm5leHRcIiwgci5hcmcgPSB0KSwgISFvO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgbyA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBvID49IDA7IC0tbykge1xuICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSxcbiAgICAgICAgICBhID0gaS5jb21wbGV0aW9uO1xuICAgICAgICBpZiAoXCJyb290XCIgPT09IGkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKFwiZW5kXCIpO1xuICAgICAgICBpZiAoaS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7XG4gICAgICAgICAgdmFyIGMgPSBuLmNhbGwoaSwgXCJjYXRjaExvY1wiKSxcbiAgICAgICAgICAgIHUgPSBuLmNhbGwoaSwgXCJmaW5hbGx5TG9jXCIpO1xuICAgICAgICAgIGlmIChjICYmIHUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoaS5maW5hbGx5TG9jKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCF1KSB0aHJvdyBuZXcgRXJyb3IoXCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseVwiKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoaS5maW5hbGx5TG9jKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGFicnVwdDogZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIGZvciAodmFyIHIgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgciA+PSAwOyAtLXIpIHtcbiAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07XG4gICAgICAgIGlmIChvLnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgbi5jYWxsKG8sIFwiZmluYWxseUxvY1wiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICB2YXIgaSA9IG87XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGkgJiYgKFwiYnJlYWtcIiA9PT0gdCB8fCBcImNvbnRpbnVlXCIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTtcbiAgICAgIHZhciBhID0gaSA/IGkuY29tcGxldGlvbiA6IHt9O1xuICAgICAgcmV0dXJuIGEudHlwZSA9IHQsIGEuYXJnID0gZSwgaSA/ICh0aGlzLm1ldGhvZCA9IFwibmV4dFwiLCB0aGlzLm5leHQgPSBpLmZpbmFsbHlMb2MsIHkpIDogdGhpcy5jb21wbGV0ZShhKTtcbiAgICB9LFxuICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgaWYgKFwidGhyb3dcIiA9PT0gdC50eXBlKSB0aHJvdyB0LmFyZztcbiAgICAgIHJldHVybiBcImJyZWFrXCIgPT09IHQudHlwZSB8fCBcImNvbnRpbnVlXCIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogXCJyZXR1cm5cIiA9PT0gdC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gdC5hcmcsIHRoaXMubWV0aG9kID0gXCJyZXR1cm5cIiwgdGhpcy5uZXh0ID0gXCJlbmRcIikgOiBcIm5vcm1hbFwiID09PSB0LnR5cGUgJiYgZSAmJiAodGhpcy5uZXh0ID0gZSksIHk7XG4gICAgfSxcbiAgICBmaW5pc2g6IGZ1bmN0aW9uICh0KSB7XG4gICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7XG4gICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdO1xuICAgICAgICBpZiAoci5maW5hbGx5TG9jID09PSB0KSByZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sIHIuYWZ0ZXJMb2MpLCByZXNldFRyeUVudHJ5KHIpLCB5O1xuICAgICAgfVxuICAgIH0sXG4gICAgY2F0Y2g6IGZ1bmN0aW9uICh0KSB7XG4gICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7XG4gICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdO1xuICAgICAgICBpZiAoci50cnlMb2MgPT09IHQpIHtcbiAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjtcbiAgICAgICAgICBpZiAoXCJ0aHJvd1wiID09PSBuLnR5cGUpIHtcbiAgICAgICAgICAgIHZhciBvID0gbi5hcmc7XG4gICAgICAgICAgICByZXNldFRyeUVudHJ5KHIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaWxsZWdhbCBjYXRjaCBhdHRlbXB0XCIpO1xuICAgIH0sXG4gICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gKGUsIHIsIG4pIHtcbiAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlID0ge1xuICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLFxuICAgICAgICByZXN1bHROYW1lOiByLFxuICAgICAgICBuZXh0TG9jOiBuXG4gICAgICB9LCBcIm5leHRcIiA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gdCksIHk7XG4gICAgfVxuICB9LCBlO1xufVxuZnVuY3Rpb24gX3R5cGVvZihvKSB7XG4gIFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjtcblxuICByZXR1cm4gX3R5cGVvZiA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIFwic3ltYm9sXCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBvO1xuICB9IDogZnVuY3Rpb24gKG8pIHtcbiAgICByZXR1cm4gbyAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2YgbztcbiAgfSwgX3R5cGVvZihvKTtcbn1cbmZ1bmN0aW9uIF91c2luZyhvLCBlLCBuKSB7XG4gIGlmIChudWxsID09IGUpIHJldHVybiBlO1xuICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcInVzaW5nIGRlY2xhcmF0aW9ucyBjYW4gb25seSBiZSB1c2VkIHdpdGggb2JqZWN0cywgbnVsbCwgb3IgdW5kZWZpbmVkLlwiKTtcbiAgaWYgKG4pIHZhciByID0gZVtTeW1ib2wuYXN5bmNEaXNwb3NlIHx8IFN5bWJvbC5mb3IoXCJTeW1ib2wuYXN5bmNEaXNwb3NlXCIpXTtcbiAgaWYgKG51bGwgPT0gciAmJiAociA9IGVbU3ltYm9sLmRpc3Bvc2UgfHwgU3ltYm9sLmZvcihcIlN5bWJvbC5kaXNwb3NlXCIpXSksIFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByb3BlcnR5IFtTeW1ib2wuZGlzcG9zZV0gaXMgbm90IGEgZnVuY3Rpb24uXCIpO1xuICByZXR1cm4gby5wdXNoKHtcbiAgICB2OiBlLFxuICAgIGQ6IHIsXG4gICAgYTogblxuICB9KSwgZTtcbn1cbmZ1bmN0aW9uIF93cmFwUmVnRXhwKCkge1xuICBfd3JhcFJlZ0V4cCA9IGZ1bmN0aW9uIChlLCByKSB7XG4gICAgcmV0dXJuIG5ldyBCYWJlbFJlZ0V4cChlLCB2b2lkIDAsIHIpO1xuICB9O1xuICB2YXIgZSA9IFJlZ0V4cC5wcm90b3R5cGUsXG4gICAgciA9IG5ldyBXZWFrTWFwKCk7XG4gIGZ1bmN0aW9uIEJhYmVsUmVnRXhwKGUsIHQsIHApIHtcbiAgICB2YXIgbyA9IG5ldyBSZWdFeHAoZSwgdCk7XG4gICAgcmV0dXJuIHIuc2V0KG8sIHAgfHwgci5nZXQoZSkpLCBfc2V0UHJvdG90eXBlT2YobywgQmFiZWxSZWdFeHAucHJvdG90eXBlKTtcbiAgfVxuICBmdW5jdGlvbiBidWlsZEdyb3VwcyhlLCB0KSB7XG4gICAgdmFyIHAgPSByLmdldCh0KTtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMocCkucmVkdWNlKGZ1bmN0aW9uIChyLCB0KSB7XG4gICAgICB2YXIgbyA9IHBbdF07XG4gICAgICBpZiAoXCJudW1iZXJcIiA9PSB0eXBlb2Ygbykgclt0XSA9IGVbb107ZWxzZSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyB2b2lkIDAgPT09IGVbb1tpXV0gJiYgaSArIDEgPCBvLmxlbmd0aDspIGkrKztcbiAgICAgICAgclt0XSA9IGVbb1tpXV07XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9LCBPYmplY3QuY3JlYXRlKG51bGwpKTtcbiAgfVxuICByZXR1cm4gX2luaGVyaXRzKEJhYmVsUmVnRXhwLCBSZWdFeHApLCBCYWJlbFJlZ0V4cC5wcm90b3R5cGUuZXhlYyA9IGZ1bmN0aW9uIChyKSB7XG4gICAgdmFyIHQgPSBlLmV4ZWMuY2FsbCh0aGlzLCByKTtcbiAgICBpZiAodCkge1xuICAgICAgdC5ncm91cHMgPSBidWlsZEdyb3Vwcyh0LCB0aGlzKTtcbiAgICAgIHZhciBwID0gdC5pbmRpY2VzO1xuICAgICAgcCAmJiAocC5ncm91cHMgPSBidWlsZEdyb3VwcyhwLCB0aGlzKSk7XG4gICAgfVxuICAgIHJldHVybiB0O1xuICB9LCBCYWJlbFJlZ0V4cC5wcm90b3R5cGVbU3ltYm9sLnJlcGxhY2VdID0gZnVuY3Rpb24gKHQsIHApIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgcCkge1xuICAgICAgdmFyIG8gPSByLmdldCh0aGlzKTtcbiAgICAgIHJldHVybiBlW1N5bWJvbC5yZXBsYWNlXS5jYWxsKHRoaXMsIHQsIHAucmVwbGFjZSgvXFwkPChbXj5dKyk+L2csIGZ1bmN0aW9uIChlLCByKSB7XG4gICAgICAgIHZhciB0ID0gb1tyXTtcbiAgICAgICAgcmV0dXJuIFwiJFwiICsgKEFycmF5LmlzQXJyYXkodCkgPyB0LmpvaW4oXCIkXCIpIDogdCk7XG4gICAgICB9KSk7XG4gICAgfVxuICAgIGlmIChcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHApIHtcbiAgICAgIHZhciBpID0gdGhpcztcbiAgICAgIHJldHVybiBlW1N5bWJvbC5yZXBsYWNlXS5jYWxsKHRoaXMsIHQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSBhcmd1bWVudHM7XG4gICAgICAgIHJldHVybiBcIm9iamVjdFwiICE9IHR5cGVvZiBlW2UubGVuZ3RoIC0gMV0gJiYgKGUgPSBbXS5zbGljZS5jYWxsKGUpKS5wdXNoKGJ1aWxkR3JvdXBzKGUsIGkpKSwgcC5hcHBseSh0aGlzLCBlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZVtTeW1ib2wucmVwbGFjZV0uY2FsbCh0aGlzLCB0LCBwKTtcbiAgfSwgX3dyYXBSZWdFeHAuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn1cbmZ1bmN0aW9uIF9Bd2FpdFZhbHVlKHZhbHVlKSB7XG4gIHRoaXMud3JhcHBlZCA9IHZhbHVlO1xufVxuZnVuY3Rpb24gX3dyYXBBc3luY0dlbmVyYXRvcihmbikge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgX0FzeW5jR2VuZXJhdG9yKGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpO1xuICB9O1xufVxuZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge1xuICB0cnkge1xuICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTtcbiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlamVjdChlcnJvcik7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChpbmZvLmRvbmUpIHtcbiAgICByZXNvbHZlKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7XG4gIH1cbn1cbmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO1xuICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHtcbiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBcIm5leHRcIiwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikge1xuICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwidGhyb3dcIiwgZXJyKTtcbiAgICAgIH1cbiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7XG4gICAgfSk7XG4gIH07XG59XG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgfVxufVxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtcbiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7XG4gICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO1xuICAgIGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgX3RvUHJvcGVydHlLZXkoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTtcbiAgfVxufVxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge1xuICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtcbiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsIFwicHJvdG90eXBlXCIsIHtcbiAgICB3cml0YWJsZTogZmFsc2VcbiAgfSk7XG4gIHJldHVybiBDb25zdHJ1Y3Rvcjtcbn1cbmZ1bmN0aW9uIF9kZWZpbmVFbnVtZXJhYmxlUHJvcGVydGllcyhvYmosIGRlc2NzKSB7XG4gIGZvciAodmFyIGtleSBpbiBkZXNjcykge1xuICAgIHZhciBkZXNjID0gZGVzY3Nba2V5XTtcbiAgICBkZXNjLmNvbmZpZ3VyYWJsZSA9IGRlc2MuZW51bWVyYWJsZSA9IHRydWU7XG4gICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjKSBkZXNjLndyaXRhYmxlID0gdHJ1ZTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIGRlc2MpO1xuICB9XG4gIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7XG4gICAgdmFyIG9iamVjdFN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGRlc2NzKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iamVjdFN5bWJvbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzeW0gPSBvYmplY3RTeW1ib2xzW2ldO1xuICAgICAgdmFyIGRlc2MgPSBkZXNjc1tzeW1dO1xuICAgICAgZGVzYy5jb25maWd1cmFibGUgPSBkZXNjLmVudW1lcmFibGUgPSB0cnVlO1xuICAgICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjKSBkZXNjLndyaXRhYmxlID0gdHJ1ZTtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHN5bSwgZGVzYyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBvYmo7XG59XG5mdW5jdGlvbiBfZGVmYXVsdHMob2JqLCBkZWZhdWx0cykge1xuICB2YXIga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGRlZmF1bHRzKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgdmFyIHZhbHVlID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihkZWZhdWx0cywga2V5KTtcbiAgICBpZiAodmFsdWUgJiYgdmFsdWUuY29uZmlndXJhYmxlICYmIG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb2JqO1xufVxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICBrZXkgPSBfdG9Qcm9wZXJ0eUtleShrZXkpO1xuICBpZiAoa2V5IGluIG9iaikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gb2JqO1xufVxuZnVuY3Rpb24gX2V4dGVuZHMoKSB7XG4gIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcbiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59XG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkge1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IE9iamVjdChhcmd1bWVudHNbaV0pIDoge307XG4gICAgdmFyIG93bktleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpO1xuICAgIGlmICh0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgb3duS2V5cy5wdXNoLmFwcGx5KG93bktleXMsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoc291cmNlKS5maWx0ZXIoZnVuY3Rpb24gKHN5bSkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIHN5bSkuZW51bWVyYWJsZTtcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgb3duS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiB0YXJnZXQ7XG59XG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtcbiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvblwiKTtcbiAgfVxuICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHtcbiAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgdmFsdWU6IHN1YkNsYXNzLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9XG4gIH0pO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsIFwicHJvdG90eXBlXCIsIHtcbiAgICB3cml0YWJsZTogZmFsc2VcbiAgfSk7XG4gIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO1xufVxuZnVuY3Rpb24gX2luaGVyaXRzTG9vc2Uoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtcbiAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzLnByb3RvdHlwZSk7XG4gIHN1YkNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHN1YkNsYXNzO1xuICBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO1xufVxuZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtcbiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7XG4gICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTtcbiAgfTtcbiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTtcbn1cbmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7XG4gIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge1xuICAgIG8uX19wcm90b19fID0gcDtcbiAgICByZXR1cm4gbztcbiAgfTtcbiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTtcbn1cbmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7XG4gIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhUmVmbGVjdC5jb25zdHJ1Y3QpIHJldHVybiBmYWxzZTtcbiAgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTtcbiAgaWYgKHR5cGVvZiBQcm94eSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gdHJ1ZTtcbiAgdHJ5IHtcbiAgICBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbmZ1bmN0aW9uIF9jb25zdHJ1Y3QoUGFyZW50LCBhcmdzLCBDbGFzcykge1xuICBpZiAoX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpKSB7XG4gICAgX2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0LmJpbmQoKTtcbiAgfSBlbHNlIHtcbiAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7XG4gICAgICB2YXIgYSA9IFtudWxsXTtcbiAgICAgIGEucHVzaC5hcHBseShhLCBhcmdzKTtcbiAgICAgIHZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTtcbiAgICAgIHZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpO1xuICAgICAgaWYgKENsYXNzKSBfc2V0UHJvdG90eXBlT2YoaW5zdGFuY2UsIENsYXNzLnByb3RvdHlwZSk7XG4gICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgfTtcbiAgfVxuICByZXR1cm4gX2NvbnN0cnVjdC5hcHBseShudWxsLCBhcmd1bWVudHMpO1xufVxuZnVuY3Rpb24gX2lzTmF0aXZlRnVuY3Rpb24oZm4pIHtcbiAgcmV0dXJuIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoZm4pLmluZGV4T2YoXCJbbmF0aXZlIGNvZGVdXCIpICE9PSAtMTtcbn1cbmZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHtcbiAgdmFyIF9jYWNoZSA9IHR5cGVvZiBNYXAgPT09IFwiZnVuY3Rpb25cIiA/IG5ldyBNYXAoKSA6IHVuZGVmaW5lZDtcbiAgX3dyYXBOYXRpdmVTdXBlciA9IGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHtcbiAgICBpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzO1xuICAgIGlmICh0eXBlb2YgQ2xhc3MgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uXCIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIF9jYWNoZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgaWYgKF9jYWNoZS5oYXMoQ2xhc3MpKSByZXR1cm4gX2NhY2hlLmdldChDbGFzcyk7XG4gICAgICBfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gV3JhcHBlcigpIHtcbiAgICAgIHJldHVybiBfY29uc3RydWN0KENsYXNzLCBhcmd1bWVudHMsIF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3Rvcik7XG4gICAgfVxuICAgIFdyYXBwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGFzcy5wcm90b3R5cGUsIHtcbiAgICAgIGNvbnN0cnVjdG9yOiB7XG4gICAgICAgIHZhbHVlOiBXcmFwcGVyLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpO1xuICB9O1xuICByZXR1cm4gX3dyYXBOYXRpdmVTdXBlcihDbGFzcyk7XG59XG5mdW5jdGlvbiBfaW5zdGFuY2VvZihsZWZ0LCByaWdodCkge1xuICBpZiAocmlnaHQgIT0gbnVsbCAmJiB0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIHJpZ2h0W1N5bWJvbC5oYXNJbnN0YW5jZV0pIHtcbiAgICByZXR1cm4gISFyaWdodFtTeW1ib2wuaGFzSW5zdGFuY2VdKGxlZnQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBsZWZ0IGluc3RhbmNlb2YgcmlnaHQ7XG4gIH1cbn1cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7XG4gIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7XG4gICAgZGVmYXVsdDogb2JqXG4gIH07XG59XG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUobm9kZUludGVyb3ApIHtcbiAgaWYgKHR5cGVvZiBXZWFrTWFwICE9PSBcImZ1bmN0aW9uXCIpIHJldHVybiBudWxsO1xuICB2YXIgY2FjaGVCYWJlbEludGVyb3AgPSBuZXcgV2Vha01hcCgpO1xuICB2YXIgY2FjaGVOb2RlSW50ZXJvcCA9IG5ldyBXZWFrTWFwKCk7XG4gIHJldHVybiAoX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gKG5vZGVJbnRlcm9wKSB7XG4gICAgcmV0dXJuIG5vZGVJbnRlcm9wID8gY2FjaGVOb2RlSW50ZXJvcCA6IGNhY2hlQmFiZWxJbnRlcm9wO1xuICB9KShub2RlSW50ZXJvcCk7XG59XG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmosIG5vZGVJbnRlcm9wKSB7XG4gIGlmICghbm9kZUludGVyb3AgJiYgb2JqICYmIG9iai5fX2VzTW9kdWxlKSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfVxuICBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG9iaiAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRlZmF1bHQ6IG9ialxuICAgIH07XG4gIH1cbiAgdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKTtcbiAgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7XG4gICAgcmV0dXJuIGNhY2hlLmdldChvYmopO1xuICB9XG4gIHZhciBuZXdPYmogPSB7fTtcbiAgdmFyIGhhc1Byb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKGtleSAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IG51bGw7XG4gICAgICBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBuZXdPYmouZGVmYXVsdCA9IG9iajtcbiAgaWYgKGNhY2hlKSB7XG4gICAgY2FjaGUuc2V0KG9iaiwgbmV3T2JqKTtcbiAgfVxuICByZXR1cm4gbmV3T2JqO1xufVxuZnVuY3Rpb24gX25ld0Fycm93Q2hlY2soaW5uZXJUaGlzLCBib3VuZFRoaXMpIHtcbiAgaWYgKGlubmVyVGhpcyAhPT0gYm91bmRUaGlzKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBpbnN0YW50aWF0ZSBhbiBhcnJvdyBmdW5jdGlvblwiKTtcbiAgfVxufVxuZnVuY3Rpb24gX29iamVjdERlc3RydWN0dXJpbmdFbXB0eShvYmopIHtcbiAgaWYgKG9iaiA9PSBudWxsKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGRlc3RydWN0dXJlIFwiICsgb2JqKTtcbn1cbmZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHtcbiAgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307XG4gIHZhciB0YXJnZXQgPSB7fTtcbiAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpO1xuICB2YXIga2V5LCBpO1xuICBmb3IgKGkgPSAwOyBpIDwgc291cmNlS2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGtleSA9IHNvdXJjZUtleXNbaV07XG4gICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTtcbiAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICB9XG4gIHJldHVybiB0YXJnZXQ7XG59XG5mdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoc291cmNlLCBleGNsdWRlZCkge1xuICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTtcbiAgdmFyIHRhcmdldCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpO1xuICB2YXIga2V5LCBpO1xuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgIHZhciBzb3VyY2VTeW1ib2xLZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzb3VyY2UpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VTeW1ib2xLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBrZXkgPSBzb3VyY2VTeW1ib2xLZXlzW2ldO1xuICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTtcbiAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkgY29udGludWU7XG4gICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGFyZ2V0O1xufVxuZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7XG4gIGlmIChzZWxmID09PSB2b2lkIDApIHtcbiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7XG4gIH1cbiAgcmV0dXJuIHNlbGY7XG59XG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7XG4gIGlmIChjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSkge1xuICAgIHJldHVybiBjYWxsO1xuICB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZFwiKTtcbiAgfVxuICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTtcbn1cbmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7XG4gIHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpO1xuICByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7XG4gICAgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLFxuICAgICAgcmVzdWx0O1xuICAgIGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7XG4gICAgICB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yO1xuICAgICAgcmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG4gICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7XG4gIH07XG59XG5mdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7XG4gIHdoaWxlICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpKSB7XG4gICAgb2JqZWN0ID0gX2dldFByb3RvdHlwZU9mKG9iamVjdCk7XG4gICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIG9iamVjdDtcbn1cbmZ1bmN0aW9uIF9nZXQoKSB7XG4gIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBSZWZsZWN0LmdldCkge1xuICAgIF9nZXQgPSBSZWZsZWN0LmdldC5iaW5kKCk7XG4gIH0gZWxzZSB7XG4gICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHtcbiAgICAgIHZhciBiYXNlID0gX3N1cGVyUHJvcEJhc2UodGFyZ2V0LCBwcm9wZXJ0eSk7XG4gICAgICBpZiAoIWJhc2UpIHJldHVybjtcbiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihiYXNlLCBwcm9wZXJ0eSk7XG4gICAgICBpZiAoZGVzYy5nZXQpIHtcbiAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwoYXJndW1lbnRzLmxlbmd0aCA8IDMgPyB0YXJnZXQgOiByZWNlaXZlcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGVzYy52YWx1ZTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBfZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59XG5mdW5jdGlvbiBzZXQodGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUsIHJlY2VpdmVyKSB7XG4gIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBSZWZsZWN0LnNldCkge1xuICAgIHNldCA9IFJlZmxlY3Quc2V0O1xuICB9IGVsc2Uge1xuICAgIHNldCA9IGZ1bmN0aW9uIHNldCh0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSwgcmVjZWl2ZXIpIHtcbiAgICAgIHZhciBiYXNlID0gX3N1cGVyUHJvcEJhc2UodGFyZ2V0LCBwcm9wZXJ0eSk7XG4gICAgICB2YXIgZGVzYztcbiAgICAgIGlmIChiYXNlKSB7XG4gICAgICAgIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGJhc2UsIHByb3BlcnR5KTtcbiAgICAgICAgaWYgKGRlc2Muc2V0KSB7XG4gICAgICAgICAgZGVzYy5zZXQuY2FsbChyZWNlaXZlciwgdmFsdWUpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKCFkZXNjLndyaXRhYmxlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihyZWNlaXZlciwgcHJvcGVydHkpO1xuICAgICAgaWYgKGRlc2MpIHtcbiAgICAgICAgaWYgKCFkZXNjLndyaXRhYmxlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGRlc2MudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlY2VpdmVyLCBwcm9wZXJ0eSwgZGVzYyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfZGVmaW5lUHJvcGVydHkocmVjZWl2ZXIsIHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBzZXQodGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUsIHJlY2VpdmVyKTtcbn1cbmZ1bmN0aW9uIF9zZXQodGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUsIHJlY2VpdmVyLCBpc1N0cmljdCkge1xuICB2YXIgcyA9IHNldCh0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSwgcmVjZWl2ZXIgfHwgdGFyZ2V0KTtcbiAgaWYgKCFzICYmIGlzU3RyaWN0KSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignZmFpbGVkIHRvIHNldCBwcm9wZXJ0eScpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIF90YWdnZWRUZW1wbGF0ZUxpdGVyYWwoc3RyaW5ncywgcmF3KSB7XG4gIGlmICghcmF3KSB7XG4gICAgcmF3ID0gc3RyaW5ncy5zbGljZSgwKTtcbiAgfVxuICByZXR1cm4gT2JqZWN0LmZyZWV6ZShPYmplY3QuZGVmaW5lUHJvcGVydGllcyhzdHJpbmdzLCB7XG4gICAgcmF3OiB7XG4gICAgICB2YWx1ZTogT2JqZWN0LmZyZWV6ZShyYXcpXG4gICAgfVxuICB9KSk7XG59XG5mdW5jdGlvbiBfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsTG9vc2Uoc3RyaW5ncywgcmF3KSB7XG4gIGlmICghcmF3KSB7XG4gICAgcmF3ID0gc3RyaW5ncy5zbGljZSgwKTtcbiAgfVxuICBzdHJpbmdzLnJhdyA9IHJhdztcbiAgcmV0dXJuIHN0cmluZ3M7XG59XG5mdW5jdGlvbiBfcmVhZE9ubHlFcnJvcihuYW1lKSB7XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJcXFwiXCIgKyBuYW1lICsgXCJcXFwiIGlzIHJlYWQtb25seVwiKTtcbn1cbmZ1bmN0aW9uIF93cml0ZU9ubHlFcnJvcihuYW1lKSB7XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJcXFwiXCIgKyBuYW1lICsgXCJcXFwiIGlzIHdyaXRlLW9ubHlcIik7XG59XG5mdW5jdGlvbiBfY2xhc3NOYW1lVERaRXJyb3IobmFtZSkge1xuICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJDbGFzcyBcXFwiXCIgKyBuYW1lICsgXCJcXFwiIGNhbm5vdCBiZSByZWZlcmVuY2VkIGluIGNvbXB1dGVkIHByb3BlcnR5IGtleXMuXCIpO1xufVxuZnVuY3Rpb24gX3RlbXBvcmFsVW5kZWZpbmVkKCkge31cbmZ1bmN0aW9uIF90ZHoobmFtZSkge1xuICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IobmFtZSArIFwiIGlzIG5vdCBkZWZpbmVkIC0gdGVtcG9yYWwgZGVhZCB6b25lXCIpO1xufVxuZnVuY3Rpb24gX3RlbXBvcmFsUmVmKHZhbCwgbmFtZSkge1xuICByZXR1cm4gdmFsID09PSBfdGVtcG9yYWxVbmRlZmluZWQgPyBfdGR6KG5hbWUpIDogdmFsO1xufVxuZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7XG4gIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7XG59XG5mdW5jdGlvbiBfc2xpY2VkVG9BcnJheUxvb3NlKGFyciwgaSkge1xuICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0TG9vc2UoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7XG59XG5mdW5jdGlvbiBfdG9BcnJheShhcnIpIHtcbiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7XG59XG5mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7XG4gIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7XG59XG5mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShhcnIpO1xufVxuZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO1xufVxuZnVuY3Rpb24gX21heWJlQXJyYXlMaWtlKG5leHQsIGFyciwgaSkge1xuICBpZiAoYXJyICYmICFBcnJheS5pc0FycmF5KGFycikgJiYgdHlwZW9mIGFyci5sZW5ndGggPT09IFwibnVtYmVyXCIpIHtcbiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDtcbiAgICByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBpICE9PSB2b2lkIDAgJiYgaSA8IGxlbiA/IGkgOiBsZW4pO1xuICB9XG4gIHJldHVybiBuZXh0KGFyciwgaSk7XG59XG5mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHtcbiAgaWYgKHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgaXRlcltTeW1ib2wuaXRlcmF0b3JdICE9IG51bGwgfHwgaXRlcltcIkBAaXRlcmF0b3JcIl0gIT0gbnVsbCkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7XG59XG5mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7XG4gIGlmICghbykgcmV0dXJuO1xuICBpZiAodHlwZW9mIG8gPT09IFwic3RyaW5nXCIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO1xuICB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7XG4gIGlmIChuID09PSBcIk9iamVjdFwiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7XG4gIGlmIChuID09PSBcIk1hcFwiIHx8IG4gPT09IFwiU2V0XCIpIHJldHVybiBBcnJheS5mcm9tKG8pO1xuICBpZiAobiA9PT0gXCJBcmd1bWVudHNcIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7XG59XG5mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge1xuICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO1xuICByZXR1cm4gYXJyMjtcbn1cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHtcbiAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG59XG5mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpO1xufVxuZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHtcbiAgdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1tcIkBAaXRlcmF0b3JcIl07XG4gIGlmICghaXQpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSBcIm51bWJlclwiKSB7XG4gICAgICBpZiAoaXQpIG8gPSBpdDtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIHZhciBGID0gZnVuY3Rpb24gKCkge307XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzOiBGLFxuICAgICAgICBuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7XG4gICAgICAgICAgICBkb25lOiB0cnVlXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZG9uZTogZmFsc2UsXG4gICAgICAgICAgICB2YWx1ZTogb1tpKytdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9LFxuICAgICAgICBmOiBGXG4gICAgICB9O1xuICAgIH1cbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG4gIH1cbiAgdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLFxuICAgIGRpZEVyciA9IGZhbHNlLFxuICAgIGVycjtcbiAgcmV0dXJuIHtcbiAgICBzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCA9IGl0LmNhbGwobyk7XG4gICAgfSxcbiAgICBuOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc3RlcCA9IGl0Lm5leHQoKTtcbiAgICAgIG5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7XG4gICAgICByZXR1cm4gc3RlcDtcbiAgICB9LFxuICAgIGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICBkaWRFcnIgPSB0cnVlO1xuICAgICAgZXJyID0gZTtcbiAgICB9LFxuICAgIGY6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdC5yZXR1cm4gIT0gbnVsbCkgaXQucmV0dXJuKCk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBpZiAoZGlkRXJyKSB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXJMb29zZShvLCBhbGxvd0FycmF5TGlrZSkge1xuICB2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvW1wiQEBpdGVyYXRvclwiXTtcbiAgaWYgKGl0KSByZXR1cm4gKGl0ID0gaXQuY2FsbChvKSkubmV4dC5iaW5kKGl0KTtcbiAgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikge1xuICAgIGlmIChpdCkgbyA9IGl0O1xuICAgIHZhciBpID0gMDtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7XG4gICAgICAgIGRvbmU6IHRydWVcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb25lOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IG9baSsrXVxuICAgICAgfTtcbiAgICB9O1xuICB9XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLlwiKTtcbn1cbmZ1bmN0aW9uIF9za2lwRmlyc3RHZW5lcmF0b3JOZXh0KGZuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGl0ID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBpdC5uZXh0KCk7XG4gICAgcmV0dXJuIGl0O1xuICB9O1xufVxuZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7XG4gIGlmICh0eXBlb2YgaW5wdXQgIT09IFwib2JqZWN0XCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDtcbiAgdmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdO1xuICBpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCBcImRlZmF1bHRcIik7XG4gICAgaWYgKHR5cGVvZiByZXMgIT09IFwib2JqZWN0XCIpIHJldHVybiByZXM7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuXCIpO1xuICB9XG4gIHJldHVybiAoaGludCA9PT0gXCJzdHJpbmdcIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpO1xufVxuZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkoYXJnKSB7XG4gIHZhciBrZXkgPSBfdG9QcmltaXRpdmUoYXJnLCBcInN0cmluZ1wiKTtcbiAgcmV0dXJuIHR5cGVvZiBrZXkgPT09IFwic3ltYm9sXCIgPyBrZXkgOiBTdHJpbmcoa2V5KTtcbn1cbmZ1bmN0aW9uIF9pbml0aWFsaXplcldhcm5pbmdIZWxwZXIoZGVzY3JpcHRvciwgY29udGV4dCkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0RlY29yYXRpbmcgY2xhc3MgcHJvcGVydHkgZmFpbGVkLiBQbGVhc2UgZW5zdXJlIHRoYXQgJyArICd0cmFuc2Zvcm0tY2xhc3MtcHJvcGVydGllcyBpcyBlbmFibGVkIGFuZCBydW5zIGFmdGVyIHRoZSBkZWNvcmF0b3JzIHRyYW5zZm9ybS4nKTtcbn1cbmZ1bmN0aW9uIF9pbml0aWFsaXplckRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHksIGRlc2NyaXB0b3IsIGNvbnRleHQpIHtcbiAgaWYgKCFkZXNjcmlwdG9yKSByZXR1cm47XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5LCB7XG4gICAgZW51bWVyYWJsZTogZGVzY3JpcHRvci5lbnVtZXJhYmxlLFxuICAgIGNvbmZpZ3VyYWJsZTogZGVzY3JpcHRvci5jb25maWd1cmFibGUsXG4gICAgd3JpdGFibGU6IGRlc2NyaXB0b3Iud3JpdGFibGUsXG4gICAgdmFsdWU6IGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXIgPyBkZXNjcmlwdG9yLmluaXRpYWxpemVyLmNhbGwoY29udGV4dCkgOiB2b2lkIDBcbiAgfSk7XG59XG5mdW5jdGlvbiBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKHRhcmdldCwgcHJvcGVydHksIGRlY29yYXRvcnMsIGRlc2NyaXB0b3IsIGNvbnRleHQpIHtcbiAgdmFyIGRlc2MgPSB7fTtcbiAgT2JqZWN0LmtleXMoZGVzY3JpcHRvcikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgZGVzY1trZXldID0gZGVzY3JpcHRvcltrZXldO1xuICB9KTtcbiAgZGVzYy5lbnVtZXJhYmxlID0gISFkZXNjLmVudW1lcmFibGU7XG4gIGRlc2MuY29uZmlndXJhYmxlID0gISFkZXNjLmNvbmZpZ3VyYWJsZTtcbiAgaWYgKCd2YWx1ZScgaW4gZGVzYyB8fCBkZXNjLmluaXRpYWxpemVyKSB7XG4gICAgZGVzYy53cml0YWJsZSA9IHRydWU7XG4gIH1cbiAgZGVzYyA9IGRlY29yYXRvcnMuc2xpY2UoKS5yZXZlcnNlKCkucmVkdWNlKGZ1bmN0aW9uIChkZXNjLCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZGVjb3JhdG9yKHRhcmdldCwgcHJvcGVydHksIGRlc2MpIHx8IGRlc2M7XG4gIH0sIGRlc2MpO1xuICBpZiAoY29udGV4dCAmJiBkZXNjLmluaXRpYWxpemVyICE9PSB2b2lkIDApIHtcbiAgICBkZXNjLnZhbHVlID0gZGVzYy5pbml0aWFsaXplciA/IGRlc2MuaW5pdGlhbGl6ZXIuY2FsbChjb250ZXh0KSA6IHZvaWQgMDtcbiAgICBkZXNjLmluaXRpYWxpemVyID0gdW5kZWZpbmVkO1xuICB9XG4gIGlmIChkZXNjLmluaXRpYWxpemVyID09PSB2b2lkIDApIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eSwgZGVzYyk7XG4gICAgZGVzYyA9IG51bGw7XG4gIH1cbiAgcmV0dXJuIGRlc2M7XG59XG52YXIgaWQgPSAwO1xuZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkobmFtZSkge1xuICByZXR1cm4gXCJfX3ByaXZhdGVfXCIgKyBpZCsrICsgXCJfXCIgKyBuYW1lO1xufVxuZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHJlY2VpdmVyLCBwcml2YXRlS2V5KSB7XG4gIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY2VpdmVyLCBwcml2YXRlS2V5KSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJhdHRlbXB0ZWQgdG8gdXNlIHByaXZhdGUgZmllbGQgb24gbm9uLWluc3RhbmNlXCIpO1xuICB9XG4gIHJldHVybiByZWNlaXZlcjtcbn1cbmZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgcHJpdmF0ZU1hcCkge1xuICB2YXIgZGVzY3JpcHRvciA9IF9jbGFzc0V4dHJhY3RGaWVsZERlc2NyaXB0b3IocmVjZWl2ZXIsIHByaXZhdGVNYXAsIFwiZ2V0XCIpO1xuICByZXR1cm4gX2NsYXNzQXBwbHlEZXNjcmlwdG9yR2V0KHJlY2VpdmVyLCBkZXNjcmlwdG9yKTtcbn1cbmZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgcHJpdmF0ZU1hcCwgdmFsdWUpIHtcbiAgdmFyIGRlc2NyaXB0b3IgPSBfY2xhc3NFeHRyYWN0RmllbGREZXNjcmlwdG9yKHJlY2VpdmVyLCBwcml2YXRlTWFwLCBcInNldFwiKTtcbiAgX2NsYXNzQXBwbHlEZXNjcmlwdG9yU2V0KHJlY2VpdmVyLCBkZXNjcmlwdG9yLCB2YWx1ZSk7XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZERlc3RydWN0dXJlU2V0KHJlY2VpdmVyLCBwcml2YXRlTWFwKSB7XG4gIHZhciBkZXNjcmlwdG9yID0gX2NsYXNzRXh0cmFjdEZpZWxkRGVzY3JpcHRvcihyZWNlaXZlciwgcHJpdmF0ZU1hcCwgXCJzZXRcIik7XG4gIHJldHVybiBfY2xhc3NBcHBseURlc2NyaXB0b3JEZXN0cnVjdHVyZVNldChyZWNlaXZlciwgZGVzY3JpcHRvcik7XG59XG5mdW5jdGlvbiBfY2xhc3NFeHRyYWN0RmllbGREZXNjcmlwdG9yKHJlY2VpdmVyLCBwcml2YXRlTWFwLCBhY3Rpb24pIHtcbiAgaWYgKCFwcml2YXRlTWFwLmhhcyhyZWNlaXZlcikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYXR0ZW1wdGVkIHRvIFwiICsgYWN0aW9uICsgXCIgcHJpdmF0ZSBmaWVsZCBvbiBub24taW5zdGFuY2VcIik7XG4gIH1cbiAgcmV0dXJuIHByaXZhdGVNYXAuZ2V0KHJlY2VpdmVyKTtcbn1cbmZ1bmN0aW9uIF9jbGFzc1N0YXRpY1ByaXZhdGVGaWVsZFNwZWNHZXQocmVjZWl2ZXIsIGNsYXNzQ29uc3RydWN0b3IsIGRlc2NyaXB0b3IpIHtcbiAgX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljQWNjZXNzKHJlY2VpdmVyLCBjbGFzc0NvbnN0cnVjdG9yKTtcbiAgX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljRmllbGREZXNjcmlwdG9yKGRlc2NyaXB0b3IsIFwiZ2V0XCIpO1xuICByZXR1cm4gX2NsYXNzQXBwbHlEZXNjcmlwdG9yR2V0KHJlY2VpdmVyLCBkZXNjcmlwdG9yKTtcbn1cbmZ1bmN0aW9uIF9jbGFzc1N0YXRpY1ByaXZhdGVGaWVsZFNwZWNTZXQocmVjZWl2ZXIsIGNsYXNzQ29uc3RydWN0b3IsIGRlc2NyaXB0b3IsIHZhbHVlKSB7XG4gIF9jbGFzc0NoZWNrUHJpdmF0ZVN0YXRpY0FjY2VzcyhyZWNlaXZlciwgY2xhc3NDb25zdHJ1Y3Rvcik7XG4gIF9jbGFzc0NoZWNrUHJpdmF0ZVN0YXRpY0ZpZWxkRGVzY3JpcHRvcihkZXNjcmlwdG9yLCBcInNldFwiKTtcbiAgX2NsYXNzQXBwbHlEZXNjcmlwdG9yU2V0KHJlY2VpdmVyLCBkZXNjcmlwdG9yLCB2YWx1ZSk7XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIF9jbGFzc1N0YXRpY1ByaXZhdGVNZXRob2RHZXQocmVjZWl2ZXIsIGNsYXNzQ29uc3RydWN0b3IsIG1ldGhvZCkge1xuICBfY2xhc3NDaGVja1ByaXZhdGVTdGF0aWNBY2Nlc3MocmVjZWl2ZXIsIGNsYXNzQ29uc3RydWN0b3IpO1xuICByZXR1cm4gbWV0aG9kO1xufVxuZnVuY3Rpb24gX2NsYXNzU3RhdGljUHJpdmF0ZU1ldGhvZFNldCgpIHtcbiAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImF0dGVtcHRlZCB0byBzZXQgcmVhZCBvbmx5IHN0YXRpYyBwcml2YXRlIGZpZWxkXCIpO1xufVxuZnVuY3Rpb24gX2NsYXNzQXBwbHlEZXNjcmlwdG9yR2V0KHJlY2VpdmVyLCBkZXNjcmlwdG9yKSB7XG4gIGlmIChkZXNjcmlwdG9yLmdldCkge1xuICAgIHJldHVybiBkZXNjcmlwdG9yLmdldC5jYWxsKHJlY2VpdmVyKTtcbiAgfVxuICByZXR1cm4gZGVzY3JpcHRvci52YWx1ZTtcbn1cbmZ1bmN0aW9uIF9jbGFzc0FwcGx5RGVzY3JpcHRvclNldChyZWNlaXZlciwgZGVzY3JpcHRvciwgdmFsdWUpIHtcbiAgaWYgKGRlc2NyaXB0b3Iuc2V0KSB7XG4gICAgZGVzY3JpcHRvci5zZXQuY2FsbChyZWNlaXZlciwgdmFsdWUpO1xuICB9IGVsc2Uge1xuICAgIGlmICghZGVzY3JpcHRvci53cml0YWJsZSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImF0dGVtcHRlZCB0byBzZXQgcmVhZCBvbmx5IHByaXZhdGUgZmllbGRcIik7XG4gICAgfVxuICAgIGRlc2NyaXB0b3IudmFsdWUgPSB2YWx1ZTtcbiAgfVxufVxuZnVuY3Rpb24gX2NsYXNzQXBwbHlEZXNjcmlwdG9yRGVzdHJ1Y3R1cmVTZXQocmVjZWl2ZXIsIGRlc2NyaXB0b3IpIHtcbiAgaWYgKGRlc2NyaXB0b3Iuc2V0KSB7XG4gICAgaWYgKCEoXCJfX2Rlc3RyT2JqXCIgaW4gZGVzY3JpcHRvcikpIHtcbiAgICAgIGRlc2NyaXB0b3IuX19kZXN0ck9iaiA9IHtcbiAgICAgICAgc2V0IHZhbHVlKHYpIHtcbiAgICAgICAgICBkZXNjcmlwdG9yLnNldC5jYWxsKHJlY2VpdmVyLCB2KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGRlc2NyaXB0b3IuX19kZXN0ck9iajtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIWRlc2NyaXB0b3Iud3JpdGFibGUpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJhdHRlbXB0ZWQgdG8gc2V0IHJlYWQgb25seSBwcml2YXRlIGZpZWxkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZGVzY3JpcHRvcjtcbiAgfVxufVxuZnVuY3Rpb24gX2NsYXNzU3RhdGljUHJpdmF0ZUZpZWxkRGVzdHJ1Y3R1cmVTZXQocmVjZWl2ZXIsIGNsYXNzQ29uc3RydWN0b3IsIGRlc2NyaXB0b3IpIHtcbiAgX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljQWNjZXNzKHJlY2VpdmVyLCBjbGFzc0NvbnN0cnVjdG9yKTtcbiAgX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljRmllbGREZXNjcmlwdG9yKGRlc2NyaXB0b3IsIFwic2V0XCIpO1xuICByZXR1cm4gX2NsYXNzQXBwbHlEZXNjcmlwdG9yRGVzdHJ1Y3R1cmVTZXQocmVjZWl2ZXIsIGRlc2NyaXB0b3IpO1xufVxuZnVuY3Rpb24gX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljQWNjZXNzKHJlY2VpdmVyLCBjbGFzc0NvbnN0cnVjdG9yKSB7XG4gIGlmIChyZWNlaXZlciAhPT0gY2xhc3NDb25zdHJ1Y3Rvcikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIHN0YXRpYyBhY2Nlc3Mgb2Ygd3JvbmcgcHJvdmVuYW5jZVwiKTtcbiAgfVxufVxuZnVuY3Rpb24gX2NsYXNzQ2hlY2tQcml2YXRlU3RhdGljRmllbGREZXNjcmlwdG9yKGRlc2NyaXB0b3IsIGFjdGlvbikge1xuICBpZiAoZGVzY3JpcHRvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImF0dGVtcHRlZCB0byBcIiArIGFjdGlvbiArIFwiIHByaXZhdGUgc3RhdGljIGZpZWxkIGJlZm9yZSBpdHMgZGVjbGFyYXRpb25cIik7XG4gIH1cbn1cbmZ1bmN0aW9uIF9kZWNvcmF0ZShkZWNvcmF0b3JzLCBmYWN0b3J5LCBzdXBlckNsYXNzLCBtaXhpbnMpIHtcbiAgdmFyIGFwaSA9IF9nZXREZWNvcmF0b3JzQXBpKCk7XG4gIGlmIChtaXhpbnMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1peGlucy5sZW5ndGg7IGkrKykge1xuICAgICAgYXBpID0gbWl4aW5zW2ldKGFwaSk7XG4gICAgfVxuICB9XG4gIHZhciByID0gZmFjdG9yeShmdW5jdGlvbiBpbml0aWFsaXplKE8pIHtcbiAgICBhcGkuaW5pdGlhbGl6ZUluc3RhbmNlRWxlbWVudHMoTywgZGVjb3JhdGVkLmVsZW1lbnRzKTtcbiAgfSwgc3VwZXJDbGFzcyk7XG4gIHZhciBkZWNvcmF0ZWQgPSBhcGkuZGVjb3JhdGVDbGFzcyhfY29hbGVzY2VDbGFzc0VsZW1lbnRzKHIuZC5tYXAoX2NyZWF0ZUVsZW1lbnREZXNjcmlwdG9yKSksIGRlY29yYXRvcnMpO1xuICBhcGkuaW5pdGlhbGl6ZUNsYXNzRWxlbWVudHMoci5GLCBkZWNvcmF0ZWQuZWxlbWVudHMpO1xuICByZXR1cm4gYXBpLnJ1bkNsYXNzRmluaXNoZXJzKHIuRiwgZGVjb3JhdGVkLmZpbmlzaGVycyk7XG59XG5mdW5jdGlvbiBfZ2V0RGVjb3JhdG9yc0FwaSgpIHtcbiAgX2dldERlY29yYXRvcnNBcGkgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGFwaTtcbiAgfTtcbiAgdmFyIGFwaSA9IHtcbiAgICBlbGVtZW50c0RlZmluaXRpb25PcmRlcjogW1tcIm1ldGhvZFwiXSwgW1wiZmllbGRcIl1dLFxuICAgIGluaXRpYWxpemVJbnN0YW5jZUVsZW1lbnRzOiBmdW5jdGlvbiAoTywgZWxlbWVudHMpIHtcbiAgICAgIFtcIm1ldGhvZFwiLCBcImZpZWxkXCJdLmZvckVhY2goZnVuY3Rpb24gKGtpbmQpIHtcbiAgICAgICAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgIGlmIChlbGVtZW50LmtpbmQgPT09IGtpbmQgJiYgZWxlbWVudC5wbGFjZW1lbnQgPT09IFwib3duXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZGVmaW5lQ2xhc3NFbGVtZW50KE8sIGVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9LFxuICAgIGluaXRpYWxpemVDbGFzc0VsZW1lbnRzOiBmdW5jdGlvbiAoRiwgZWxlbWVudHMpIHtcbiAgICAgIHZhciBwcm90byA9IEYucHJvdG90eXBlO1xuICAgICAgW1wibWV0aG9kXCIsIFwiZmllbGRcIl0uZm9yRWFjaChmdW5jdGlvbiAoa2luZCkge1xuICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgdmFyIHBsYWNlbWVudCA9IGVsZW1lbnQucGxhY2VtZW50O1xuICAgICAgICAgIGlmIChlbGVtZW50LmtpbmQgPT09IGtpbmQgJiYgKHBsYWNlbWVudCA9PT0gXCJzdGF0aWNcIiB8fCBwbGFjZW1lbnQgPT09IFwicHJvdG90eXBlXCIpKSB7XG4gICAgICAgICAgICB2YXIgcmVjZWl2ZXIgPSBwbGFjZW1lbnQgPT09IFwic3RhdGljXCIgPyBGIDogcHJvdG87XG4gICAgICAgICAgICB0aGlzLmRlZmluZUNsYXNzRWxlbWVudChyZWNlaXZlciwgZWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG4gICAgZGVmaW5lQ2xhc3NFbGVtZW50OiBmdW5jdGlvbiAocmVjZWl2ZXIsIGVsZW1lbnQpIHtcbiAgICAgIHZhciBkZXNjcmlwdG9yID0gZWxlbWVudC5kZXNjcmlwdG9yO1xuICAgICAgaWYgKGVsZW1lbnQua2luZCA9PT0gXCJmaWVsZFwiKSB7XG4gICAgICAgIHZhciBpbml0aWFsaXplciA9IGVsZW1lbnQuaW5pdGlhbGl6ZXI7XG4gICAgICAgIGRlc2NyaXB0b3IgPSB7XG4gICAgICAgICAgZW51bWVyYWJsZTogZGVzY3JpcHRvci5lbnVtZXJhYmxlLFxuICAgICAgICAgIHdyaXRhYmxlOiBkZXNjcmlwdG9yLndyaXRhYmxlLFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZGVzY3JpcHRvci5jb25maWd1cmFibGUsXG4gICAgICAgICAgdmFsdWU6IGluaXRpYWxpemVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbml0aWFsaXplci5jYWxsKHJlY2VpdmVyKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlY2VpdmVyLCBlbGVtZW50LmtleSwgZGVzY3JpcHRvcik7XG4gICAgfSxcbiAgICBkZWNvcmF0ZUNsYXNzOiBmdW5jdGlvbiAoZWxlbWVudHMsIGRlY29yYXRvcnMpIHtcbiAgICAgIHZhciBuZXdFbGVtZW50cyA9IFtdO1xuICAgICAgdmFyIGZpbmlzaGVycyA9IFtdO1xuICAgICAgdmFyIHBsYWNlbWVudHMgPSB7XG4gICAgICAgIHN0YXRpYzogW10sXG4gICAgICAgIHByb3RvdHlwZTogW10sXG4gICAgICAgIG93bjogW11cbiAgICAgIH07XG4gICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuYWRkRWxlbWVudFBsYWNlbWVudChlbGVtZW50LCBwbGFjZW1lbnRzKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgICAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBpZiAoIV9oYXNEZWNvcmF0b3JzKGVsZW1lbnQpKSByZXR1cm4gbmV3RWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgdmFyIGVsZW1lbnRGaW5pc2hlcnNFeHRyYXMgPSB0aGlzLmRlY29yYXRlRWxlbWVudChlbGVtZW50LCBwbGFjZW1lbnRzKTtcbiAgICAgICAgbmV3RWxlbWVudHMucHVzaChlbGVtZW50RmluaXNoZXJzRXh0cmFzLmVsZW1lbnQpO1xuICAgICAgICBuZXdFbGVtZW50cy5wdXNoLmFwcGx5KG5ld0VsZW1lbnRzLCBlbGVtZW50RmluaXNoZXJzRXh0cmFzLmV4dHJhcyk7XG4gICAgICAgIGZpbmlzaGVycy5wdXNoLmFwcGx5KGZpbmlzaGVycywgZWxlbWVudEZpbmlzaGVyc0V4dHJhcy5maW5pc2hlcnMpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgICBpZiAoIWRlY29yYXRvcnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlbGVtZW50czogbmV3RWxlbWVudHMsXG4gICAgICAgICAgZmluaXNoZXJzOiBmaW5pc2hlcnNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29yYXRlQ29uc3RydWN0b3IobmV3RWxlbWVudHMsIGRlY29yYXRvcnMpO1xuICAgICAgZmluaXNoZXJzLnB1c2guYXBwbHkoZmluaXNoZXJzLCByZXN1bHQuZmluaXNoZXJzKTtcbiAgICAgIHJlc3VsdC5maW5pc2hlcnMgPSBmaW5pc2hlcnM7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgYWRkRWxlbWVudFBsYWNlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQsIHBsYWNlbWVudHMsIHNpbGVudCkge1xuICAgICAgdmFyIGtleXMgPSBwbGFjZW1lbnRzW2VsZW1lbnQucGxhY2VtZW50XTtcbiAgICAgIGlmICghc2lsZW50ICYmIGtleXMuaW5kZXhPZihlbGVtZW50LmtleSkgIT09IC0xKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJEdXBsaWNhdGVkIGVsZW1lbnQgKFwiICsgZWxlbWVudC5rZXkgKyBcIilcIik7XG4gICAgICB9XG4gICAgICBrZXlzLnB1c2goZWxlbWVudC5rZXkpO1xuICAgIH0sXG4gICAgZGVjb3JhdGVFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgcGxhY2VtZW50cykge1xuICAgICAgdmFyIGV4dHJhcyA9IFtdO1xuICAgICAgdmFyIGZpbmlzaGVycyA9IFtdO1xuICAgICAgZm9yICh2YXIgZGVjb3JhdG9ycyA9IGVsZW1lbnQuZGVjb3JhdG9ycywgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIGtleXMgPSBwbGFjZW1lbnRzW2VsZW1lbnQucGxhY2VtZW50XTtcbiAgICAgICAga2V5cy5zcGxpY2Uoa2V5cy5pbmRleE9mKGVsZW1lbnQua2V5KSwgMSk7XG4gICAgICAgIHZhciBlbGVtZW50T2JqZWN0ID0gdGhpcy5mcm9tRWxlbWVudERlc2NyaXB0b3IoZWxlbWVudCk7XG4gICAgICAgIHZhciBlbGVtZW50RmluaXNoZXJFeHRyYXMgPSB0aGlzLnRvRWxlbWVudEZpbmlzaGVyRXh0cmFzKCgwLCBkZWNvcmF0b3JzW2ldKShlbGVtZW50T2JqZWN0KSB8fCBlbGVtZW50T2JqZWN0KTtcbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnRGaW5pc2hlckV4dHJhcy5lbGVtZW50O1xuICAgICAgICB0aGlzLmFkZEVsZW1lbnRQbGFjZW1lbnQoZWxlbWVudCwgcGxhY2VtZW50cyk7XG4gICAgICAgIGlmIChlbGVtZW50RmluaXNoZXJFeHRyYXMuZmluaXNoZXIpIHtcbiAgICAgICAgICBmaW5pc2hlcnMucHVzaChlbGVtZW50RmluaXNoZXJFeHRyYXMuZmluaXNoZXIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBuZXdFeHRyYXMgPSBlbGVtZW50RmluaXNoZXJFeHRyYXMuZXh0cmFzO1xuICAgICAgICBpZiAobmV3RXh0cmFzKSB7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZXdFeHRyYXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRWxlbWVudFBsYWNlbWVudChuZXdFeHRyYXNbal0sIHBsYWNlbWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBleHRyYXMucHVzaC5hcHBseShleHRyYXMsIG5ld0V4dHJhcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgIGZpbmlzaGVyczogZmluaXNoZXJzLFxuICAgICAgICBleHRyYXM6IGV4dHJhc1xuICAgICAgfTtcbiAgICB9LFxuICAgIGRlY29yYXRlQ29uc3RydWN0b3I6IGZ1bmN0aW9uIChlbGVtZW50cywgZGVjb3JhdG9ycykge1xuICAgICAgdmFyIGZpbmlzaGVycyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIG9iaiA9IHRoaXMuZnJvbUNsYXNzRGVzY3JpcHRvcihlbGVtZW50cyk7XG4gICAgICAgIHZhciBlbGVtZW50c0FuZEZpbmlzaGVyID0gdGhpcy50b0NsYXNzRGVzY3JpcHRvcigoMCwgZGVjb3JhdG9yc1tpXSkob2JqKSB8fCBvYmopO1xuICAgICAgICBpZiAoZWxlbWVudHNBbmRGaW5pc2hlci5maW5pc2hlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgZmluaXNoZXJzLnB1c2goZWxlbWVudHNBbmRGaW5pc2hlci5maW5pc2hlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnRzQW5kRmluaXNoZXIuZWxlbWVudHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVsZW1lbnRzID0gZWxlbWVudHNBbmRGaW5pc2hlci5lbGVtZW50cztcbiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGVsZW1lbnRzLmxlbmd0aCAtIDE7IGorKykge1xuICAgICAgICAgICAgZm9yICh2YXIgayA9IGogKyAxOyBrIDwgZWxlbWVudHMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgICAgaWYgKGVsZW1lbnRzW2pdLmtleSA9PT0gZWxlbWVudHNba10ua2V5ICYmIGVsZW1lbnRzW2pdLnBsYWNlbWVudCA9PT0gZWxlbWVudHNba10ucGxhY2VtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkR1cGxpY2F0ZWQgZWxlbWVudCAoXCIgKyBlbGVtZW50c1tqXS5rZXkgKyBcIilcIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnRzOiBlbGVtZW50cyxcbiAgICAgICAgZmluaXNoZXJzOiBmaW5pc2hlcnNcbiAgICAgIH07XG4gICAgfSxcbiAgICBmcm9tRWxlbWVudERlc2NyaXB0b3I6IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICB2YXIgb2JqID0ge1xuICAgICAgICBraW5kOiBlbGVtZW50LmtpbmQsXG4gICAgICAgIGtleTogZWxlbWVudC5rZXksXG4gICAgICAgIHBsYWNlbWVudDogZWxlbWVudC5wbGFjZW1lbnQsXG4gICAgICAgIGRlc2NyaXB0b3I6IGVsZW1lbnQuZGVzY3JpcHRvclxuICAgICAgfTtcbiAgICAgIHZhciBkZXNjID0ge1xuICAgICAgICB2YWx1ZTogXCJEZXNjcmlwdG9yXCIsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgfTtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIFN5bWJvbC50b1N0cmluZ1RhZywgZGVzYyk7XG4gICAgICBpZiAoZWxlbWVudC5raW5kID09PSBcImZpZWxkXCIpIG9iai5pbml0aWFsaXplciA9IGVsZW1lbnQuaW5pdGlhbGl6ZXI7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH0sXG4gICAgdG9FbGVtZW50RGVzY3JpcHRvcnM6IGZ1bmN0aW9uIChlbGVtZW50T2JqZWN0cykge1xuICAgICAgaWYgKGVsZW1lbnRPYmplY3RzID09PSB1bmRlZmluZWQpIHJldHVybjtcbiAgICAgIHJldHVybiBfdG9BcnJheShlbGVtZW50T2JqZWN0cykubWFwKGZ1bmN0aW9uIChlbGVtZW50T2JqZWN0KSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy50b0VsZW1lbnREZXNjcmlwdG9yKGVsZW1lbnRPYmplY3QpO1xuICAgICAgICB0aGlzLmRpc2FsbG93UHJvcGVydHkoZWxlbWVudE9iamVjdCwgXCJmaW5pc2hlclwiLCBcIkFuIGVsZW1lbnQgZGVzY3JpcHRvclwiKTtcbiAgICAgICAgdGhpcy5kaXNhbGxvd1Byb3BlcnR5KGVsZW1lbnRPYmplY3QsIFwiZXh0cmFzXCIsIFwiQW4gZWxlbWVudCBkZXNjcmlwdG9yXCIpO1xuICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG4gICAgdG9FbGVtZW50RGVzY3JpcHRvcjogZnVuY3Rpb24gKGVsZW1lbnRPYmplY3QpIHtcbiAgICAgIHZhciBraW5kID0gU3RyaW5nKGVsZW1lbnRPYmplY3Qua2luZCk7XG4gICAgICBpZiAoa2luZCAhPT0gXCJtZXRob2RcIiAmJiBraW5kICE9PSBcImZpZWxkXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQW4gZWxlbWVudCBkZXNjcmlwdG9yXFwncyAua2luZCBwcm9wZXJ0eSBtdXN0IGJlIGVpdGhlciBcIm1ldGhvZFwiIG9yJyArICcgXCJmaWVsZFwiLCBidXQgYSBkZWNvcmF0b3IgY3JlYXRlZCBhbiBlbGVtZW50IGRlc2NyaXB0b3Igd2l0aCcgKyAnIC5raW5kIFwiJyArIGtpbmQgKyAnXCInKTtcbiAgICAgIH1cbiAgICAgIHZhciBrZXkgPSBfdG9Qcm9wZXJ0eUtleShlbGVtZW50T2JqZWN0LmtleSk7XG4gICAgICB2YXIgcGxhY2VtZW50ID0gU3RyaW5nKGVsZW1lbnRPYmplY3QucGxhY2VtZW50KTtcbiAgICAgIGlmIChwbGFjZW1lbnQgIT09IFwic3RhdGljXCIgJiYgcGxhY2VtZW50ICE9PSBcInByb3RvdHlwZVwiICYmIHBsYWNlbWVudCAhPT0gXCJvd25cIikge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBbiBlbGVtZW50IGRlc2NyaXB0b3JcXCdzIC5wbGFjZW1lbnQgcHJvcGVydHkgbXVzdCBiZSBvbmUgb2YgXCJzdGF0aWNcIiwnICsgJyBcInByb3RvdHlwZVwiIG9yIFwib3duXCIsIGJ1dCBhIGRlY29yYXRvciBjcmVhdGVkIGFuIGVsZW1lbnQgZGVzY3JpcHRvcicgKyAnIHdpdGggLnBsYWNlbWVudCBcIicgKyBwbGFjZW1lbnQgKyAnXCInKTtcbiAgICAgIH1cbiAgICAgIHZhciBkZXNjcmlwdG9yID0gZWxlbWVudE9iamVjdC5kZXNjcmlwdG9yO1xuICAgICAgdGhpcy5kaXNhbGxvd1Byb3BlcnR5KGVsZW1lbnRPYmplY3QsIFwiZWxlbWVudHNcIiwgXCJBbiBlbGVtZW50IGRlc2NyaXB0b3JcIik7XG4gICAgICB2YXIgZWxlbWVudCA9IHtcbiAgICAgICAga2luZDoga2luZCxcbiAgICAgICAga2V5OiBrZXksXG4gICAgICAgIHBsYWNlbWVudDogcGxhY2VtZW50LFxuICAgICAgICBkZXNjcmlwdG9yOiBPYmplY3QuYXNzaWduKHt9LCBkZXNjcmlwdG9yKVxuICAgICAgfTtcbiAgICAgIGlmIChraW5kICE9PSBcImZpZWxkXCIpIHtcbiAgICAgICAgdGhpcy5kaXNhbGxvd1Byb3BlcnR5KGVsZW1lbnRPYmplY3QsIFwiaW5pdGlhbGl6ZXJcIiwgXCJBIG1ldGhvZCBkZXNjcmlwdG9yXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kaXNhbGxvd1Byb3BlcnR5KGRlc2NyaXB0b3IsIFwiZ2V0XCIsIFwiVGhlIHByb3BlcnR5IGRlc2NyaXB0b3Igb2YgYSBmaWVsZCBkZXNjcmlwdG9yXCIpO1xuICAgICAgICB0aGlzLmRpc2FsbG93UHJvcGVydHkoZGVzY3JpcHRvciwgXCJzZXRcIiwgXCJUaGUgcHJvcGVydHkgZGVzY3JpcHRvciBvZiBhIGZpZWxkIGRlc2NyaXB0b3JcIik7XG4gICAgICAgIHRoaXMuZGlzYWxsb3dQcm9wZXJ0eShkZXNjcmlwdG9yLCBcInZhbHVlXCIsIFwiVGhlIHByb3BlcnR5IGRlc2NyaXB0b3Igb2YgYSBmaWVsZCBkZXNjcmlwdG9yXCIpO1xuICAgICAgICBlbGVtZW50LmluaXRpYWxpemVyID0gZWxlbWVudE9iamVjdC5pbml0aWFsaXplcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH0sXG4gICAgdG9FbGVtZW50RmluaXNoZXJFeHRyYXM6IGZ1bmN0aW9uIChlbGVtZW50T2JqZWN0KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IHRoaXMudG9FbGVtZW50RGVzY3JpcHRvcihlbGVtZW50T2JqZWN0KTtcbiAgICAgIHZhciBmaW5pc2hlciA9IF9vcHRpb25hbENhbGxhYmxlUHJvcGVydHkoZWxlbWVudE9iamVjdCwgXCJmaW5pc2hlclwiKTtcbiAgICAgIHZhciBleHRyYXMgPSB0aGlzLnRvRWxlbWVudERlc2NyaXB0b3JzKGVsZW1lbnRPYmplY3QuZXh0cmFzKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgIGZpbmlzaGVyOiBmaW5pc2hlcixcbiAgICAgICAgZXh0cmFzOiBleHRyYXNcbiAgICAgIH07XG4gICAgfSxcbiAgICBmcm9tQ2xhc3NEZXNjcmlwdG9yOiBmdW5jdGlvbiAoZWxlbWVudHMpIHtcbiAgICAgIHZhciBvYmogPSB7XG4gICAgICAgIGtpbmQ6IFwiY2xhc3NcIixcbiAgICAgICAgZWxlbWVudHM6IGVsZW1lbnRzLm1hcCh0aGlzLmZyb21FbGVtZW50RGVzY3JpcHRvciwgdGhpcylcbiAgICAgIH07XG4gICAgICB2YXIgZGVzYyA9IHtcbiAgICAgICAgdmFsdWU6IFwiRGVzY3JpcHRvclwiLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgIH07XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBTeW1ib2wudG9TdHJpbmdUYWcsIGRlc2MpO1xuICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuICAgIHRvQ2xhc3NEZXNjcmlwdG9yOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICB2YXIga2luZCA9IFN0cmluZyhvYmoua2luZCk7XG4gICAgICBpZiAoa2luZCAhPT0gXCJjbGFzc1wiKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0EgY2xhc3MgZGVzY3JpcHRvclxcJ3MgLmtpbmQgcHJvcGVydHkgbXVzdCBiZSBcImNsYXNzXCIsIGJ1dCBhIGRlY29yYXRvcicgKyAnIGNyZWF0ZWQgYSBjbGFzcyBkZXNjcmlwdG9yIHdpdGggLmtpbmQgXCInICsga2luZCArICdcIicpO1xuICAgICAgfVxuICAgICAgdGhpcy5kaXNhbGxvd1Byb3BlcnR5KG9iaiwgXCJrZXlcIiwgXCJBIGNsYXNzIGRlc2NyaXB0b3JcIik7XG4gICAgICB0aGlzLmRpc2FsbG93UHJvcGVydHkob2JqLCBcInBsYWNlbWVudFwiLCBcIkEgY2xhc3MgZGVzY3JpcHRvclwiKTtcbiAgICAgIHRoaXMuZGlzYWxsb3dQcm9wZXJ0eShvYmosIFwiZGVzY3JpcHRvclwiLCBcIkEgY2xhc3MgZGVzY3JpcHRvclwiKTtcbiAgICAgIHRoaXMuZGlzYWxsb3dQcm9wZXJ0eShvYmosIFwiaW5pdGlhbGl6ZXJcIiwgXCJBIGNsYXNzIGRlc2NyaXB0b3JcIik7XG4gICAgICB0aGlzLmRpc2FsbG93UHJvcGVydHkob2JqLCBcImV4dHJhc1wiLCBcIkEgY2xhc3MgZGVzY3JpcHRvclwiKTtcbiAgICAgIHZhciBmaW5pc2hlciA9IF9vcHRpb25hbENhbGxhYmxlUHJvcGVydHkob2JqLCBcImZpbmlzaGVyXCIpO1xuICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy50b0VsZW1lbnREZXNjcmlwdG9ycyhvYmouZWxlbWVudHMpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudHM6IGVsZW1lbnRzLFxuICAgICAgICBmaW5pc2hlcjogZmluaXNoZXJcbiAgICAgIH07XG4gICAgfSxcbiAgICBydW5DbGFzc0ZpbmlzaGVyczogZnVuY3Rpb24gKGNvbnN0cnVjdG9yLCBmaW5pc2hlcnMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmluaXNoZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBuZXdDb25zdHJ1Y3RvciA9ICgwLCBmaW5pc2hlcnNbaV0pKGNvbnN0cnVjdG9yKTtcbiAgICAgICAgaWYgKG5ld0NvbnN0cnVjdG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5ld0NvbnN0cnVjdG9yICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJGaW5pc2hlcnMgbXVzdCByZXR1cm4gYSBjb25zdHJ1Y3Rvci5cIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0cnVjdG9yID0gbmV3Q29uc3RydWN0b3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjb25zdHJ1Y3RvcjtcbiAgICB9LFxuICAgIGRpc2FsbG93UHJvcGVydHk6IGZ1bmN0aW9uIChvYmosIG5hbWUsIG9iamVjdFR5cGUpIHtcbiAgICAgIGlmIChvYmpbbmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKG9iamVjdFR5cGUgKyBcIiBjYW4ndCBoYXZlIGEgLlwiICsgbmFtZSArIFwiIHByb3BlcnR5LlwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBhcGk7XG59XG5mdW5jdGlvbiBfY3JlYXRlRWxlbWVudERlc2NyaXB0b3IoZGVmKSB7XG4gIHZhciBrZXkgPSBfdG9Qcm9wZXJ0eUtleShkZWYua2V5KTtcbiAgdmFyIGRlc2NyaXB0b3I7XG4gIGlmIChkZWYua2luZCA9PT0gXCJtZXRob2RcIikge1xuICAgIGRlc2NyaXB0b3IgPSB7XG4gICAgICB2YWx1ZTogZGVmLnZhbHVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgIH07XG4gIH0gZWxzZSBpZiAoZGVmLmtpbmQgPT09IFwiZ2V0XCIpIHtcbiAgICBkZXNjcmlwdG9yID0ge1xuICAgICAgZ2V0OiBkZWYudmFsdWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgIH07XG4gIH0gZWxzZSBpZiAoZGVmLmtpbmQgPT09IFwic2V0XCIpIHtcbiAgICBkZXNjcmlwdG9yID0ge1xuICAgICAgc2V0OiBkZWYudmFsdWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgIH07XG4gIH0gZWxzZSBpZiAoZGVmLmtpbmQgPT09IFwiZmllbGRcIikge1xuICAgIGRlc2NyaXB0b3IgPSB7XG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9O1xuICB9XG4gIHZhciBlbGVtZW50ID0ge1xuICAgIGtpbmQ6IGRlZi5raW5kID09PSBcImZpZWxkXCIgPyBcImZpZWxkXCIgOiBcIm1ldGhvZFwiLFxuICAgIGtleToga2V5LFxuICAgIHBsYWNlbWVudDogZGVmLnN0YXRpYyA/IFwic3RhdGljXCIgOiBkZWYua2luZCA9PT0gXCJmaWVsZFwiID8gXCJvd25cIiA6IFwicHJvdG90eXBlXCIsXG4gICAgZGVzY3JpcHRvcjogZGVzY3JpcHRvclxuICB9O1xuICBpZiAoZGVmLmRlY29yYXRvcnMpIGVsZW1lbnQuZGVjb3JhdG9ycyA9IGRlZi5kZWNvcmF0b3JzO1xuICBpZiAoZGVmLmtpbmQgPT09IFwiZmllbGRcIikgZWxlbWVudC5pbml0aWFsaXplciA9IGRlZi52YWx1ZTtcbiAgcmV0dXJuIGVsZW1lbnQ7XG59XG5mdW5jdGlvbiBfY29hbGVzY2VHZXR0ZXJTZXR0ZXIoZWxlbWVudCwgb3RoZXIpIHtcbiAgaWYgKGVsZW1lbnQuZGVzY3JpcHRvci5nZXQgIT09IHVuZGVmaW5lZCkge1xuICAgIG90aGVyLmRlc2NyaXB0b3IuZ2V0ID0gZWxlbWVudC5kZXNjcmlwdG9yLmdldDtcbiAgfSBlbHNlIHtcbiAgICBvdGhlci5kZXNjcmlwdG9yLnNldCA9IGVsZW1lbnQuZGVzY3JpcHRvci5zZXQ7XG4gIH1cbn1cbmZ1bmN0aW9uIF9jb2FsZXNjZUNsYXNzRWxlbWVudHMoZWxlbWVudHMpIHtcbiAgdmFyIG5ld0VsZW1lbnRzID0gW107XG4gIHZhciBpc1NhbWVFbGVtZW50ID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgcmV0dXJuIG90aGVyLmtpbmQgPT09IFwibWV0aG9kXCIgJiYgb3RoZXIua2V5ID09PSBlbGVtZW50LmtleSAmJiBvdGhlci5wbGFjZW1lbnQgPT09IGVsZW1lbnQucGxhY2VtZW50O1xuICB9O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGVsZW1lbnQgPSBlbGVtZW50c1tpXTtcbiAgICB2YXIgb3RoZXI7XG4gICAgaWYgKGVsZW1lbnQua2luZCA9PT0gXCJtZXRob2RcIiAmJiAob3RoZXIgPSBuZXdFbGVtZW50cy5maW5kKGlzU2FtZUVsZW1lbnQpKSkge1xuICAgICAgaWYgKF9pc0RhdGFEZXNjcmlwdG9yKGVsZW1lbnQuZGVzY3JpcHRvcikgfHwgX2lzRGF0YURlc2NyaXB0b3Iob3RoZXIuZGVzY3JpcHRvcikpIHtcbiAgICAgICAgaWYgKF9oYXNEZWNvcmF0b3JzKGVsZW1lbnQpIHx8IF9oYXNEZWNvcmF0b3JzKG90aGVyKSkge1xuICAgICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcIkR1cGxpY2F0ZWQgbWV0aG9kcyAoXCIgKyBlbGVtZW50LmtleSArIFwiKSBjYW4ndCBiZSBkZWNvcmF0ZWQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIG90aGVyLmRlc2NyaXB0b3IgPSBlbGVtZW50LmRlc2NyaXB0b3I7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoX2hhc0RlY29yYXRvcnMoZWxlbWVudCkpIHtcbiAgICAgICAgICBpZiAoX2hhc0RlY29yYXRvcnMob3RoZXIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJEZWNvcmF0b3JzIGNhbid0IGJlIHBsYWNlZCBvbiBkaWZmZXJlbnQgYWNjZXNzb3JzIHdpdGggZm9yIFwiICsgXCJ0aGUgc2FtZSBwcm9wZXJ0eSAoXCIgKyBlbGVtZW50LmtleSArIFwiKS5cIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIG90aGVyLmRlY29yYXRvcnMgPSBlbGVtZW50LmRlY29yYXRvcnM7XG4gICAgICAgIH1cbiAgICAgICAgX2NvYWxlc2NlR2V0dGVyU2V0dGVyKGVsZW1lbnQsIG90aGVyKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbmV3RWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ld0VsZW1lbnRzO1xufVxuZnVuY3Rpb24gX2hhc0RlY29yYXRvcnMoZWxlbWVudCkge1xuICByZXR1cm4gZWxlbWVudC5kZWNvcmF0b3JzICYmIGVsZW1lbnQuZGVjb3JhdG9ycy5sZW5ndGg7XG59XG5mdW5jdGlvbiBfaXNEYXRhRGVzY3JpcHRvcihkZXNjKSB7XG4gIHJldHVybiBkZXNjICE9PSB1bmRlZmluZWQgJiYgIShkZXNjLnZhbHVlID09PSB1bmRlZmluZWQgJiYgZGVzYy53cml0YWJsZSA9PT0gdW5kZWZpbmVkKTtcbn1cbmZ1bmN0aW9uIF9vcHRpb25hbENhbGxhYmxlUHJvcGVydHkob2JqLCBuYW1lKSB7XG4gIHZhciB2YWx1ZSA9IG9ialtuYW1lXTtcbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhwZWN0ZWQgJ1wiICsgbmFtZSArIFwiJyB0byBiZSBhIGZ1bmN0aW9uXCIpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVNZXRob2RHZXQocmVjZWl2ZXIsIHByaXZhdGVTZXQsIGZuKSB7XG4gIGlmICghcHJpdmF0ZVNldC5oYXMocmVjZWl2ZXIpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImF0dGVtcHRlZCB0byBnZXQgcHJpdmF0ZSBmaWVsZCBvbiBub24taW5zdGFuY2VcIik7XG4gIH1cbiAgcmV0dXJuIGZuO1xufVxuZnVuY3Rpb24gX2NoZWNrUHJpdmF0ZVJlZGVjbGFyYXRpb24ob2JqLCBwcml2YXRlQ29sbGVjdGlvbikge1xuICBpZiAocHJpdmF0ZUNvbGxlY3Rpb24uaGFzKG9iaikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGluaXRpYWxpemUgdGhlIHNhbWUgcHJpdmF0ZSBlbGVtZW50cyB0d2ljZSBvbiBhbiBvYmplY3RcIik7XG4gIH1cbn1cbmZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZEluaXRTcGVjKG9iaiwgcHJpdmF0ZU1hcCwgdmFsdWUpIHtcbiAgX2NoZWNrUHJpdmF0ZVJlZGVjbGFyYXRpb24ob2JqLCBwcml2YXRlTWFwKTtcbiAgcHJpdmF0ZU1hcC5zZXQob2JqLCB2YWx1ZSk7XG59XG5mdW5jdGlvbiBfY2xhc3NQcml2YXRlTWV0aG9kSW5pdFNwZWMob2JqLCBwcml2YXRlU2V0KSB7XG4gIF9jaGVja1ByaXZhdGVSZWRlY2xhcmF0aW9uKG9iaiwgcHJpdmF0ZVNldCk7XG4gIHByaXZhdGVTZXQuYWRkKG9iaik7XG59XG5mdW5jdGlvbiBfY2xhc3NQcml2YXRlTWV0aG9kU2V0KCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYXR0ZW1wdGVkIHRvIHJlYXNzaWduIHByaXZhdGUgbWV0aG9kXCIpO1xufVxuZnVuY3Rpb24gX2lkZW50aXR5KHgpIHtcbiAgcmV0dXJuIHg7XG59Il19